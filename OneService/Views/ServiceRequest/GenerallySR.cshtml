@{
	ViewData["Title"] = "GenerallySR";
	Layout = "~/Views/Shared/_LayoutHome.cshtml";
}

<!--要透過Server Code處理寫在裡面-->
@functions{	
	public string TransDateFormat(object tDate)
	{
		string reValue = string.Empty;
		string TempDate = string.Empty;

        if (tDate != null)
        {
			TempDate = Convert.ToString(tDate);
            reValue = Convert.ToDateTime(TempDate).ToString("yyyy-MM-dd");
        }

        return reValue;
    }

	public string TransDateFormat_min(object tDate)
	{
		string reValue = string.Empty;
		string TempDate = string.Empty;

        if (tDate != null)
        {
			TempDate = Convert.ToString(tDate);
            reValue = Convert.ToDateTime(TempDate).ToString("yyyy-MM-dd HH:mm");
        }

        return reValue;
    }
}

<!--Java Script寫在js_section裡面-->
@section js_section{
	<script>
		var trContactNoCount = 0;				//記錄目前明細列(客戶聯絡資訊檔)的ID數
		var trProductNoCount = 0;				//記錄目前明細列(產品序號資訊檔)的ID數
		var trWarrantyNoCount = 0;				//記錄目前明細列(保固SLA檔)的ID數
		var trRecordNoCount = 0;				//記錄目前明細列(處理與工時紀錄)的ID數
		var trPartsNoCount = 0;				//記錄目前明細列(零件更換檔)的ID數
		var AryPNowPrSERIAL = new Array();		//記錄目前產品的序號
		var AryPNowWASERIAL = new Array();		//記錄目前保固的序號

		$(document).ready(function () {
			initPage();					//初始頁面			
			openPostAddress();			//開啟郵遞區號和地址查詢視窗
			RoadSearch();				//Ajax路段(名)關鍵字查詢
			CustSearch();				//取得客戶資料	
			SerialSearch();				//產品序號資訊查詢
			findMaterialByKeyword();	//用關鍵字查詢物料
			PeopleSearch();				//Ajax用中文或英文姓名查詢人員帳號
			PeopleTeamSearch();			//Ajax用中文或英文姓名查詢人員帳號(by服務團隊)
			SQPersonSearch();			//Ajax用關鍵字查詢SQ人員	
			callCollapseL2();			//更改L2處理中載入時，要呼叫此方法，頁籤才可以收合
			getFaultInfo(false);			//取得客戶故障狀況分類資訊
			getpjTeam();				//取得服務團隊
			getpjAssEngineer();			//取得協助工程師	
			getpjTechManager();			//取得技術主管	
			getSRDetail_Warranty();		//取得保固SLA明細Table(非新建或駁回狀態)
		});		

		//初始頁面
		function initPage()
		{
			 $('.datetimepicker').datetimepicker({
				minView: "hour", //只顯示到每日的小時(含每小時5分鐘顯示)
                format: "yyyy-mm-dd hh:ii",
                autoclose: true, //當選擇一個日期之後是否立即關閉此日期時間選擇器。
                todayBtn: "linked", //如果此值為true或"linked"，則在日期時間選擇器組件的底部顯示一個today按鈕用以選擇當前日期。如果是true，today按鈕僅僅將視圖轉到當天的日期，如果是linked，當天日期將會被選中。
                todayHighlight: true, //如果為true，閃亮當前日期。
            });		
			
			//顯示編輯/刪除報修人設定popup
            $('#btn_editRepairInfo').click(function () {
                var CustomerID = $('#hid_cCustomerID').val();
				if (CustomerID == "")
				{
					alert("您尚未輸入【客戶】！");
				}
				else
				{
					$('#dialog_pjEditContactInfo').modal('show');				
					$("#tbx_editContactName").val("");
					$("#tb_pjeditContact").html("");
					$("#btn_savepjEditContact").hide();
					cleanpjeditContact();
				}
            })

			//顯示編輯/刪除聯絡人設定popup
            $('#btn_editContactInfo').click(function () {
				var CustomerID = $('#hid_cCustomerID').val();
				if (CustomerID == "")
				{
					alert("您尚未輸入【客戶】！");
				}
				else
				{
					$('#dialog_pjEditContactInfo').modal('show');				
					$("#tbx_editContactName").val("");
					$("#tb_pjeditContact").html("");
					$("#btn_savepjEditContact").hide();
					cleanpjeditContact();
				}
            })		
			
			//查詢更改歷史記錄popup
            $('#btn_ShowHistoryLog').click(function () {                
				getHistoryLog();			//顯示更改歷史記錄
				$('#dialog_ShowHistoryLog').modal('show');				
            })

			//顯示協助工程師設定popup
            $('#btn_pjAssEngineer').click(function () {
                $('#dialog_pjAssEngineer').modal('show');
            })

			//顯示技術主管設定popup
            $('#btn_pjTechManager').click(function () {
                $('#dialog_pjTechManager').modal('show');
            })

			//顯示服務團隊設定popup
            $('#btn_pjTeam').click(function () {
                $('#dialog_pjTeam').modal('show');
            })				
			

			var pIsCanEditSR = $("#hid_pIsCanEditSR").val();
			var cSRID = $("input[name='hid_cSRID']").val();
			var ddl_cStatus = $("#ddl_cStatus");

			if (cSRID == "") //若沒有SRID，則不准許調整【狀態】
			{					
				disabledPopup("#form1", false);
				ddl_cStatus.prop('disabled', true);

				$("#btn_submit").show();
				$("#btn_submitUP").show();
				$("#btn_Edit").hide();
				$("#btn_CopySRID").hide();
				$("#btn_ShowHistoryLog").hide();
			}
			else
			{				
				disabledPopup("#form1", true);
				
				$("#btn_CopySRID").show();
				$("#btn_CopySRID").prop('disabled', false);
				$("#btn_ShowHistoryLog").show();
				$("#btn_ShowHistoryLog").prop('disabled', false);				

				$("#btn_submit").hide();
				$("#btn_submitUP").hide();

				if (pIsCanEditSR == "True")
				{
					$("#btn_Edit").show();
					$("#btn_Edit").prop('disabled', false);
				}
				else
				{
					$("#btn_Edit").hide();
				}
			}
		}	
		
		function initContactTable() {
			$('#tableContact').DataTable({
				language: {
					"lengthMenu": "每頁顯示筆數 _MENU_ ",
					"info": "顯示第 _START_ 到 _END_ 筆，全部共 _TOTAL_ 筆",
					"search": " 關鍵字篩選"
				},
				pageLength: 25,
				responsive: true,
				order: [[0, "desc"]],
				dom: '<"html5buttons"B>lTfgitp',
				buttons: [
					{
						extend: 'excel',
						title: 'ExampleFile',
						text: '匯出Excel',
						customize: function (xlsx) {
							var sheet = xlsx.xl.worksheets['sheet1.xml'];
							$('row c[r^="B"]', sheet).attr('s', '2');
						}
					}
				]
			});
		}		

		//顯示剩餘字數
        function showRemainWords(obj, maxLength, remainWord) {
            $(remainWord).show();
            var len = obj.value.length;
            if (len > 0) {
                $(remainWord).html("剩餘字數: " + (maxLength - len));
            }
            if (len > maxLength) {
                $(remainWord).html("已超過字數上限: " + (len - maxLength));
            }
        }

        //隱藏剩餘字數
        function hideRemainWords(obj) {
            $(obj).html('');
            $(obj).hide();
        }

		//popup各欄位reset
		function resetPopup(popupId) {
			$(popupId).find("input").each(function (index, value) {
				$(this).val("");
			});
			$(popupId).find("select").each(function (index, value) {
				$(this).val("-1");
			});
			$(popupId).find("textarea").each(function (index, value) {
				$(this).val("");
			});
			$(popupId).find(".file-box").each(function (index, value) {
				$(this).remove();
			});
		}

		//popup各欄位disabled
		//popupId.傳入的obj、IsDisabled(true.不准許輸入 false.准許輸入)
		function disabledPopup(popupId, IsDisabled) {
			var cNowStatus = $("#hid_cNowStatus").val(); //目前狀態

			$(popupId).find("input").each(function (index, value) {				
				var reValue = checkInputSkipList($(this).attr("name"));				
				if (!reValue){
					$(this).prop('disabled', IsDisabled);
				}
			});

			$(popupId).find("select").each(function (index, value) {
				var reValue = checkSelectSkipList($(this).attr("name"));				
				if (!reValue){
					$(this).prop('disabled', IsDisabled);
				}
			});

			$(popupId).find("button").each(function (index, value) {
				var reValue = checkButtonSkipList($(this).attr("name"));				
				if (!reValue){
					$(this).prop('disabled', IsDisabled);
				}
			});			

			$(popupId).find("textarea").each(function (index, value) {
				var reValue = checkTextareaSkipList($(this).attr("name"));				
				if (!reValue){
					$(this).prop('disabled', IsDisabled);
				}
			});

			var IsCSMAnagerCanEdit = false;
			if ("@ViewBag.pIsCSManager" == "True" || "@ViewBag.pIsMIS" == "True")
			{
				IsCSMAnagerCanEdit = true;
			}

			if (IsCSMAnagerCanEdit && IsDisabled == false)
			{
				$(".Fault").prop('disabled', false);	
				$('.Fault').iCheck('update'); //讓checkbox有作用
			}
			else
			{
				//L2處理中且按下編輯時，才准許修改
				if (cNowStatus == "E0002" && IsDisabled == false)
				{
					$(".Fault").prop('disabled', false);	
					$('.Fault').iCheck('update'); //讓checkbox有作用
				}
				else
				{
					$(".Fault").prop('disabled', true);
				}
			}

			setTimeout(function () {
                if (IsDisabled)
				{
					$(".dropzone").hide();
					$(".btn-del").hide();
				}
				else
				{
					$(".dropzone").show();
					$(".btn-del").show();
				}
            }, 500);
			

			//檔案相關 Start
			//$(popupId).find(".dropzone").each(function (index, value) {
			//	if (IsDisabled){
			//		$(this).hide();
			//	}
			//	else{
			//		$(this).show();
			//	}
			//});

			//$(popupId).find(".attachment").each(function (index, value) {
			//	if (IsDisabled){
			//		$(this).hide();
			//	}
			//	else{
			//		$(this).show();
			//	}
			//});
			//檔案相關 End
		}

		//要略過的清單(Input)
		function checkInputSkipList(tID)
		{
			var ArrayList = ["tbx_cRepairAddress", "tbx_cRepairPhone", "tbx_cRepairEmail", "tbx_cRepairMobile", "tbx_cTeamName", "tbx_cAssEngineerName", "tbx_cTechManagerName", "tbx_REcWorkHours", "tbx_cFaultGroupNote1", "tbx_cFaultGroupNote2", "tbx_cFaultGroupNote3", "tbx_cFaultGroupNote4", "tbx_cFaultGroupNoteOther", "tbx_cFaultStateNote1", "tbx_cFaultStateNote2", "tbx_cFaultStateNoteOther", "tbx_cFaultSpecNote1", "tbx_cFaultSpecNote2", "tbx_cFaultSpecNoteOther", "chk_cFaultGroup1", "chk_cFaultGroup2", "chk_cFaultGroup3", "chk_cFaultGroup4", "chk_cFaultGroupOther", "chk_cFaultState1", "chk_cFaultState2", "chk_cFaultStateOther", "chk_cFaultSpec1", "chk_cFaultSpec2", "chk_cFaultSpecOther"]; 
			return SkiptList(tID, ArrayList);
		}

		//要略過的清單(select)
		function checkSelectSkipList(tID)
		{
			var ArrayList = ["ddl_cSRPathWay", "ddl_cCustomerType"];
			return SkiptList(tID, ArrayList);
		}

		//要略過的清單(button)
		function checkButtonSkipList(tID)
		{
			var ArrayList = ["btn_ShowHistoryLog", "btn_CopySRID", "btn_showRepairInfo", "btn_clearRepairInfo", "btn_addRepairInfo", "btn_addContactInfo", "btn_editRepairInfo", "btn_editContactInfo", "btn_CopyContactInfo", "btn_pjTeam", "btn_pjAssEngineer", "btn_pjTechManager"];
			return SkiptList(tID, ArrayList);
		}		

		//要略過的清單(textarea)
		function checkTextareaSkipList(tID)
		{
			//先不略過
			//var ArrayList = ["tbx_PAcMaterialName"]; 			
			//return SkiptList(tID, ArrayList);
		}		

		//執行要略過的清單
		function SkiptList(tID, ArrayList)
		{	
			var tIsExits = false;

			ArrayList.every(function(v){
				if(v == tID) {
					tIsExits = true;
					return false;
				}
				else{ 
					return true;
				}
			});

			return tIsExits;
		}		
		
		//更改歷史記錄動態載入時，要呼叫此方法，頁籤才可以收合
		function callCollapse()
		{
			// Collapse ibox function
			$('.collapse-linkZ').on('click', function (e) {
				e.preventDefault();
				var ibox = $(this).closest('div.ibox');
				var button = $(this).find('i');
				var content = ibox.children('.ibox-content');
				content.slideToggle(200);
				button.toggleClass('fa-chevron-up').toggleClass('fa-chevron-down');
				ibox.toggleClass('').toggleClass('border-bottom');
				setTimeout(function () {
					ibox.resize();
					ibox.find('[id^=map-]').resize();
				}, 50);
			});			
		}

		//更改L2處理中載入時，要呼叫此方法，頁籤才可以收合
		function callCollapseL2()
		{
			//先註冊L2處理中開合頁籤
			// Collapse ibox function
			$('.collapse-linkL2').on('click', function (e) {
				e.preventDefault();
				var ibox = $(this).closest('div.ibox');
				var button = $(this).find('i');
				var content = ibox.children('.ibox-content');
				content.slideToggle(200);
				button.toggleClass('fa-chevron-up').toggleClass('fa-chevron-down');
				ibox.toggleClass('').toggleClass('border-bottom');
				setTimeout(function () {
					ibox.resize();
					ibox.find('[id^=map-]').resize();
				}, 50);
			});		
			
			if ($("#hid_cNowStatus").val() == "E0002") //目前狀態為L2處理中就要觸發(開頁籤)
			{
				$('.collapse-linkL2').click();
			}			
			else 
			{
				if ($("#hid_cFaultGroup").val() != "") //判斷若客戶故障狀況分類有勾選，就要觸發L2處理中(開頁籤)
				{						
					$('.collapse-linkL2').click();
				}
			}
		}

		//呼叫日期轉換
		function TransDate(Obj)
		{
			if (Obj != null)
			{
				return getDateString(new Date(Obj));
			}

			return "";
		}

		//日期Format(補0)
		function pad(v){
			return (v<10)?'0'+v:v
		}		

		//日期Format
		function getDateString(d){		 
			try {
				  var year = d.getFullYear();
				  var month = pad(d.getMonth()+1);
				  var day = pad(d.getDate());
				  var hour = pad(d.getHours());
				  var min = pad(d.getMinutes());
				  var sec = pad(d.getSeconds());	
		  
				  return year + "-" + month + "-" + day + " " + hour + ":" + min + ":" + sec;
			}
			catch (e) {
				return "";
			}
		}

		//查詢更改歷史記錄
		function getHistoryLog()
		{
			var cSRID = $("input[name='hid_cSRID']").val();			//SRID
			var cCustomerID = $("#hid_cCustomerID").val();			//客戶ID
            
			$.ajax({
				url: '@Url.Action("GetHistoryLog", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {                    
					cSRID : cSRID,
					cCustomerID: cCustomerID
                },
                success: function (result) {
                    var ALLList = ""
					var listOneLog = "";
					var listContactChangLog = "";
					var listContact = "";
					var listProduct = "";
					var listRecord = "";
					var listPartsReplace = "";
					
					//↓↓↓↓↓歷史記錄資訊(共用) ↓↓↓↓↓/
					$.each(result.srOneLog, function (i, bean) {
                        if (bean != null) {                    
							var tDate = TransDate(bean.createdDate);
							var strLog = bean.log.replace(/\n/g,"<br />");

                            listOneLog += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cSrid + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.eventName + "</td>"
                                + "<td style='vertical-align: left;'>" + strLog + "</td>"
                                + "<td style='vertical-align: left;'>" + tDate + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.createdUserName + "</td>"                                
                            + "</tr>";
						}
                    });

                    if (listOneLog != "") {
                        listOneLog = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>報修主檔資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>SRID</th>"
                            + "				<th>事件名稱</th>"
                            + "				<th>Log</th>"
                            + "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"                                
                            + "				</tr></thead><tbody>"
                            + listOneLog
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑歷史記錄資訊(共用) ↑↑↑↑↑/

					//↓↓↓↓↓聯絡人主檔異動資訊(共用) ↓↓↓↓↓/
					$.each(result.srContactChangLog, function (i, bean) {
                        if (bean != null) {                    
							var tDate = TransDate(bean.createdDate);
							var strLog = bean.log.replace(/\n/g,"<br />");

                            listContactChangLog += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cSrid + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.eventName + "</td>"
                                + "<td style='vertical-align: left;'>" + strLog + "</td>"
                                + "<td style='vertical-align: left;'>" + tDate + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.createdUserName + "</td>"                                
                            + "</tr>";
						}
                    });

                    if (listContactChangLog != "") {
                        listContactChangLog = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>聯絡人主檔異動資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content' style='display:none;'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>SRID</th>"
                            + "				<th>事件名稱</th>"
                            + "				<th>Log</th>"
                            + "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"                                
                            + "				</tr></thead><tbody>"
                            + listContactChangLog
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑聯絡人主檔異動資訊(共用) ↑↑↑↑↑/

					//↓↓↓↓↓客戶聯絡窗口資訊(共用) ↓↓↓↓↓/
					$.each(result.srDetailContact, function (i, bean) {
                        if (bean != null) {
							var tDate = TransDate(bean.modifiedDate);

                            listContact += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cContactName + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cContactAddress + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cContactPhone + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cContactMobile + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cContactEmail + "</td>"                                
								+ "<td style='vertical-align: left;'>" + tDate + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.modifiedUserName + "</td>"
                            + "</tr>";
						}
                    });

                    if (listContact != "") {
                        listContact = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>客戶聯絡窗口資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content' style='display:none;'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>聯絡人姓名</th>"
                            + "				<th>聯絡人地址</th>"
                            + "				<th>聯絡人電話</th>"
                            + "				<th>聯絡人手機</th>"
                            + "				<th>聯絡人E-Mail</th>"  
							+ "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"
                            + "				</tr></thead><tbody>"
                            + listContact
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑客戶聯絡人資訊(共用) ↑↑↑↑↑/

					//↓↓↓↓↓產品序號資訊(一般) ↓↓↓↓↓/
					$.each(result.srDetailProduct, function (i, bean) {
                        if (bean != null) {
							var tDate = TransDate(bean.modifiedDate);

                            listProduct += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cSerialId + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cMaterialName + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cProductNumber + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cMaterialId + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cNewSerialId + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cInstallId + "</td>"
								+ "<td style='vertical-align: left;'>" + tDate + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.modifiedUserName + "</td>"
                            + "</tr>";
						}
                    });

                    if (listProduct != "") {
                        listProduct = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>產品序號資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content' style='display:none;'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>序號</th>"
                            + "				<th>機器型號</th>"
                            + "				<th>Product Number</th>"
                            + "				<th>料號</th>"
                            + "				<th>更換後序號</th>"  
							+ "				<th>裝機資訊</th>"  
							+ "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"
                            + "				</tr></thead><tbody>"
                            + listProduct
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑產品序號資訊(一般) ↑↑↑↑↑/

					//↓↓↓↓↓處理與工時紀錄資訊(共用) ↓↓↓↓↓/
					$.each(result.srDetailRecord, function (i, bean) {
                        if (bean != null) {
							var tDateR = TransDate(bean.cReceiveTime);
							var tDateS = TransDate(bean.cStartTime);
							var tDateA = TransDate(bean.cArriveTime);
							var tDateF = TransDate(bean.cFinishTime);
							var tDate = TransDate(bean.modifiedDate);

                            listRecord += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cEngineerName + "</td>"
                                + "<td style='vertical-align: left;'>" + tDateR + "</td>"
                                + "<td style='vertical-align: left;'>" + tDateS + "</td>"
                                + "<td style='vertical-align: left;'>" + tDateA + "</td>"
                                + "<td style='vertical-align: left;'>" + tDateF + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cWorkHours + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cDesc + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cSrreport + "</td>"
								+ "<td style='vertical-align: left;'>" + tDate + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.modifiedUserName + "</td>"
                            + "</tr>";
						}
                    });

                    if (listRecord != "") {
                        listRecord = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>處理與工時紀錄資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content' style='display:none;'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>服務工程師</th>"
                            + "				<th>接單時間</th>"
                            + "				<th>出發時間</th>"
                            + "				<th>到場時間</th>"
                            + "				<th>完成時間</th>"  
							+ "				<th>工時(分鐘)</th>"  
							+ "				<th>處理紀錄</th>"  
							+ "				<th>服務報告書</th>"  
							+ "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"
                            + "				</tr></thead><tbody>"
                            + listRecord
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑處理與工時紀錄資訊(共用) ↑↑↑↑↑/

					//↓↓↓↓↓零件更換資訊(一般) ↓↓↓↓↓/
					$.each(result.srDetailPartsReplace, function (i, bean) {
                        if (bean != null) {														
							var tDateA = TransDate(bean.cArriveDate);
							var tDateR = TransDate(bean.cReturnDate);							
							var tDate = TransDate(bean.modifiedDate);

                            listPartsReplace += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cXchp + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cMaterialId + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cMaterialName + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cOldCt + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cNewCt + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cHpct + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cNewUefi  + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cStandbySerialId + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cHpcaseId + "</td>"
								+ "<td style='vertical-align: left;'>" + tDateA + "</td>"
								+ "<td style='vertical-align: left;'>" + tDateR + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cPersonalDamage + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cNote + "</td>"
								+ "<td style='vertical-align: left;'>" + tDate + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.modifiedUserName + "</td>"
                            + "</tr>";
						}
                    });

                    if (listPartsReplace != "") {
                        listPartsReplace = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>零件更換資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content' style='display:none;'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>XC HP申請零件</th>"
                            + "				<th>更換零件料號ID</th>"
                            + "				<th>料號說明</th>"
                            + "				<th>Old CT</th>"
                            + "				<th>New CT</th>"  
							+ "				<th>HP CT</th>"  
							+ "				<th>UEFI(新)</th>"  
							+ "				<th>備機序號</th>"  
							+ "				<th>HP Case ID</th>"  
							+ "				<th>到貨日</th>"  
							+ "				<th>歸還日</th>"  
							+ "				<th>是否有人損</th>"  
							+ "				<th>備註</th>"  
							+ "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"
                            + "				</tr></thead><tbody>"
                            + listPartsReplace
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑零件更換資訊(一般) ↑↑↑↑↑/

					ALLList += listOneLog + listContactChangLog + listContact + listProduct + listRecord + listPartsReplace;

                    $("#tb_ShowHistoryLog").html(ALLList);  
					callCollapse();
                }
			});
		}
		
		//確認提交事件
		function onclickBtnSave() {
			if (checkBeforeSend()) 
			{ 
				getSRID(); 
			}			
		}

		//產生SRID
		function getSRID() {
			var cTitle = "61";	//SRID開頭編號(一般服務)
			var cSRID = $("input[name='hid_cSRID']").val();
			var cGUID = $("input[name='hid_cSystemGUID']").val();

			$.ajax({
				url: '@Url.Action("getSRID", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
				async: false,
				data: { cTitle: cTitle, cSRID: cSRID, cGUID: cGUID },
				success: function (result) {
					if (result != "") {
						if (result == "CHANGE") {
							alert("【資料已被其他人異動】，請關閉頁面後再重新登入此表單！！");
							$("#waitingImg").hide();
							$("#waitingImgUP").hide();
							event.returnValue = false;
						}
						else {
							$("input[name='hid_cSRID']").val(result);
							$("#form1").submit();
						}
					}
					else {
						alert("產生SRID失敗！");
						$("#waitingImg").hide();
						$("#waitingImgUP").hide();
						event.returnValue = false;
					}
				}
			})
		}		

		//按下編輯事件
		function EditSRID()
		{
			$("#btn_Edit").hide();
			$("#btn_submit").show();
			$("#btn_submitUP").show();

			disabledPopup("#form1", false);
			getFaultInfo(true);

			//$("#tbx_cCustomerName").prop('disabled', true); //客戶名稱不得編輯
		}

		 //送出前檢查
		function checkBeforeSend() {

			$("#btn_submit").hide();
			$("#btn_submitUP").hide();
			$("#waitingImg").show();
			$("#waitingImgUP").show();

			var Msg = "";
			var cSRID = $("input[name='hid_cSRID']").val();			//SRID
			var cNowStatus = $("#hid_cNowStatus").val();			//目前狀態
			var ddl_cStatus = $("#ddl_cStatus");					//下拉後的狀態			
			var tbx_cCustomerName = $("#tbx_cCustomerName");			//客戶名稱	
			var hid_cCustomerID = $("#hid_cCustomerID");			//客戶ID							
			var tbx_cDesc = $("#tbx_cDesc");						//說明
			var tbx_cNotes = $("#tbx_cNotes");						//詳細描述
			var ddl_cMAServiceType = $("#ddl_cMAServiceType");		//維護服務種類
			var ddl_cSRTypeOne = $("#ddl_cSRTypeOne");				//報修類別(大類)
			var ddl_cSRTypeSec = $("#ddl_cSRTypeSec");				//報修類別(中類)
			var ddl_cSRTypeThr = $("#ddl_cSRTypeThr");				//報修類別(小類)
			var ddl_cSRPathWay = $("#ddl_cSRPathWay");				//報修管道
			var ddl_cSRProcessWay = $("#ddl_cSRProcessWay");			//處理方式
			var tbx_cDelayReason =  $("#tbx_cDelayReason");			//延遲結案原因
			var hid_cNowScheduleDate = $("#hid_cNowScheduleDate");	//目前預排日期值
			var tbx_cScheduleDate = $("#tbx_cScheduleDate");			//預排日期

			var tbx_cRepairName = $("#tbx_cRepairName");			//姓名(報修人)
			var tbx_cRepairAddress = $("#tbx_cRepairAddress");		//地址(報修人)
			var tbx_cRepairPhone = $("#tbx_cRepairPhone");			//電話(報修人)
			var tbx_cRepairMobile = $("#tbx_cRepairMobile");			//手機(報修人)
			//var tbx_cRepairEmail	= $("#tbx_cRepairEmail");			//Email(報修人)			

			var hid_cTeamID = $("#hid_cTeamID");					//服務團隊
			var tbx_cMainEngineerName = $("#tbx_cMainEngineerName");	//主要工程師
			var hid_cMainEngineerID = $("#hid_cMainEngineerID");		//主要工程師ERPID
			var tbx_cSalesName = $("#tbx_cSalesName");				//業務人員
			var hid_cSalesID = $("#hid_cSalesID");					//業務人員ERPID

			if (ddl_cStatus.val() == "") {
				Msg += "請選擇【狀態】！\n";
			}
			else
			{
				if (cSRID != "")
				{
					if (ddl_cStatus.val() == "E0001") {
						Msg += "【狀態】不得為新建，請重新選擇！\n";
					}
				}
			}

			if (tbx_cCustomerName.val() == "") {
				Msg += "【客戶名稱】不得為空！\n";
			}

			if (hid_cCustomerID.val() == "") {
				Msg += "您未下拉選取【客戶名稱】，請輸入關鍵字後再重新選取！\n";
			}
			
			if (tbx_cDesc.val() == "") {
				Msg += "【說明】不得為空！\n";
			}

			if (tbx_cNotes.val() == "") {
				Msg += "【詳細描述】不得為空！\n";
			}

			if (ddl_cMAServiceType.val() == "") {
				Msg += "【維護服務種類】不得為空！\n";
			}

			if (ddl_cStatus.val() == "E0006") //選完修才卡控
			{
				if (ddl_cSRTypeOne.val() == "") {
					Msg += "請選擇【報修類別(大類)】！\n";
				}

				if (ddl_cSRTypeSec.val() == "") {
					Msg += "請選擇【報修類別(中類)】！\n";
				}
			}

			//if (ddl_cSRTypeOne.val() != "ZA05" && ddl_cSRTypeOne.val() != "ZA06")
			//{
			//	if (ddl_cSRTypeThr.val() == "") {
			//		Msg += "請選擇【報修類別(小類)】！\n";
			//	}
			//}

			if (ddl_cSRPathWay.val() == "") {
				Msg += "請選擇【報修管道】！\n";
			}

			//if (ddl_cSRProcessWay.val() == "") {
			//	Msg += "請選擇【處理方式】！\n";
			//}

			if (tbx_cRepairName.val() == "") {
				Msg += "【姓名(報修人)】不得為空！\n";
			}

			if (tbx_cRepairAddress.val() == "") {
				Msg += "【地址(報修人)】不得為空！\n";
			}

			//if (tbx_cRepairPhone.val() == "" && tbx_cRepairMobile.val() == "") {
			//	Msg += "【電話(報修人)】【手機(報修人)】請至少擇一輸入！\n";
			//}			

			//if (tbx_cRepairEmail.val() == "") {
			//	Msg += "【Email(報修人)】不得為空！\n";
			//}			

			if (hid_cTeamID.val() == "") {
				Msg += "請選擇【服務團隊】！\n";
			}

			if (tbx_cMainEngineerName.val() == "") {
				Msg += "【主要工程師】不得為空！\n";
			}

			if (hid_cMainEngineerID.val() == "") {
				Msg += "您未下拉選取【主要工程師】，請輸入關鍵字後再重新選取！\n";
			}

			if (tbx_cSalesName.val() != "") {
				if (hid_cSalesID.val() == "") {
					Msg += "您未下拉選取【計費業務】，請輸入關鍵字後再重新選取！\n";
				}
			}			

			//提交前【主要工程師姓名和ERPID】是否不一致
			Msg += checkPersonIsMatch("M");

			//提交前【計費業務姓名和ERPID】是否不一致
			Msg += checkPersonIsMatch("S");

			//【L2處理中-客戶故障狀況分類資訊】檢查
			if (cNowStatus == "E0002") //L2處理中
			{
				Msg += checkL2Fault();
			}			

			//預排日期檢查
			if (cNowStatus != "E0006" && cNowStatus != "E0015") //非完修且非取消才檢查
			{
				if (tbx_cDelayReason.val() != "" && hid_cNowScheduleDate.val() == "")
				{
					if (tbx_cScheduleDate.val() == "")
					{
						Msg += "【預排日期】不得為空！\n";
					}
					else
					{
						var Today = new Date();
						var NowDay = new Date(Today.getFullYear() + "-" + (Today.getMonth() + 1) + "-" + Today.getDate());
						var NowScheduleDate = new Date(tbx_cScheduleDate.val());

						if (NowScheduleDate < NowDay) {
							Msg += "【預排日期】不能小於系統日期！\n";							
						}
					}
				}
			}	

			//【聯絡人窗口資訊】明細檢查
			Msg += checkDetail_CO();

			//【產品序號資訊】明細檢查
			Msg += checkDetail_PR();

			//提交前【保固SLA資訊】的序號，是否都有含在【產品序號資訊】
			Msg += checkDetail_WA();

			//【處理與工時紀錄】明細檢查
			Msg += checkDetail_PE();

			//【零件更換資訊】明細檢查
			Msg += checkDetail_PA();

			if (Msg != "") {
				alert(Msg);
				
				$("#btn_submit").show();
				$("#btn_submitUP").show();
				$("#waitingImg").hide();
				$("#waitingImgUP").hide();
				return false;
			}
			else {
				SetAllobjEnabledorDisabled(false); 
			}

			return true;
		}

		//提交前【姓名和ERPID】是否不一致
		//tType：M.主要工程師 S.業務人員 ASS.祕書人員
		function checkPersonIsMatch(tType)
		{
			var Msg = "";
			var cERPID = "";
			var cEName = "";

			var tbx_cMainEngineerName = $("#tbx_cMainEngineerName");	//主要工程師
			var hid_cMainEngineerID = $("#hid_cMainEngineerID");		//主要工程師ERPID		
			var tbx_cSalesName = $("#tbx_cSalesName");				//業務人員
			var hid_cSalesID = $("#hid_cSalesID");					//業務人員ERPID
			var tbx_cSecretaryName = $("#tbx_cSecretaryName");		//業務祕書
			var hid_cSecretaryID = $("#hid_cSecretaryID");			//業務祕書ERPID

			if (tType == "M") //主要工程師
			{
				cERPID = hid_cMainEngineerID.val();
				cEName = tbx_cMainEngineerName.val();
			}
			else if (tType == "S") //業務人員
			{
				cERPID = hid_cSalesID.val();
				cEName = tbx_cSalesName.val();
			}
			else if (tType == "ASS") //業務祕書
			{
				cERPID = hid_cSecretaryID.val();
				cEName = tbx_cSecretaryName.val();
			}

			if (cEName != "")
			{
				$.ajax({
					url: '@Url.Action("checkPersonIsMatch", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
					async: false,
					data: { 
						cERPID: cERPID, 
						cEName: cEName,
						tType: tType
					},
					success: function (result) {
						if (result != "") {
							Msg = result;
						}
					}
				})
			}

			return Msg;			 
		}

		//提交前【L2處理中-客戶故障狀況分類資訊】檢查
		function checkL2Fault()
		{
			var Msg = "";
			var tGroup = "";
			var tState = "";
			var tSpec = "";

			var hid_cFaultGroup = $("#hid_cFaultGroup");
			var hid_cFaultGroup1 = $("#hid_cFaultGroup1");
			var hid_cFaultGroup2 = $("#hid_cFaultGroup2");
			var hid_cFaultGroup3 = $("#hid_cFaultGroup3");
			var hid_cFaultGroup4 = $("#hid_cFaultGroup4");
			var hid_cFaultGroupOther = $("#hid_cFaultGroupOther");
			var hid_cFaultState = $("#hid_cFaultState");
			var hid_cFaultState1 = $("#hid_cFaultState1");
			var hid_cFaultState2 = $("#hid_cFaultState2");
			var hid_cFaultStateOther = $("#hid_cFaultStateOther");
			var hid_cFaultSpec = $("#hid_cFaultSpec");
			var hid_cFaultSpec1 = $("#hid_cFaultSpec1");
			var hid_cFaultSpec2 = $("#hid_cFaultSpec2");
			var hid_cFaultSpecOther = $("#hid_cFaultSpecOther");

			var tbx_cFaultGroupNote1 = $("#tbx_cFaultGroupNote1");
			var tbx_cFaultGroupNote2 = $("#tbx_cFaultGroupNote2");
			var tbx_cFaultGroupNote3 = $("#tbx_cFaultGroupNote3");
			var tbx_cFaultGroupNote4 = $("#tbx_cFaultGroupNote4");
			var tbx_cFaultGroupNoteOther = $("#tbx_cFaultGroupNoteOther");
			var tbx_cFaultStateNote1 = $("#tbx_cFaultStateNote1");
			var tbx_cFaultStateNote2 = $("#tbx_cFaultStateNote2");
			var tbx_cFaultStateNoteOther = $("#tbx_cFaultStateNoteOther");
			var tbx_cFaultSpecNote1 = $("#tbx_cFaultSpecNote1");
			var tbx_cFaultSpecNote2 = $("#tbx_cFaultSpecNote2");
			var tbx_cFaultSpecNoteOther = $("#tbx_cFaultSpecNoteOther");

			if (hid_cFaultGroup1.val() != "Y" && hid_cFaultGroup2.val() != "Y" && hid_cFaultGroup3.val() != "Y" && hid_cFaultGroup4.val() != "Y" && hid_cFaultGroupOther.val() != "Y")
			{
				Msg += "【客戶故障狀況分類】請至少勾選一項！\n";
			}

			if (hid_cFaultState1.val() != "Y" && hid_cFaultState2.val() != "Y" && hid_cFaultStateOther.val() != "Y")
			{
				Msg += "【客戶故障狀況】請至少勾選一項！\n";
			}

			if (hid_cFaultSpec1.val() != "Y" && hid_cFaultSpec2.val() != "Y" && hid_cFaultSpecOther.val() != "Y")
			{
				Msg += "【故障零件規格料號】請至少勾選一項！\n";
			}

			//客戶故障狀況分類
			if (hid_cFaultGroup1.val() == "Y")
			{
				tGroup += "Z01;";

				if (tbx_cFaultGroupNote1.val() == "")
				{
					Msg += "客戶故障狀況分類-【硬體】說明不得為空！\n";
				}
			}

			if (hid_cFaultGroup2.val() == "Y")
			{
				tGroup += "Z02;";

				if (tbx_cFaultGroupNote2.val() == "")
				{
					Msg += "客戶故障狀況分類-【系統】說明不得為空！\n";
				}
			}

			if (hid_cFaultGroup3.val() == "Y")
			{
				tGroup += "Z03;";

				if (tbx_cFaultGroupNote3.val() == "")
				{
					Msg += "客戶故障狀況分類-【服務】說明不得為空！\n";
				}
			}

			if (hid_cFaultGroup4.val() == "Y")
			{
				tGroup += "Z04;";

				if (tbx_cFaultGroupNote4.val() == "")
				{
					Msg += "客戶故障狀況分類-【網路】說明不得為空！\n";
				}
			}

			if (hid_cFaultGroupOther.val() == "Y")
			{
				tGroup += "Z99;";

				if (tbx_cFaultGroupNoteOther.val() == "")
				{
					Msg += "客戶故障狀況分類-【其他】說明不得為空！\n";
				}
			}			

			//客戶故障狀況
			if (hid_cFaultState1.val() == "Y")
			{
				tState += "Z01;";
				
				if (tbx_cFaultStateNote1.val() == "")
				{
					Msg += "客戶故障狀況-【面板燈號】說明不得為空！\n";
				}
			}

			if (hid_cFaultState2.val() == "Y")
			{
				tState += "Z02;";

				if (tbx_cFaultStateNote2.val() == "")
				{
					Msg += "客戶故障狀況-【管理介面(iLO、IMM、iDRAC)】說明不得為空！\n";
				}
			}

			if (hid_cFaultStateOther.val() == "Y")
			{
				tState += "Z99;";

				if (tbx_cFaultStateNoteOther.val() == "")
				{
					Msg += "客戶故障狀況-【其他】說明不得為空！\n";
				}
			}

			//故障零件規格料號
			if (hid_cFaultSpec1.val() == "Y")
			{
				tSpec += "Z01;";

				if (tbx_cFaultSpecNote1.val() == "")
				{
					Msg += "故障零件規格料號-【零件規格】說明不得為空！\n";
				}
			}

			if (hid_cFaultSpec2.val() == "Y")
			{
				tSpec += "Z02;";

				if (tbx_cFaultSpecNote2.val() == "")
				{
					Msg += "故障零件規格料號-【零件料號】說明不得為空！\n";
				}
			}

			if (hid_cFaultSpecOther.val() == "Y")
			{
				tSpec += "Z99;";

				if (tbx_cFaultSpecNoteOther.val() == "")
				{
					Msg += "故障零件規格料號-【其他】說明不得為空！\n";
				}
			}

			if (Msg == "")
			{				
				hid_cFaultGroup.val(tGroup);
				hid_cFaultState.val(tState);
				hid_cFaultSpec.val(tSpec);
			}

			return Msg;	
		}

		//提交前【聯絡人窗口資訊】明細檢查
		function checkDetail_CO() {
			var Msg = "";
			var cStatus = $("#ddl_cStatus").val();						
            var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別
			var tCount = 0; //記錄目前有效的明細

			var tableName = "tableCO";
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');
				var tIsError = false;								//記錄是否有錯誤
				var objRowNumber = tds.eq(0).children();			//項次
				var objContactName = tds.eq(1).children().eq(0);	//姓名(聯絡人)
				var objDisabled = tds.eq(1).children().eq(1);		//是否停用(0.啟用 1.停用)				
				var objContactAddress = tds.eq(2).children();		//地址(聯絡人)
				var objContactPhone = tds.eq(3).children();		//電話(聯絡人)
				var objContactMoblie = tds.eq(4).children();		//手機(聯絡人)
				//var objContactEmail = tds.eq(5).children();		//E-Mail(聯絡人)

				if (objContactName.val() != undefined) {                    
					if (objDisabled.val() == "0"){
						if (objContactName.val() == "") {
							Msg += "明細【聯絡人窗口資訊】「項次：" + objRowNumber.html() + "」的【姓名(聯絡人)】不得為空！\n";
							tIsError = true;
						}						

						if (objContactAddress.val() == "") {
							Msg += "明細【聯絡人窗口資訊】「項次：" + objRowNumber.html() + "」的【地址(聯絡人)】不得為空！\n";
							tIsError = true;
						}							
						
						//if (objContactPhone.val() == "" && objContactMoblie.val() == "") {
						//	Msg += "明細【聯絡人窗口資訊】「項次：" + objRowNumber.html() + "」的【電話、手機(聯絡人)】請至少擇一輸入！\n";
						//	tIsError = true;
						//}

						if (!tIsError)
						{
							tCount++;
						}

						//if (objContactEmail.val() == "") {
						//	Msg += "明細【聯絡人窗口資訊】「項次：" + objRowNumber.html() + "」的【E-Mail(聯絡人)】不得為空！\n";
						//}						
					}
                }				
			})	
			
			if (tCount == 0)
			{
				Msg += "請至少新增一筆【客戶聯絡窗口資訊】明細！\n";
			}

			return Msg;
		}

		//提交前【產品序號資訊】明細檢查
		function checkDetail_PR() {
			var Msg = "";
			var ddl_cStatus = $("#ddl_cStatus");							  //下拉後的狀態					
            var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別
			var tCount = 0; //記錄目前有效的明細

			var tableName = "tablePR";
			var trs = $("#" + tableName + " tr");

			AryPNowPrSERIAL = new Array();	//初始目前產品的序號

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');
				var tIsError = false;								//記錄是否有錯誤
				var objRowNumber = tds.eq(0).children();			//項次
				var objSerialID = tds.eq(1).children().eq(0);		//序號
				var objDisabled = tds.eq(1).children().eq(1);		//是否停用(0.啟用 1.停用)				
				var objMaterialName = tds.eq(2).children();		//機器型號					

				if (objSerialID.val() != undefined) {                    
					if (objDisabled.val() == "0"){
						if (ddl_cStatus.val() == "E0006") //選完修才卡控
						{
							if (objSerialID.val() == "") {
								Msg += "明細【產品序號資訊】「項次：" + objRowNumber.html() + "」的【序號】不得為空！\n";
								tIsError = true;
							}						

							if (objMaterialName.val() == "") {
								Msg += "明細【產品序號資訊】「項次：" + objRowNumber.html() + "」的【機器型號】不得為空！\n";
								tIsError = true;
							}	
						}
							
						if (Msg == ""){
							if (objSerialID.val() != "")
							{
								AryPNowPrSERIAL.push(objSerialID.val());
							}
						}

						if (!tIsError)
						{
							tCount++;
						}
					}
                }				
			})	
			
			if (tCount == 0)
			{
				Msg += "請至少新增一筆【產品序號資訊】明細！\n";
			}

			return Msg;
		}

		//提交前【保固SLA資訊】的序號，是否都有含在【產品序號資訊】
		function checkDetail_WA() {
			var Msg = "";
			var cStatus = $("#ddl_cStatus").val();			
            var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別

			var tableName = "tableADDWA";
			var trs = $("#" + tableName + " tr");

			var AryTemp = new Array();			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');				
				var objSerialID = tds.eq(0).children();	//序號				

				if (objSerialID.val() != undefined) {
                    AryTemp.push(objSerialID.val());					
                }					
			})

			AryPNowWASERIAL = MergeArrayString(AryTemp);	//合併Array字串並去除重覆，再回傳Array
			
			var WALen = AryPNowWASERIAL.length;
			var PrLen = AryPNowPrSERIAL.length;			
			var tCount = 0 ;

			//比對序號
			 for(var i = 0; i < WALen; i++) 
			 {
				var tIsMatch = false;

				for(var j = 0; j < PrLen; j++) 
				{
					if (AryPNowWASERIAL[i] == AryPNowPrSERIAL[j]) {
						tIsMatch = true;
						tCount++;
						break;
					}
				}
			 }			

			if (WALen != tCount)
			{
				Msg += "明細【保固SLA資訊】【產品序號資訊】對應的序號不批配，請重新按下【查詢保固SLA】按鈕！\n";
			}			

			return Msg;
		}

		//合併Array字串並去除重覆，再回傳Array
		function MergeArrayString(strArr)
		{			
			strArr.sort();				//排序

			var result = new Array();		//建立出一個結果陣列
		    var tempStr = "";

			for(var i in strArr)
			{
				 if(strArr[i] != tempStr)
				{
					result.push(strArr[i]);
					tempStr=strArr[i];
				}
				else
				{
					continue;
				}
			}

			return result;
		}

		//提交前【處理與工時紀錄】明細檢查
		function checkDetail_PE() {
			var Msg = "";
			var cStatus = $("#ddl_cStatus").val();			
            var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別
			var tCount = 0; //記錄目前有效的明細

			var tableName = "tableRecord";
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');				
				var tIsError = false;									//記錄是否有錯誤
				var objRowNumber = tds.eq(0).children();				//項次
				var objEngineerName = tds.eq(1).children().eq(0);		//服務工程師/技術主管姓名				
				var objEngineerID = tds.eq(1).children().eq(1);		//服務工程師/技術主管ID
				var objDisabled = tds.eq(1).children().eq(2);			//是否停用(0.啟用 1.停用)
				var objReceiveTime = tds.eq(2).children();				//接單時間
				var objStartTime = tds.eq(3).children();				//出發時間
				var objArriveTime = tds.eq(4).children();				//到場時間
				var objFinishTime = tds.eq(5).children();				//完成時間
				var objWorkHours = tds.eq(6).children();				//工時(分鐘)
				var objDesc = tds.eq(7).children();					//處理紀錄
				var objSRReport =  tds.eq(8).children().find('input[name="hid_filezoneRE"]');				

				if (objEngineerName.val() != undefined) {
                    if (objDisabled.val() == "0")
					{
						if (objEngineerName.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【服務工程師/技術主管】不得為空！\n";
							tIsError = true;
						}

						if (objEngineerID.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」未下拉選取【服務工程師/技術主管】，請輸入關鍵字後再重新選取！\n";
							tIsError = true;
						}

						if (objReceiveTime.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【接單時間】不得為空！\n";
							tIsError = true;
						}

						if (objStartTime.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【出發時間】不得為空！\n";
							tIsError = true;
						}

						if (objArriveTime.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【到場時間】不得為空！\n";
							tIsError = true;
						}

						if (objFinishTime.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【完成時間】不得為空！\n";
							tIsError = true;
						}

						if (objWorkHours.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【工時(分鐘)】不得為空！\n";
							tIsError = true;
						}

						if (objDesc.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【處理紀錄】不得為空！\n";
							tIsError = true;
						}

						if (!tIsError)
						{
							tCount++;
						}

						//if (objSRReport.val() == "") {
						//	Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【服務報告書】不得為空！\n";
						//}
					}
                }					
			})		
			
			if (cStatus == "E0006") //下拉選擇完修
			{
				if (tCount == 0)
				{
					Msg += "請至少新增一筆【處理與工時紀錄】明細！\n";
				}
			}

			return Msg;
		}

		//提交前【零件更換資訊】明細檢查
		function checkDetail_PA() {
			var Msg = "";
			var cStatus = $("#ddl_cStatus").val();			
            var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別

			var tableName = "tablePA";
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');				
				var objRowNumber = tds.eq(0).children();			//項次
				var objDisabled = tds.eq(1).children().eq(1);		//是否停用(0.啟用 1.停用)
				var objMaterialID = tds.eq(2).children();			//更換零件料號ID
				var objMaterialName = tds.eq(3).children();		//料號說明
				var objArriveDate = tds.eq(10).children();			//到貨日
				var objReturnDate = tds.eq(11).children();			//歸還日

				if (objMaterialID.val() != undefined) {
                    if (objDisabled.val() == "0")
					{
						var reValue = checkDetail_PADate(objArriveDate, objReturnDate);
						
						if (reValue != ""){
							Msg += "明細【零件更換資訊】「項次：" + objRowNumber.html() + "」\n" + reValue;
						}

						if (objMaterialID.val() == "") {
							Msg += "明細【零件更換資訊】「項次：" + objRowNumber.html() + "」的【更換零件料號ID】不得為空！\n";
						}

						if (objMaterialName.val() == "") {
							Msg += "明細【零件更換資訊】「項次：" + objRowNumber.html() + "」的【料號說明】不得為空！\n";
						}
					}
                }					
			})			

			return Msg;
		}

		//檢查日期區間(true.ok false.不ok)
		function checkDetail_PADate(StartDate, EndDate) {
			var Msg = "";

			if (StartDate.val() != "" && EndDate.val() != "") {
				var reS = dateValidationCheck(StartDate.val());
				var reE = dateValidationCheck(EndDate.val());

				if (!reS)
				{
					Msg += '的【到貨日期】格式不正確，請檢查格式是否符合【yyyy-MM-dd】！\n';
				}

				if (!reE)
				{
					Msg += '的【歸還日期】格式不正確，請檢查格式是否符合【yyyy-MM-dd】！\n';
				}

				if (reS && reE)
				{
					if (Date.parse(StartDate.val()) > Date.parse(EndDate.val())) {
						Msg += '的【到貨日期】不能大於【歸還日期】！\n';
					}
				}
			}

			return Msg;
		}

		//將所有要儲存的欄位(Disabled、Enabled互換)
		//IsDisabled：true.不可改 false.可改
		function SetAllobjEnabledorDisabled(IsDisabled) {			
			//儲存前將客戶名稱設為可改，後端才能儲存
			$(".CustName").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});			

			//儲存前將報修管理設為可改，後端才能儲存
			$(".SRPathWay").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將姓名(報修人)設為可改，後端才能儲存
			$(".RepairName").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將地址(報修人)設為可改，後端才能儲存
			$(".RepairAddress").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將電話(報修人)設為可改，後端才能儲存
			$(".RepairPhone").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將手機(報修人)設為可改，後端才能儲存
			$(".RepairMobile").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將客Email(報修人)設為可改，後端才能儲存
			$(".RepairEmail").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將姓名(聯絡人)設為可改，後端才能儲存
			$(".ContactName").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將地址(聯絡人)設為可改，後端才能儲存
			$(".ContactAddress").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將電話(聯絡人)設為可改，後端才能儲存
			$(".ContactPhone").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將手機(聯絡人)設為可改，後端才能儲存
			$(".ContactMobile").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將客戶Email(聯絡人)設為可改，後端才能儲存
			$(".ContactEmail").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將客戶故障狀況分類說明設為可改，後端才能儲存
			$(".cFaultGroupNote").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將客戶故障狀況說明設為可改，後端才能儲存
			$(".cFaultStateNote").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將故障零件規格料號說明設為可改，後端才能儲存
			$(".cFaultSpecNote").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});			
		}		

		//客戶名稱onchange事件(清除客戶報修人和聯絡人資訊)
		function onChang_tbx_cCustomerName()
		{
			$("#tbx_cRepairName").val("");		//客戶報修人			
			$("#tbx_cRepairAddress").val("");	//地址(報修人)
			$("#tbx_cRepairPhone").val("");	//電話(報修人)
			$("#tbx_cRepairMobile").val("");	//手機(報修人)
			$("#tbx_cRepairEmail").val("");	//Email(報修人)

			clearDetail_CO();				//清除所有【聯絡人窗口資訊】檢查
		}

		//清除所有【聯絡人窗口資訊】檢查
		function clearDetail_CO() {
			var Msg = "";
			var tableName = "tableCO";
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');
				var objContactName = tds.eq(1).children().eq(0);	//姓名(聯絡人)
				var objDisabled = tds.eq(1).children().eq(1);		//是否停用(0.啟用 1.停用)

				if (objContactName.val() != undefined) {                    
					tds.hide();
					objDisabled.val("1");
                }				
			})			
		}

		//SAP客戶代號/客戶名稱查詢
		//compcde(Comp-1.大世科 Comp-2.群輝 Comp-3.上海 Comp-4.協志)
		function CustSearch() {
			var compcde = $("#hid_cLoginUser_CompCode").val();
			
			$(".CustName").unbind();

			$(".CustName").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 37 && event.keyCode != 38 && event.keyCode != 39 && event.keyCode != 40) {
						var keyword = $(this).val();
						if (keyword.length > 1) {
							var obj = $(this);
							$.ajax({
								url: '@Url.Action("findCustByKeywordAndComp", "ServiceRequest")',
								type: 'post',
								dataType: 'json',
								data: { functionName: 'findCustByKeywordAndComp', keyword: keyword, compcde: compcde },
								success: function (result) {
									Customers = [];
									$.each(result, function (i, idata) {
										Customers[i] = {
											label: idata.Kna1Kunnr + "\\" + idata.Kna1Name1, //顯示在清單的東西
											idx: i,
											id: idata.Kna1Kunnr,
											value: idata.Kna1Name1 //這個是要填入textbox的值
										};
									});

									//綁定foucs事件
									obj.autocomplete({
										source: Customers,
										select: function (event, ui) {
											var hid_cCustomerID = $("#hid_cCustomerID");			//客戶ID		
											var lbl_cCustomerID = $("#lbl_cCustomerID");			//客戶ID Lable

											if (hid_cCustomerID.val() != "" && hid_cCustomerID.val() != ui.item.id)
											{
												onChang_tbx_cCustomerName(); //清除客戶報修人和聯絡人資訊
											}

											lbl_cCustomerID.html(ui.item.id);
											hid_cCustomerID.val(ui.item.id);
											
											var tType =  ui.item.id.substr(0,1);

											if (tType == "P") 
											{
												$('#ddl_cCustomerType').val("P");
											}
											else
											{
												$('#ddl_cCustomerType').val("C");
											}
										}
									}).bind('focus', function () { $(this).autocomplete("search"); });

									//開啟autocomplete選單
									obj.focus();
								}
							})
						}
					}

				}
			})
		}

		//產品序號資訊查詢
	    function SerialSearch() {
			$(".Serial").unbind();

			$(".Serial").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 37 && event.keyCode != 38 && event.keyCode != 39 && event.keyCode != 40) {
						var IV_SERIAL = $(this).val();

						if (IV_SERIAL.length > 1) {
							var obj = $(this);
							$.ajax({
								url: '@Url.Action("findMaterialAndContractObjBySerial", "ServiceRequest")',
								type: 'post',
								dataType: 'json',
								data: { 
									IV_SERIAL: IV_SERIAL
								},
								success: function (result) {
									materials = [];
									$.each(result, function (i, idata) {
										materials[i] = {
											label: idata.iV_SERIAL + "\\" + idata.prodID + "\\" + idata.product, //顯示在清單的東西
											idx: i,
											value: idata.iV_SERIAL,       //這個是要填入textbox的值(序號)
                                            ProdID: idata.prodID,			//料號
											Product: idata.product,		//品名/規格
											MFRPN: idata.mfrpn,			//製造商零件號碼
											InstallNo: idata.installNo   //裝機號碼
										};
									});

									//綁定foucs事件
									obj.autocomplete({
										source: materials,
										select: function (event, ui) {
											findMFRPandInstallNumber(obj, IV_SERIAL, ui.item.ProdID, ui.item.Product);
										}
									}).bind('focus', function () { $(this).autocomplete("search"); });

									//開啟autocomplete選單
                                    obj.focus();									
								}
							})
						}
					}

				}
			})
        }

		//取得製造商零件號碼和裝機號碼
		function findMFRPandInstallNumber(obj, IV_SERIAL, ProdID, Product) {			

			$.ajax({
				url: '@Url.Action("findMFRPandInstallNumber", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
				data: { functionName: 'findMFRPandInstallNumber', ProdID: ProdID, IV_SERIAL: IV_SERIAL },
				success: function (result) {
					if (result != undefined) {
						var tr = obj.parent().parent();
						var tds = tr.find("td");
						
						tds.eq(2).children().val(Product);
						tds.eq(3).children().val(result[0]);
						tds.eq(4).children().eq(0).html(ProdID);
						tds.eq(4).children().eq(1).val(ProdID);
						tds.eq(5).children().val(result[1]);
					}
				}
			})
		}

		//用物料編號查詢BOM表
		function showBOMDialog(ProdID) {
			if (ProdID != "")
			{
				$("#ShowBOMDialog").modal("show");
				$("#ShowBOMdialogTitle").html("BOM表");
				
				$.ajax({
					url: '@Url.Action("SpareBOM", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
					data: {
						ProdID: ProdID		//物料編號
					},
					success: function (result) {
					},
					complete: function (result) {
						$("#ShowBOMdialogContent").html(result.responseText);
					}
				});
			}
		}

		//用關鍵字查詢物料
		function findMaterialByKeyword() {
			var cBUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別
			$(".material").unbind();

			$(".material").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 38 && event.keyCode != 40) {
						var keyword = $(this).val();
						var obj = $(this);
						var ojbID = $(this).attr("id");
							$.ajax({
								url: '@Url.Action("findMaterial", "ServiceRequest")',
								type: 'post',
								dataType: 'json',
								data: { 									
									cBUKRS: cBUKRS,
									keyword: keyword 
								},
								success: function (result) {
									materials = [];
									$.each(result, function (i, idata) {
										materials[i] = {
											label: idata.maraMatnr + "\\" + idata.maktTxza1Zf,
											idx: i,
											value: idata.maraMatnr,
											Name: idata.maktTxza1Zf,
										Desc: idata.maktTxza1Zf
										};
									});

									 //綁定foucs事件
									obj.autocomplete({
										source: materials,
										select: function (event, ui) {
											var tr = obj.parent().parent();
											var tds = tr.find("td");
											if (ojbID.indexOf('tbx_PRcMaterialID') >= 0)
											{
												tds.eq(3).children().val(ui.item.Name);
											}																						
										}
									}).bind('focus', function () { $(this).autocomplete("search"); });

									//開啟autocomplete選單
									obj.focus();
								}
							})
					}
				}
			})
		}

		//用關鍵字查詢物料(for備品)
		function findMaterialByKeyword() {
			var cBUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別
			$(".materialSpare").unbind();

			$(".materialSpare").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 38 && event.keyCode != 40) {
						var keyword = $(this).val();
						var obj = $(this);
						var ojbID = $(this).attr("id");
							$.ajax({
								url: '@Url.Action("findMaterialSpare", "ServiceRequest")',
								type: 'post',
								dataType: 'json',
								data: { 									
									cBUKRS: cBUKRS,
									keyword: keyword 
								},
								success: function (result) {
									materials = [];
									$.each(result, function (i, idata) {
										materials[i] = {
											label: idata.maraMatnr + "\\" + idata.maktTxza1Zf,
											idx: i,
											value: idata.maraMatnr,
											Name: idata.maktTxza1Zf,
										Desc: idata.maktTxza1Zf
										};
									});

									 //綁定foucs事件
									obj.autocomplete({
										source: materials,
										select: function (event, ui) {
											var tr = obj.parent().parent();
											var tds = tr.find("td");
											if (ojbID.indexOf('tbx_PAcMaterialID') >= 0)
											{
												tds.eq(3).children().val(ui.item.Name);
											}												
										}
									}).bind('focus', function () { $(this).autocomplete("search"); });

									//開啟autocomplete選單
									obj.focus();
								}
							})
					}
				}
			})
		}

		//Ajax用中文或英文姓名查詢人員帳號
		function PeopleSearch() {
			$(".Peoploe").unbind();

			$(".Peoploe").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 37 && event.keyCode != 38 && event.keyCode != 39 && event.keyCode != 40) {
						var keyword = $(this).val();						
						if (keyword.length > 1) {
							var obj = $(this);
							var ojbID = $(this).attr("id");

							$.ajax({
									url: '@Url.Action("AjaxfindEmployeeByKeyword", "ServiceRequest")',
									type: 'post',
									dataType: 'json',
									data: { 
										functionName: 'AjaxfindEmployeeByKeyword', keyword: keyword },
										success: function (result) {
										objects = [];
										$.each(result, function (i, idata) {
											objects[i] = {
												label: idata.CEmployeeCName + "\\" + idata.CEmployeeEname + "\\" + idata.CEmployeeErpid,
												idx: i,
												value: idata.CEmployeeCName + " " + idata.CEmployeeEname,
												ERPID: idata.CEmployeeErpid  //value這個值，一定要在label裡才能顯示出下拉
											};
										});

										//綁定foucs事件
										obj.autocomplete({
											source: objects,
											select: function (event, ui) {
												if (ojbID.indexOf('tbx_cMainEngineerName') >= 0)
												{
													$('#hid_cMainEngineerID').val(ui.item.ERPID);
												}
												else if (ojbID.indexOf('tbx_cSalesName') >= 0)
												{
													$('#hid_cSalesID').val(ui.item.ERPID);
												}
												else if (ojbID.indexOf('tbx_pjAssEngineerName') >= 0)
												{
													$('#hid_pjAssEngineerAcc').val(ui.item.ERPID);
												}
												else if (ojbID.indexOf('tbx_pjTechManagerName') >= 0)
												{
													$('#hid_pjTechManagerAcc').val(ui.item.ERPID);
												}
												else if (ojbID.indexOf('tbx_REcEngineerName') >= 0)
												{
													var tNo = ojbID.replace('tbx_REcEngineerName','');
													$('#hid_REcEngineerID' + tNo).val(ui.item.ERPID);
												}												
											}
										}).bind('focus', function () { obj.autocomplete("search"); });

										//開啟autocomplete選單
										obj.focus();
									$(".ui-autocomplete").css({ 'z-index': '2051', 'font-size': '16px' }); //可以正常顯示關鍵字查詢
									}
								})
							
						}
					}
				}
			})
		}

		//Ajax用中文或英文姓名查詢人員帳號(by服務團隊)
		function PeopleTeamSearch() {
			$(".PeoploeTeam").unbind();

			$(".PeoploeTeam").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 37 && event.keyCode != 38 && event.keyCode != 39 && event.keyCode != 40) {
						var keyword = $(this).val();						
						var cTeamID = $("#hid_cTeamID").val();

						if (keyword.length > 1) {

							if (cTeamID == "")
							{
								alert("請先選擇服務團隊，再輸入關鍵字查詢!");
								$(this).val("");
							}
							else
							{
								var obj = $(this);
								var ojbID = $(this).attr("id");

								$.ajax({
										url: '@Url.Action("AjaxfindTeamEmployeeByKeyword", "ServiceRequest")',
										type: 'post',
										dataType: 'json',
										data: { 
											functionName: 'AjaxfindTeamEmployeeByKeyword', cTeamID: cTeamID, keyword: keyword },
											success: function (result) {
											objects = [];
											$.each(result, function (i, idata) {
												objects[i] = {
													label: idata.Name2 + "\\" + idata.Name + "\\" + idata.ErpId,
													idx: i,
													value: idata.Name2 + " " + idata.Name,
													ERPID: idata.ErpId  //value這個值，一定要在label裡才能顯示出下拉
												};
											});

											//綁定foucs事件
											obj.autocomplete({
												source: objects,
												select: function (event, ui) {
													if (ojbID.indexOf('tbx_cMainEngineerName') >= 0)
													{
														$('#hid_cMainEngineerID').val(ui.item.ERPID);
													}													
													else if (ojbID.indexOf('tbx_pjAssEngineerName') >= 0)
													{
														$('#hid_pjAssEngineerAcc').val(ui.item.ERPID);
													}													
												}
											}).bind('focus', function () { obj.autocomplete("search"); });

											//開啟autocomplete選單
											obj.focus();
											$(".ui-autocomplete").css({ 'z-index': '2051', 'font-size': '16px' }); //可以正常顯示關鍵字查詢
										}
								})
							}
						}
					}
				}
			})
		}

		//Ajax用關鍵字查詢SQ人員
		function SQPersonSearch() {
			$(".SQPerson").unbind();

			$(".SQPerson").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 37 && event.keyCode != 38 && event.keyCode != 39 && event.keyCode != 40) {
						var keyword = $(this).val();						
						if (keyword.length > 1) {
							var obj = $(this);							

							$.ajax({
									url: '@Url.Action("AjaxfindSQPersonByKeyword", "ServiceRequest")',
									type: 'post',
									dataType: 'json',
									data: { 
										functionName: 'AjaxfindSQPersonByKeyword', keyword: keyword },
										success: function (result) {
										objects = [];
										$.each(result, function (i, idata) {
											objects[i] = {
												label: idata.cFullKey + "\\" + idata.cFullName,
												idx: i,
												value: idata.cFullName,
												KeyID: idata.cFullKey  //value這個值，一定要在label裡才能顯示出下拉
											};
										});

										//綁定foucs事件
										obj.autocomplete({
											source: objects,
											select: function (event, ui) {												 
												$('#hid_cSQPersonID').val(ui.item.KeyID);
											}
										}).bind('focus', function () { obj.autocomplete("search"); });

										//開啟autocomplete選單
										obj.focus();									
									}
								})
							
						}
					}
				}
			})
		}

		//-----↓↓↓↓↓取得客戶故障狀況分類資訊 ↓↓↓↓↓-----
		//IsCanEdit(false.不可編輯 true.可編輯)
		function getFaultInfo(IsCanEdit)
		{	
			var cNowStatus = $("#hid_cNowStatus").val();
			
			var IsCSMAnagerCanEdit = false;
			if (("@ViewBag.pIsCSManager" == "True" || "@ViewBag.pIsMIS" == "True") && IsCanEdit)
			{
				IsCSMAnagerCanEdit = true;
			}

			//客戶故障狀況分類
			if ($("#hid_cFaultGroup1").val() == "Y")
			{
				$("#chk_cFaultGroup1").prop("checked", true);
				
				 if (IsCSMAnagerCanEdit)
				 {
					 $("#tbx_cFaultGroupNote1").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit)
					 {
						 if (cNowStatus == "E0002")
						 {
						 	$("#tbx_cFaultGroupNote1").prop('disabled', false);
						 }
					 }
				 }
			}

			if ($("#hid_cFaultGroup2").val() == "Y")
			{
				 $("#chk_cFaultGroup2").prop("checked", true);

				 if (IsCSMAnagerCanEdit)
				 {
					 $("#tbx_cFaultGroupNote2").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit)
					 {
						if (cNowStatus == "E0002")
						{
							$("#tbx_cFaultGroupNote2").prop('disabled', false);
						}
					 }
				 }
			}

			if ($("#hid_cFaultGroup3").val() == "Y")
			{
				 $("#chk_cFaultGroup3").prop("checked", true);

				 if (IsCSMAnagerCanEdit)
				 {
					 $("#tbx_cFaultGroupNote3").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit)
					 {
						if (cNowStatus == "E0002")
						{
							$("#tbx_cFaultGroupNote3").prop('disabled', false);
						}
					 }
				 }
			}

			if ($("#hid_cFaultGroup4").val() == "Y")
			{
				 $("#chk_cFaultGroup4").prop("checked", true);

				 if (IsCSMAnagerCanEdit)
				 {
					 $("#tbx_cFaultGroupNote4").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit){
						 if (cNowStatus == "E0002")
						 {
							$("#tbx_cFaultGroupNote4").prop('disabled', false);
						 }
					 }
				 }
			}

			if ($("#hid_cFaultGroupOther").val() == "Y")
			{
				 $("#chk_cFaultGroupOther").prop("checked", true);

				 if (IsCSMAnagerCanEdit)
				 {
					$("#tbx_cFaultGroupNoteOther").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit){
						 if (cNowStatus == "E0002")
						 {
							$("#tbx_cFaultGroupNoteOther").prop('disabled', false);
						 }
					 }
				 }
			}

			//客戶故障狀況
			if ($("#hid_cFaultState1").val() == "Y")
			{
				 $("#chk_cFaultState1").prop("checked", true);

				 if (IsCSMAnagerCanEdit)
				 {
					$("#tbx_cFaultStateNote1").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit){
						 if (cNowStatus == "E0002")
						 {
							$("#tbx_cFaultStateNote1").prop('disabled', false);
						 }
					 }
				 }
			}

			if ($("#hid_cFaultState2").val() == "Y")
			{
				 $("#chk_cFaultState2").prop("checked", true);

				 if (IsCSMAnagerCanEdit)
				 {
					$("#tbx_cFaultStateNote2").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit){
						 if (cNowStatus == "E0002")
						 {
							$("#tbx_cFaultStateNote2").prop('disabled', false);
						 }
					 }
				 }
			}

			if ($("#hid_cFaultStateOther").val() == "Y")
			{
				 $("#chk_cFaultStateOther").prop("checked", true);

				 if (IsCSMAnagerCanEdit)
				 {
					$("#tbx_cFaultStateNoteOther").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit){
						 if (cNowStatus == "E0002")
						 {
							$("#tbx_cFaultStateNoteOther").prop('disabled', false);
						 }
					 }
				 }
			}

			//故障零件規格料號
			if ($("#hid_cFaultSpec1").val() == "Y")
			{
				 $("#chk_cFaultSpec1").prop("checked", true);

				 if (IsCSMAnagerCanEdit)
				 {
					$("#tbx_cFaultSpecNote1").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit){
						 if (cNowStatus == "E0002")
						 {
							$("#tbx_cFaultSpecNote1").prop('disabled', false);
						 }
					 }
				 }
			}

			if ($("#hid_cFaultSpec2").val() == "Y")
			{
				 $("#chk_cFaultSpec2").prop("checked", true);

				 if (IsCSMAnagerCanEdit)
				 {
					$("#tbx_cFaultSpecNote2").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit){
						 if (cNowStatus == "E0002")
						 {
							$("#tbx_cFaultSpecNote2").prop('disabled', false);
						 }
					 }
				 }
			}

			if ($("#hid_cFaultSpecOther").val() == "Y")
			{
				 $("#chk_cFaultSpecOther").prop("checked", true);

				 if (IsCSMAnagerCanEdit)
				 {
					$("#tbx_cFaultSpecNoteOther").prop('disabled', false);
				 }
				 else
				 {
					 if (IsCanEdit){
						 if (cNowStatus == "E0002")
						 {
							$("#tbx_cFaultSpecNoteOther").prop('disabled', false);
						 }
					 }
				 }
			}
		}
		//-----↑↑↑↑↑取得客戶故障狀況分類資訊 ↑↑↑↑↑-----
		
		//-----↓↓↓↓↓客戶聯絡人 ↓↓↓↓↓-----

		//Email格式檢查
		function CheckEmailValid() {
			var email = $("#tbx_cAddContactEmail").val();

			if (email != "")
			{
				$.ajax({
					url: '@Url.Action("CheckEmailValid", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
					data: { functionName: 'CheckEmailValid', email: email },
					success: function (result) {
						if (!result) {
							alert("Email格式不正確，請重新輸入！");
							$("#tbx_cAddContactEmail").val("");
						}
					}
				})
			}			
		}

		//Email格式檢查(for編輯聯絡人)
		function CheckEditEmailValid() {
			var email = $("#tbx_cEditContactEmail").val();

			if (email != "")
			{
				$.ajax({
					url: '@Url.Action("CheckEmailValid", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
					data: { functionName: 'CheckEmailValid', email: email },
					success: function (result) {
						if (!result) {
							alert("Email格式不正確，請重新輸入！");
							$("#tbx_cEditContactEmail").val("");
						}
					}
				})
			}
		}		

		//顯示選擇客戶聯絡人popup
		function showContactInfo(tIDName) {			
			var CustomerID = $('#hid_cCustomerID').val();
			var cBUKRS = $("#hid_cLoginUser_BUKRS").val();

			if (CustomerID == "")
			{
				alert("您尚未輸入【客戶】！");
			}
			else
			{
				FindContactInfo(tIDName, cBUKRS, CustomerID);
				$('#dialog_pContactInfo').modal('show');
			}
		}

		//取得客戶聯絡人
		//cBUKRS.公司別
		//CustomerID.客戶ID
		function FindContactInfo(tIDName, cBUKRS, CustomerID) {
			$.ajax({
				url: '@Url.Action("FindContactInfo", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
				data: {
					tIDName: tIDName,
					cBUKRS: cBUKRS,
					CustomerID: CustomerID
				},
				success: function (result) {
				},
				complete: function (result) {
					$("#tb_pContactInfo").html(result.responseText);				
				}				
			});
		}		

		//選取客戶聯絡人並將相關資訊帶回已更新聯絡資訊
		function selectContactInfo(tIDName, Name, City, Address, Email, phone, Mobile) {
			var tbx_cRepairName = $("#tbx_cRepairName");				//客戶報修人			
			var tbx_cRepairAddress = $("#tbx_cRepairAddress");			//地址(報修人)
			var tbx_cRepairPhone = $("#tbx_cRepairPhone");				//電話(報修人)
			var tbx_cRepairMobile = $("#tbx_cRepairMobile");				//手機(報修人)
			var tbx_cRepairEmail = $("#tbx_cRepairEmail");				//Email(報修人)

			var tNo = tIDName.replace("tbx_COcContactName","");			//聯絡人目前No
			var tbx_COcContactName = $("#tbx_COcContactName" + tNo);		//姓名(聯絡人)
			var tbx_COcContactAddress = $("#tbx_COcContactAddress"+ tNo);	//地址(聯絡人)
			var tbx_COcContactPhone = $("#tbx_COcContactPhone"+ tNo);		//電話(聯絡人)
			var tbx_COcContactMobile = $("#tbx_COcContactMobile"+ tNo);	//手機(聯絡人)
			var tbx_COcContactEmail = $("#tbx_COcContactEmail"+ tNo);		//Email(聯絡人)

			Name = Name.replace(/\’/g, "'");							//單引號，全型->半型
			City = City.replace(/\’/g, "'");							//單引號，全型->半型
			Address = Address.replace(/\’/g, "'");					//單引號，全型->半型
			phone = phone.replace(/\’/g, "'");						//單引號，全型->半型
			Mobile = Mobile.replace(/\’/g, "'");						//單引號，全型->半型
			
			if (tIDName == "tbx_cRepairName") {
				tbx_cRepairName.val(Name);
				tbx_cRepairAddress.val(City + Address);
				tbx_cRepairPhone.val(phone);
				tbx_cRepairMobile.val(Mobile);
				tbx_cRepairEmail.val(Email);
			}
			else
			{
				tbx_COcContactName.val(Name);
				tbx_COcContactAddress.val(City + Address);
				tbx_COcContactPhone.val(phone);
				tbx_COcContactMobile.val(Mobile);
				tbx_COcContactEmail.val(Email);
			}

			$("#dialog_pContactInfo").modal('hide');
		}

		//清除客戶報修人
		function clearRepairName() {
			$("#tbx_cRepairName").val('');			//姓名(報修人)
			$("#tbx_cRepairAddress").val('');		//地址(報修人)
			$("#tbx_cRepairPhone").val('');		//電話(報修人)
			$("#tbx_cRepairMobile").val('');		//手機(報修人)
			$("#tbx_cRepairEmail").val('');		//Email(報修人)
		}			

		//新增客戶聯絡人
		function btn_AddContactInfo_onclick() {			
			var CustomerID = $('#hid_cCustomerID').val();			

			if (CustomerID == "")
			{
				alert("您尚未輸入【客戶】！");
			}
			else
			{
				resetPopup("#dialog_pAddContactInfo");		//popup各欄位reset				

				$("#dialog_pAddContactInfo .dropzone").show();
				$("#dialog_pAddContactInfo").modal('show');
			}
		}		

		//取得要編輯/刪除的聯絡人資訊
        function getpjEditContact() {
            var cBUKRS = $("#hid_cLoginUser_BUKRS").val();
			var cCustomerID = $("#hid_cCustomerID").val();	
			var ContactName = $("#tbx_editContactName").val();	

			if(ContactName == "")
			{
				alert("您未輸入聯絡人姓名！")
				return false;
			}
            
			$.ajax({
				url: '@Url.Action("AjaxfindContactByKeyword", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {
					cBUKRS: cBUKRS,
					cCustomerID: cCustomerID,
					keyword: ContactName
                },
                success: function (result) {
                    var list = "";
					
					$.each(result, function (i, bean) {
                        if (bean != null) {
                            var Mobile = "";
							
							if (bean.contactMobile != null) 
							{
								Mobile = bean.contactMobile;
							}
							
							list += '<tr id="tr_pjeditContact_' + bean.contactId + '">'
                                + "<input type='hidden' class='hidpjContactID' value='" + bean.contactId + "'>"								
                                + "<td>"
								+ '	<button class="btn btn-info btn-sm" type="button" onclick="editpjeditContact(this)"; style="margin: 2px;">'
                                + '		<i class="fa fa-pencil"></i>'
                                + '	</button>'
                                + '	<button class="btn btn-danger btn-sm" type="button" onclick="deletepjeditContact(this);" style="margin: 2px;">'
                                + '		<i class="fa fa-trash"></i>'
                                + '	</button>'
                                + "</td>"
                                + "<td class='pjeditcontactName' style='vertical-align: middle;'>" + bean.contactName + "</td>"
                                + "<td class='pjeditcontactPhone' style='vertical-align: middle;'>" + bean.contactPhone + "</td>"
								+ "<td class='pjeditcontactMobile' style='vertical-align: middle;'>" + Mobile + "</td>"
                                + "<td class='pjeditcontactCity' style='vertical-align: middle;'>" + bean.contactCity + "</td>"
								+ "<td class='pjeditcontactAddress' style='vertical-align: middle;'>" + bean.contactAddress + "</td>"
								+ "<td class='pjeditcontactEmail' style='vertical-align: middle; text-align: left;'>" + bean.contactEmail + "</td>"                                
                            + "</tr>";
						}
                    });

                    if (list != "") {
                        list = "<table class='table table-striple table-bordered table-hover dataTables-example' style='word-break: keep-all; white-space: nowrap; text-align: center;'>"
                            + "<thead><tr>"
                                + "<th>編輯/刪除</th>"
                                + "<th>姓名</th>"
                                + "<th>電話</th>"
								+ "<th>手機</th>"
                                + "<th>城市</th>"
								+ "<th>詳細地址</th>"                                
                                + "<th>Email</th>"                                
                            + "</tr></thead><tbody>"
                            + list
                            + "</tbody></table>";
					}
					else {
						list = "查無聯絡人資訊！";
					}

                    $("#tb_pjeditContact").html(list);                    
                }
			});
        }

		//清除編輯客戶聯絡人欄位
		function cleanpjeditContact()
		{
			$("#hid_cEditContactID").val("");
			$("#tbx_cEditContactName").val("");
			$("#tbx_cEditContactPhone").val("");
			$("#tbx_cEditContactMobile").val("");
			$("#tbx_cEditContactCity").val("");
			$("#tbx_cEditContactAddress").val("");
			$("#tbx_cEditContactEmail").val("");
		}

		//編輯客戶聯絡人
        function editpjeditContact(obj) {
            var pjContactID = $(obj).parent().parent().find(".hidpjContactID").val();
			
			var tds =  $(obj).parent().parent().find('td');
			var pjeditcontactName = tds.eq(1).html();
			var pjeditcontactPhone = tds.eq(2).html();
			var pjeditcontactMobile = tds.eq(3).html();
			var pjeditcontactCity = tds.eq(4).html();
			var pjeditcontactAddress = tds.eq(5).html();
			var pjeditcontactEmail = tds.eq(6).html();
			
			$("#hid_cEditContactID").val(pjContactID);
			$("#tbx_cEditContactName").val(pjeditcontactName);
			$("#tbx_cEditContactPhone").val(pjeditcontactPhone);
			$("#tbx_cEditContactMobile").val(pjeditcontactMobile);
			$("#tbx_cEditContactCity").val(pjeditcontactCity);
			$("#tbx_cEditContactAddress").val(pjeditcontactAddress);
			$("#tbx_cEditContactEmail").val(pjeditcontactEmail);

			$("#btn_savepjEditContact").show();
        }

		//刪除客戶聯絡人
        function deletepjeditContact(obj) {
            var pjContactID = $(obj).parent().parent().find(".hidpjContactID").val();			

            if (confirm("確認刪除此聯絡人？")) {
                $.ajax({
					url: '@Url.Action("DeletepjContact", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {
                        cContactID: pjContactID						
                    },
                    success: function (result) {
                        if (result.indexOf("Error") >= 0) {
                           alert("刪除失敗！");
                        }
                        else {							
                            alert("刪除成功！");
							getpjEditContact();
                        }
                    }
				});
            }
        }

		//儲存客戶聯絡人(for編輯)
		function savepjEditContact() {
			var strMsg = "";
			
			var hid_cLoginUser_Name = $("#hid_cLoginUser_Name");
			var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS");
			var tbx_cCustomerName = $("#tbx_cCustomerName");
			var hid_cCustomerID = $("#hid_cCustomerID");
			
			var hid_cEditContactID = $("#hid_cEditContactID");			    //客戶聯絡人GUID
			var tbx_cEditContactName = $("#tbx_cEditContactName");			//客戶聯絡人姓名
			var tbx_cEditContactCity = $("#tbx_cEditContactCity");			//客戶聯絡人城市
			var tbx_cEditContactAddress = $("#tbx_cEditContactAddress");		//客戶聯絡人詳細地址			
			var tbx_cEditContactPhone = $("#tbx_cEditContactPhone");			//客戶聯絡人電話
			var tbx_cEditContactMobile = $("#tbx_cEditContactMobile");		//客戶聯絡人手機
			var tbx_cEditContactEmail = $("#tbx_cEditContactEmail");			//客戶聯絡人Email			

			if (tbx_cEditContactName.val() == "") {
				strMsg += "客戶聯絡人【姓名】不得為空！\n";
			}

			if (tbx_cEditContactCity.val() == "") {
				strMsg += "客戶聯絡人【城市】不得為空！\n";
			}

			if (tbx_cEditContactAddress.val() == "") {
				strMsg += "客戶聯絡人【詳細地址】不得為空！\n";
			}			

			//if (tbx_cEditContactPhone.val() == "" && tbx_cEditContactMobile.val() == "") {
			//	strMsg += "客戶聯絡人【電話】【手機】請至少擇一輸入！\n";
			//}			

			//if (tbx_cEditContactEmail.val() == "") {
			//	strMsg += "客戶聯絡人【Email】不得為空！\n";
			//}

			if (strMsg != "") {
				alert(strMsg);
			}
            else {
				$("#btn_savepjEditContact").hide();
                $("#img_waiting_savepjEditContact").show();
				$.ajax({
					url: '@Url.Action("SaveEditContactInfo", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {
						cEditContactID: hid_cEditContactID.val(),
						cBUKRS:hid_cLoginUser_BUKRS.val(),
						cCustomerID: hid_cCustomerID.val(),
						cCustomerName: tbx_cCustomerName.val(),
						cEditContactName: tbx_cEditContactName.val(),
						cEditContactCity: tbx_cEditContactCity.val(),
						cEditContactAddress: tbx_cEditContactAddress.val(),
						cEditContactPhone: tbx_cEditContactPhone.val(),
						cEditContactMobile: tbx_cEditContactMobile.val(),
						cEditContactEmail: tbx_cEditContactEmail.val(),
						ModifiedUserName: hid_cLoginUser_Name.val()
                    },
                    success: function (result) {
                        if (result == "SUCCESS") {                           
                            alert("儲存成功！");
							 $('#dialog_pjEditContactInfo').modal('hide');
                        }
                        else {
							alert("儲存失敗！原因：" + result);
                        }
                        $("#img_waiting_savepjEditContact").hide();
                        $("#btn_savepjEditContact").show();
                    },                   
				});
			}
        }

		//儲存客戶聯絡人(for新增)
		function saveContactInfo() {
			var strMsg = "";
			
			var hid_cLoginUser_Name = $("#hid_cLoginUser_Name");
			var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS");
			var tbx_cCustomerName = $("#tbx_cCustomerName");
			var hid_cCustomerID = $("#hid_cCustomerID");
			
			var tbx_cAddContactName = $("#tbx_cAddContactName");				//客戶聯絡人姓名
			var tbx_cAddContactCity = $("#tbx_cAddContactCity");				//客戶聯絡人城市
			var tbx_cAddContactAddress = $("#tbx_cAddContactAddress");		//客戶聯絡人詳細地址
			var tbx_cAddContactAddress_No = $("#tbx_cAddContactAddress_No");	//客戶聯絡人門牌號碼/樓層
			var tbx_cAddContactPhone = $("#tbx_cAddContactPhone");			//客戶聯絡人電話
			var tbx_cAddContactMobile = $("#tbx_cAddContactMobile");			//客戶聯絡人手機
			var tbx_cAddContactEmail = $("#tbx_cAddContactEmail");			//客戶聯絡人Email			

			if (tbx_cAddContactName.val() == "") {
				strMsg += "客戶聯絡人【姓名】不得為空！\n";
			}

			if (tbx_cAddContactCity.val() == "") {
				strMsg += "客戶聯絡人【城市】不得為空！\n";
			}

			if (tbx_cAddContactAddress.val() == "") {
				strMsg += "客戶聯絡人【詳細地址】不得為空！\n";
			}

			if (tbx_cAddContactAddress_No.val() == "") {
				strMsg += "客戶聯絡人【門牌號碼/樓層】不得為空！\n";
			}

			//if (tbx_cAddContactPhone.val() == "" && tbx_cAddContactMobile.val() == "") {
			//	strMsg += "客戶聯絡人【電話】【手機】請至少擇一輸入！\n";
			//}

			//if (tbx_cAddContactEmail.val() == "") {
			//	strMsg += "客戶聯絡人【Email】不得為空！\n";
			//}

			if (strMsg != "") {
				alert(strMsg);
			}
            else {
				var tAddress = tbx_cAddContactAddress.val() + tbx_cAddContactAddress_No.val();

				$("#btn_saveContactInfo").hide();
                $("#img_waiting_saveContactInfo").show();
				$.ajax({
					url: '@Url.Action("SaveContactInfo", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {						
						cBUKRS:hid_cLoginUser_BUKRS.val(),
						cCustomerID: hid_cCustomerID.val(),
						cCustomerName: tbx_cCustomerName.val(),
						cAddContactName: tbx_cAddContactName.val(),
						cAddContactCity: tbx_cAddContactCity.val(),
						cAddContactAddress: tAddress,
						cAddContactPhone: tbx_cAddContactPhone.val(),
						cAddContactMobile:tbx_cAddContactMobile.val(),
						cAddContactEmail: tbx_cAddContactEmail.val(),
						ModifiedUserName: hid_cLoginUser_Name.val()
                    },
                    success: function (result) {
                        if (result == "SUCCESS") {                           
                            alert("儲存成功！");
							$("#dialog_pAddContactInfo").modal('hide');							
                        }
                        else {
							alert("儲存失敗！原因：" + result);
                        }
                        $("#img_waiting_saveContactInfo").hide();
                        $("#btn_saveContactInfo").show();
                    },                   
				});
			}
        }
		//-----↑↑↑↑↑客戶聯絡人 ↑↑↑↑↑-----

		//-----↓↓↓↓↓服務團隊 ↓↓↓↓↓-----
        //修改服務團隊
        function savepjTeam() {
            var hid_cTeamID = $("#hid_cTeamID");

			if ($("#ddl_cTeamID").val() == "") {
                alert("請選擇服務團隊");
            }
            else {
					$("#btn_savepjTeam").hide();
                    $("#img_waiting_savepjTeam").show();

				    $.ajax({
					    url: '@Url.Action("SavepjTeam", "ServiceRequest")',
					    type: 'post',
					    dataType: 'json',
                        data: {                            
                            cTeamID: hid_cTeamID.val(),
							cTeamAcc: $("#ddl_cTeamID").val(),
                        },
                        success: function (result) {
                            if (result.indexOf("Error") >= 0) {
							   alert("儲存失敗！" + result);
							}
							else {
								//alert("儲存成功");
								hid_cTeamID.val(result);
								getpjTeam();                            
							}
                        }
                    });

                    $("#img_waiting_savepjTeam").hide();
                    $("#btn_savepjTeam").show();
            }
        }

        //取得服務團隊
        function getpjTeam() {            
			$("#ddl_cTeamID").val("");
			
			var hid_cTeamID = $("#hid_cTeamID");
            
			$.ajax({
				url: '@Url.Action("GetpjTeam", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {                    
					cTeamID : hid_cTeamID.val(),
                },
                success: function (result) {
                    var list = "";
					var pjTeamName = "";
					$.each(result, function (i, bean) {
                        if (bean != null) {
							pjTeamName += bean.teamName + ";";

                            list += '<tr id="tr_pjTeam_' + bean.id + '">'
                                + "<input type='hidden' class='hidpjTeamAcc' value='" + bean.teamID + "'>"
                                + '<td>'
                                    + '<button class="btn btn-danger btn-sm btnCtDelete btnPreventDefault" type="button" onclick="deletepjTeam(this);" style="margin: 2px;">'
                                        + '<i class="fa fa-trash"></i>'
                                    + '</button>'
                                + '</td>'								
                                + "<td style='vertical-align: middle;'>" + bean.teamName + "</td>"
								+ "<td style='vertical-align: middle;'>" + bean.deptId + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.deptName + "</td>"
                            + "</tr>";
						}
                    });

                    if (list != "") {
                        list = "<table class='table table-striple table-bordered table-hover dataTables-example' style='word-break: keep-all; white-space: nowrap; text-align: center;'>"
                            + "<thead><tr>"
                                + "<th>刪除</th>"                                
                                + "<th>服務團隊</th>"
                                + "<th>部門ID</th>"
                                + "<th>部門名稱</th>"                                
                            + "</tr></thead><tbody>"
                            + list
                            + "</tbody></table>";
					}
                    $("#tb_pjTeam").html(list);

                    pjTeamName = pjTeamName.substr(0, pjTeamName.length - 1);
                    $("#tbx_cTeamName").val(pjTeamName);
                }
			});
        }

        //刪除服務團隊
        function deletepjTeam(obj) {
            var pjTeamAcc = $(obj).parent().parent().find(".hidpjTeamAcc").val();
			var hid_cTeamID = $("#hid_cTeamID");

            if (confirm("確認刪除此服務團隊？")) {
                $.ajax({
					url: '@Url.Action("DeletepjTeam", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {
                        cTeamID: hid_cTeamID.val(),
						cTeamAcc: pjTeamAcc,
                    },
                    success: function (result) {
                        if (result.indexOf("Error") >= 0) {
                           alert("刪除失敗！");
                        }
                        else {
							//alert("刪除成功");
							hid_cTeamID.val(result);
                            getpjTeam();                            
                        }
                    }
				});
            }
        }
		//-----↑↑↑↑↑服務團隊 ↑↑↑↑↑-----

		//-----↓↓↓↓↓協助工程師 ↓↓↓↓↓-----
        //修改協助工程師
        function savepjAssEngineer() {
            var hid_cAssEngineerID = $("#hid_cAssEngineerID");

			if ($("#hid_pjAssEngineerAcc").val() == "") {
                alert("請輸入協助工程師姓名");
            }
            else {
					$("#btn_savepjAssEngineer").hide();
                    $("#img_waiting_savepjAssEngineer").show();

				    $.ajax({
					    url: '@Url.Action("SavepjAssEngineer", "ServiceRequest")',
					    type: 'post',
					    dataType: 'json',
                        data: {                            
                            cAssEngineerID: hid_cAssEngineerID.val(),
							cAssEngineerAcc: $("#hid_pjAssEngineerAcc").val(),
                        },
                        success: function (result) {
                            if (result.indexOf("Error") >= 0) {
							   alert("儲存失敗！" + result);
							}
							else {
								//alert("儲存成功");
								hid_cAssEngineerID.val(result);
								getpjAssEngineer();                            
							}
                        }
                    });

                    $("#img_waiting_savepjAssEngineer").hide();
                    $("#btn_savepjAssEngineer").show();
            }
        }

        //取得協助工程師
        function getpjAssEngineer() {
            $("#hid_pjAssEngineerAcc").val("");
            $("#tbx_pjAssEngineerName").val("");
			
			var hid_cAssEngineerID = $("#hid_cAssEngineerID");
            
			$.ajax({
				url: '@Url.Action("GetpjAssEngineer", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {                    
					cAssEngineerID : hid_cAssEngineerID.val(),
                },
                success: function (result) {
                    var list = "";
					var pjAssEngineerName = "";
					$.each(result, function (i, bean) {
                        if (bean != null) {
                            pjAssEngineerName += bean.name + ";";

                            list += '<tr id="tr_pjAssEngineer_' + bean.id + '">'
                                + "<input type='hidden' class='hidpjAssEngineerAcc' value='" + bean.acc + "'>"
                                + '<td>'
                                    + '<button class="btn btn-danger btn-sm btnCtDelete btnPreventDefault" type="button" onclick="deletepjAssEngineer(this);" style="margin: 2px;">'
                                        + '<i class="fa fa-trash"></i>'
                                    + '</button>'
                                + '</td>'
                                + "<td style='vertical-align: middle;'>" + bean.name + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.ext + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.mobile + "</td>"
                                + "<td style='vertical-align: middle; text-align: left;'>" + bean.email + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.deptName + "</td>"                                
                            + "</tr>";
						}
                    });

                    if (list != "") {
                        list = "<table class='table table-striple table-bordered table-hover dataTables-example' style='word-break: keep-all; white-space: nowrap; text-align: center;'>"
                            + "<thead><tr>"
                                + "<th>刪除</th>"
                                + "<th>姓名</th>"
                                + "<th>分機</th>"
                                + "<th>手機</th>"
                                + "<th>Email</th>"
                                + "<th>部門</th>"                                
                            + "</tr></thead><tbody>"
                            + list
                            + "</tbody></table>";
					}
                    $("#tb_pjAssEngineer").html(list);

                    pjAssEngineerName = pjAssEngineerName.substr(0, pjAssEngineerName.length - 1);
                    $("#tbx_cAssEngineerName").val(pjAssEngineerName);
                }
			});
        }

        //刪除協助工程師
        function deletepjAssEngineer(obj) {
            var pjAssEngineerAcc = $(obj).parent().parent().find(".hidpjAssEngineerAcc").val();
			var hid_cAssEngineerID = $("#hid_cAssEngineerID");

            if (confirm("確認刪除此協助工程師？")) {
                $.ajax({
					url: '@Url.Action("DeletepjAssEngineer", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {
                        cAssEngineerID: hid_cAssEngineerID.val(),
						cAssEngineerAcc: pjAssEngineerAcc,
                    },
                    success: function (result) {
                        if (result.indexOf("Error") >= 0) {
                           alert("刪除失敗！");
                        }
                        else {
							//alert("刪除成功");
							hid_cAssEngineerID.val(result);
                            getpjAssEngineer();                            
                        }
                    }
				});
            }
        }
		//-----↑↑↑↑↑協助工程師 ↑↑↑↑↑-----

		//-----↓↓↓↓↓技術主管 ↓↓↓↓↓-----
        //修改技術主管
        function savepjTechManager() {
            var hid_cTechManagerID = $("#hid_cTechManagerID");

			if ($("#hid_pjTechManagerAcc").val() == "") {
                alert("請輸入技術主管姓名");
            }
            else {
					$("#btn_savepjTechManager").hide();
                    $("#img_waiting_savepjTechManager").show();

				    $.ajax({
					    url: '@Url.Action("SavepjTechManager", "ServiceRequest")',
					    type: 'post',
					    dataType: 'json',
                        data: {                            
                            cTechManagerID: hid_cTechManagerID.val(),
							cTechManagerAcc: $("#hid_pjTechManagerAcc").val(),
                        },
                        success: function (result) {
                            if (result.indexOf("Error") >= 0) {
							   alert("儲存失敗！" + result);
							}
							else {
								//alert("儲存成功");
								hid_cTechManagerID.val(result);
								getpjTechManager();                            
							}
                        }
                    });

                    $("#img_waiting_savepjTechManager").hide();
                    $("#btn_savepjTechManager").show();
            }
        }

        //取得技術主管
        function getpjTechManager() {
            $("#hid_pjTechManagerAcc").val("");
            $("#tbx_pjTechManagerName").val("");
			
			var hid_cTechManagerID = $("#hid_cTechManagerID");
            
			$.ajax({
				url: '@Url.Action("GetpjTechManager", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {                    
					cTechManagerID : hid_cTechManagerID.val(),
                },
                success: function (result) {
                    var list = "";
					var pjTechManagerName = "";
					$.each(result, function (i, bean) {
                        if (bean != null) {
                            pjTechManagerName += bean.name + ";";

                            list += '<tr id="tr_pjTechManager_' + bean.id + '">'
                                + "<input type='hidden' class='hidpjTechManagerAcc' value='" + bean.acc + "'>"
                                + '<td>'
                                    + '<button class="btn btn-danger btn-sm btnCtDelete btnPreventDefault" type="button" onclick="deletepjTechManager(this);" style="margin: 2px;">'
                                        + '<i class="fa fa-trash"></i>'
                                    + '</button>'
                                + '</td>'
                                + "<td style='vertical-align: middle;'>" + bean.name + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.ext + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.mobile + "</td>"
                                + "<td style='vertical-align: middle; text-align: left;'>" + bean.email + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.deptName + "</td>"                                
                            + "</tr>";
						}
                    });

                    if (list != "") {
                        list = "<table class='table table-striple table-bordered table-hover dataTables-example' style='word-break: keep-all; white-space: nowrap; text-align: center;'>"
                            + "<thead><tr>"
                                + "<th>刪除</th>"
                                + "<th>姓名</th>"
                                + "<th>分機</th>"
                                + "<th>手機</th>"
                                + "<th>Email</th>"
                                + "<th>部門</th>"                                
                            + "</tr></thead><tbody>"
                            + list
                            + "</tbody></table>";
					}
                    $("#tb_pjTechManager").html(list);

                    pjTechManagerName = pjTechManagerName.substr(0, pjTechManagerName.length - 1);
                    $("#tbx_cTechManagerName").val(pjTechManagerName);
                }
			});
        }

        //刪除技術主管
        function deletepjTechManager(obj) {
            var pjTechManagerAcc = $(obj).parent().parent().find(".hidpjTechManagerAcc").val();
			var hid_cTechManagerID = $("#hid_cTechManagerID");

            if (confirm("確認刪除此技術主管？")) {
                $.ajax({
					url: '@Url.Action("DeletepjTechManager", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {
                        cTechManagerID: hid_cTechManagerID.val(),
						cTechManagerAcc: pjTechManagerAcc,
                    },
                    success: function (result) {
                        if (result.indexOf("Error") >= 0) {
                           alert("刪除失敗！");
                        }
                        else {
							//alert("刪除成功");
							hid_cTechManagerID.val(result);
                            getpjTechManager();                            
                        }
                    }
				});
            }
        }
		//-----↑↑↑↑↑技術主管 ↑↑↑↑↑-----

		//-----↓↓↓↓↓報修類別 ↓↓↓↓↓-----
		//第一階(大類) onChange
		function onChangecSRTypeOne() {

			//先清空下拉選單選項，才不會一直append
			$('#ddl_cSRTypeSec').empty();
			$('#ddl_cSRTypeThr').empty();

			$.ajax({
				url: '@Url.Action("findSRTypeSecList", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {
					keyword: $('#ddl_cSRTypeOne').val(),
				},
                success: function (result) {
                    $.each(result, function (index, obj) {
						$("#ddl_cSRTypeSec").append(
                            $('<option></option>').val(obj.value).html(obj.text)
                        );
                    });
				}
			});
		}

		//第二階(中類) onChange
		function onChangecSRTypeSec() {

			//先清空下拉選單選項，才不會一直append
			$('#ddl_cSRTypeThr').empty();			

			$.ajax({
				url: '@Url.Action("findSRTypeThrList", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {
					keyword: $('#ddl_cSRTypeSec').val(),
				},
                success: function (result) {
                    $.each(result, function (index, obj) {
						$("#ddl_cSRTypeThr").append(
                            $('<option></option>').val(obj.value).html(obj.text)
                        );
                    });
				}
			});
		}
		//-----↑↑↑↑↑報修類別 ↑↑↑↑↑-----

		//-----↓↓↓↓↓同報修人窗口資訊 ↓↓↓↓↓-----
		function CopyRepairInfo(tableName)
		{
			var tCount = getCountDetail_CO(tableName);

			if (tCount == 0) //若沒有存在就新增
			{
				AddDetailItem_Contact(tableName)
			}

			CopyToDetail_CO(tableName);
		}

		//判斷【聯絡人窗口資訊】明細目前有效的有幾筆
		function getCountDetail_CO(tableName) {			
			var tCount = 0; //記錄目前有效的明細			
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');
				var objContactName = tds.eq(1).children().eq(0);	//姓名(聯絡人)
				var objDisabled = tds.eq(1).children().eq(1);		//是否停用(0.啟用 1.停用)				
				
				if (objContactName.val() != undefined) {                    
					if (objDisabled.val() == "0"){
						tCount++;
					}
                }				
			})	
			
			return tCount;			
		}

		//新增或更新【聯絡人窗口資訊】同報修人(只更新第一筆)
		function CopyToDetail_CO(tableName) {
			var tbx_cRepairName = $("#tbx_cRepairName");					//姓名(報修人)
			var tbx_cRepairAddress = $("#tbx_cRepairAddress");				//地址(報修人)
			var tbx_cRepairPhone = $("#tbx_cRepairPhone");					//電話(報修人)
			var tbx_cRepairMobile = $("#tbx_cRepairMobile");					//手機(報修人)
			var tbx_cRepairEmail	= $("#tbx_cRepairEmail");					//Email(報修人)
			var tCount = 0; //記錄目前有效的明細
			
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');
				var tIsError = false;								//記錄是否有錯誤
				var objRowNumber = tds.eq(0).children();			//項次
				var objContactName = tds.eq(1).children().eq(0);	//姓名(聯絡人)
				var objDisabled = tds.eq(1).children().eq(1);		//是否停用(0.啟用 1.停用)				
				var objContactAddress = tds.eq(2).children();		//地址(聯絡人)
				var objContactPhone = tds.eq(3).children();		//電話(聯絡人)
				var objContactMoblie = tds.eq(4).children();		//手機(聯絡人)
				var objContactEmail = tds.eq(5).children();		//E-Mail(聯絡人)

				if (objContactName.val() != undefined) {                    
					if (objDisabled.val() == "0"){
						objContactName.val(tbx_cRepairName.val());
						objContactAddress.val(tbx_cRepairAddress.val());
						objContactPhone.val(tbx_cRepairPhone.val());
						objContactMoblie.val(tbx_cRepairMobile.val());
						objContactEmail.val(tbx_cRepairEmail.val());

						tCount++;	
						return false;
					}
                }				
			})	
			
			if (tCount == 0)
			{
				
			}			
		}
		//-----↑↑↑↑↑同報修人窗口資訊 ↑↑↑↑↑-----

		//-----↓↓↓↓↓客戶聯絡窗口資訊 ↓↓↓↓↓-----
		//新增明細
		function AddDetailItem_Contact(tableName) {
			trContactNoCount = $("input[name='hid_trContactNo']").val();

			if (trContactNoCount == "" || trContactNoCount == "0") {
				trContactNoCount = 1;
			}
			else {
				trContactNoCount = parseInt(trContactNoCount) + 1;
			}

			$("input[name='hid_trContactNo']").val(trContactNoCount);

			var RowNumber = SetCORowNumber();
			var ContactName = SetContactName();	
			var ContactAddress = SetContactAddress();
			var ContactPhone = SetContactPhone();
			var ContactMobile = SetContactMobile();
			var ContactEmail = SetContactEmail();
			var tDelButton = SetCODelButton();

			var tAlltd = RowNumber + ContactName + ContactAddress + ContactPhone + ContactMobile + ContactEmail + tDelButton;

			$("#" + tableName).append("<tr id='trCO" + trContactNoCount + "'>" + tAlltd + "</tr>");			
		}

		//組項次
		function SetCORowNumber() {
			var reValue = "<td><label name='lbl_PRRowNumber' style='font-size:14pt'>"+ trContactNoCount +"</label></td>";
			return reValue;
		}
		
		//組姓名(聯絡人)
		function SetContactName() {
			var reValue = "<td><input type='text' name='tbx_COcContactName' id='tbx_COcContactName" + trContactNoCount + "'  class='form-control ContactName' style='width:200px;'>";					
			reValue += "<input type='hidden' name='hid_COcDisabled' id='hid_COcDisabled" + trContactNoCount + "' value='0'>";
			reValue += "<button type='button' name='btn_COcContactName' id='btn_COcContactName" + trContactNoCount + "' class='btn btn-primary' onclick=showContactInfo('tbx_COcContactName" + trContactNoCount + "'); title='請點擊我查詢姓名(聯絡人)'><i class='fa fa-search'></i></button></td>";
			
			return reValue;
		}			

		//組地址(聯絡人)
		function SetContactAddress() {			
			var reValue = "<td><textarea rows='3' class='form-control ContactAddress' style='width:200px;' placeholder='地址(聯絡人)' name='tbx_COcContactAddress' id='tbx_COcContactAddress" + trContactNoCount + "'></textarea></td>";
			return reValue;
		}

		//組電話(聯絡人)
		function SetContactPhone() {
			var reValue = "<td><input type='text' name='tbx_COcContactPhone' id='tbx_COcContactPhone" + trContactNoCount + "' class='form-control ContactPhone' style='width:200px;' placeholder='電話(聯絡人)'></td>";
			return reValue;
		}

		//組手機(聯絡人)
		function SetContactMobile() {
			var reValue = "<td><input type='text' name='tbx_COcContactMobile' id='tbx_COcContactMobile" + trContactNoCount + "' class='form-control ContactMobile' style='width:200px;' placeholder='手機(聯絡人)'></td>";
			return reValue;
		}

		//組E-Mail(聯絡人)
		function SetContactEmail() {
			var reValue = "<td><input type='text' name='tbx_COcContactEmail' id='tbx_COcContactEmail" + trContactNoCount + "' class='form-control ContactEmail' style='width:350px;' placeholder='E-Mail(聯絡人)'></td>";
			return reValue;
		}

		//組刪除按鈕
		function SetCODelButton()
		{
			var tTrID = $("input[name='hid_trContactNo']").val();
			var reValue = "<td><button name='btn_ContactDel' class='btn btn-danger' type='button' onclick=DelDetailItem_Contact('trCO" + tTrID + "','" + trContactNoCount + "');><i class='fa fa-trash'></i></button></td>";
			return reValue;
		}		

		//刪除明細
		function DelDetailItem_Contact(rowId, tNo) {
			//$('#' + rowId).remove();
			$('#' + rowId).hide();
			$('#hid_COcDisabled' + tNo).val("1");
		}
		//-----↑↑↑↑↑客戶聯絡窗口資訊 ↑↑↑↑↑-----

		//-----↓↓↓↓↓產品序號資訊檔 ↓↓↓↓↓-----		

		//新增明細
		function AddDetailItem_Product(tableName) {
			trProductNoCount = $("input[name='hid_trProductNo']").val();

			if (trProductNoCount == "" || trProductNoCount == "0") {
				trProductNoCount = 1;
			}
			else {
				trProductNoCount = parseInt(trProductNoCount) + 1;
			}

			$("input[name='hid_trProductNo']").val(trProductNoCount);

			var RowNumber = SetPRRowNumber();
			var SerialID = SetSerialID();	
			var MaterialName = SetMaterialName();
			var ProductNumber = SetProductNumber();
			var BOM = SetBOM();
			var NewSerialID = SetNewSerialID();
			var InstallID = SetInstallID();
			var tDelButton = SetPRDelButton();

			var tAlltd = RowNumber + SerialID + MaterialName + ProductNumber + BOM + NewSerialID + InstallID + tDelButton;

			$("#" + tableName).append("<tr id='trPR" + trProductNoCount + "'>" + tAlltd + "</tr>");

			SerialSearch();				//產品序號資訊查詢
			findMaterialByKeyword();	//用關鍵字查詢物料
		}

		//組項次
		function SetPRRowNumber() {
			var reValue = "<td><label name='lbl_PRRowNumber' style='font-size:14pt'>"+ trProductNoCount +"</label></td>";
			return reValue;
		}
		
		//組序號
		function SetSerialID() {
			var reValue = "<td><input type='text' name='tbx_PRcSerialID' id='tbx_PRcSerialID" + trProductNoCount + "' class='form-control Serial' style='width:200px;' placeholder='請輸入序號關鍵字查詢'>";			    
				reValue += "<input type='hidden' name='hid_PRcDisabled' id='hid_PRcDisabled" + trProductNoCount + "' value='0'></td>";
			return reValue;
		}			

		//組機器型號
		function SetMaterialName() {
			var reValue = "<td><textarea rows='3' class='form-control' style='width:200px;' placeholder='機器型號' name='tbx_PRcMaterialName' id='tbx_PRcMaterialName" + trProductNoCount + "'></textarea></td>";
			return reValue;
		}

		//組ProductNumber
		function SetProductNumber() {
			var reValue = "<td><input type='text' name='tbx_PRcProductNumber' id='tbx_PRcProductNumber" + trProductNoCount + "' class='form-control' style='width:200px;' placeholder='Product Number'></td>";
			return reValue;
		}

		//組BOM
		function SetBOM() {
			var reValue = "<td><a href=\"javascript:void(0);showBOMDialog('')\"></a>";
			    reValue += "<input type='hidden' name='hid_PRcMaterialID' id='hid_PRcMaterialID" + trProductNoCount + "'></td>";
			return reValue;
		}

		//組更換後序號
		function SetNewSerialID() {
			var reValue = "<td><input type='text' name='tbx_PRcNewSerialID' id='tbx_PRcNewSerialID" + trProductNoCount + "' class='form-control' style='width:200px;' placeholder='更換後序號'></td>";					
			return reValue;
		}

		//組裝機資訊
		function SetInstallID() {
			var reValue = "<td><input type='text' name='tbx_PRcInstallID' id='tbx_PRcInstallID" + trProductNoCount + "' class='form-control' style='width:150px;' placeholder='裝機資訊'></td>";
			return reValue;
		}

		//組刪除按鈕
		function SetPRDelButton()
		{
			var tTrID = $("input[name='hid_trProductNo']").val();
			var reValue = "<td><button name='btn_ProductDel' class='btn btn-danger' type='button' onclick=DelDetailItem_Product('trPR" + tTrID + "','" + trProductNoCount + "');><i class='fa fa-trash'></i></button></td>";
			return reValue;
		}		

		//刪除明細
		function DelDetailItem_Product(rowId, tNo) {
			//$('#' + rowId).remove();
			$('#' + rowId).hide();
			$('#hid_PRcDisabled' + tNo).val("1");
		}
		//-----↑↑↑↑↑產品序號資訊檔 ↑↑↑↑↑-----

		//-----↓↓↓↓↓保固SLA檔 ↓↓↓↓↓-----		
		function init_iChceck()
		{
			$('.i-checks').iCheck({
				checkboxClass: 'icheckbox_square-green',
				radioClass: 'iradio_square-green',
			});				

			//保固SLA產生時，要初始本次使用的chang事件
			$(".i-checks input[name='CheckUsed']").on('ifChanged', function (event) {
				var objID =$(this).attr("id");
				
				var tNumber = objID.replace('CheckThisID','');
				var objUsed = $("#hid_CheckUsedID" + tNumber); //本次使用hiddenValue

				if (event.target.checked)
				{
					objUsed.val("Y");
				}
				else
				{
					objUsed.val("N");
				}

				getShowCheck(objID, event.target.checked);
            });

			//init L2客戶故障狀況onChange事件
			$(".Fault").on('ifChanged', function (event) {
				var objID =$(this).attr("id");

				if (event.target.checked)
				{					
					$(this).iCheck('check');

					if (objID == "chk_cFaultGroup1") //客戶故障狀況分類-硬體
					{
						$("#hid_cFaultGroup1").val("Y");
						$("#tbx_cFaultGroupNote1").prop('disabled', false);
					}
					else if (objID == "chk_cFaultGroup2") //客戶故障狀況分類-系統
					{
						$("#hid_cFaultGroup2").val("Y");
						$("#tbx_cFaultGroupNote2").prop('disabled', false);
					}
					else if (objID == "chk_cFaultGroup3") //客戶故障狀況分類-服務
					{
						$("#hid_cFaultGroup3").val("Y");
						$("#tbx_cFaultGroupNote3").prop('disabled', false);
					}
					else if (objID == "chk_cFaultGroup4") //客戶故障狀況分類-網路
					{
						$("#hid_cFaultGroup4").val("Y");
						$("#tbx_cFaultGroupNote4").prop('disabled', false);
					}
					else if (objID == "chk_cFaultGroupOther") //客戶故障狀況分類-其他
					{
						$("#hid_cFaultGroupOther").val("Y");
						$("#tbx_cFaultGroupNoteOther").prop('disabled', false);
					}
					else if (objID == "chk_cFaultState1") //客戶故障狀況-面板燈號
					{
						$("#hid_cFaultState1").val("Y");
						$("#tbx_cFaultStateNote1").prop('disabled', false);
					}
					else if (objID == "chk_cFaultState2") //客戶故障狀況-管理介面(iLO、IMM、iDRAC)
					{
						$("#hid_cFaultState2").val("Y");
						$("#tbx_cFaultStateNote2").prop('disabled', false);
					}
					else if (objID == "chk_cFaultStateOther") //客戶故障狀況-其他
					{
						$("#hid_cFaultStateOther").val("Y");
						$("#tbx_cFaultStateNoteOther").prop('disabled', false);
					}
					else if (objID == "chk_cFaultSpec1") //故障零件規格料號-零件規格
					{
						$("#hid_cFaultSpec1").val("Y");
						$("#tbx_cFaultSpecNote1").prop('disabled', false);
					}
					else if (objID == "chk_cFaultSpec2") //故障零件規格料號-零件料號
					{
						$("#hid_cFaultSpec2").val("Y");
						$("#tbx_cFaultSpecNote2").prop('disabled', false);
					}
					else if (objID == "chk_cFaultSpecOther") //故障零件規格料號-其他
					{
						$("#hid_cFaultSpecOther").val("Y");
						$("#tbx_cFaultSpecNoteOther").prop('disabled', false);
					}
				}
				else
				{
					$(this).iCheck('uncheck');

					if (objID == "chk_cFaultGroup1") //客戶故障狀況分類-硬體
					{
						$("#hid_cFaultGroup1").val("N");
						$("#tbx_cFaultGroupNote1").prop('disabled', true);
						$("#tbx_cFaultGroupNote1").val("");
					}
					else if (objID == "chk_cFaultGroup2") //客戶故障狀況分類-系統
					{
						$("#hid_cFaultGroup2").val("N");
						$("#tbx_cFaultGroupNote2").prop('disabled', true);
						$("#tbx_cFaultGroupNote2").val("");
					}
					else if (objID == "chk_cFaultGroup3") //客戶故障狀況分類-服務
					{
						$("#hid_cFaultGroup3").val("N");
						$("#tbx_cFaultGroupNote3").prop('disabled', true);
						$("#tbx_cFaultGroupNote3").val("");
					}
					else if (objID == "chk_cFaultGroup4") //客戶故障狀況分類-網路
					{
						$("#hid_cFaultGroup4").val("N");
						$("#tbx_cFaultGroupNote4").prop('disabled', true);
						$("#tbx_cFaultGroupNote4").val("");
					}
					else if (objID == "chk_cFaultGroupOther") //客戶故障狀況分類-其他
					{
						$("#hid_cFaultGroupOther").val("N");
						$("#tbx_cFaultGroupNoteOther").prop('disabled', true);
						$("#tbx_cFaultGroupNoteOther").val("");
					}
					else if (objID == "chk_cFaultState1") //客戶故障狀況-面板燈號
					{
						$("#hid_cFaultState1").val("N");
						$("#tbx_cFaultStateNote1").prop('disabled', true);
						$("#tbx_cFaultStateNote1").val("");
					}
					else if (objID == "chk_cFaultState2") //客戶故障狀況-管理介面(iLO、IMM、iDRAC)
					{
						$("#hid_cFaultState2").val("N");
						$("#tbx_cFaultStateNote2").prop('disabled', true);
						$("#tbx_cFaultStateNote2").val("");
					}
					else if (objID == "chk_cFaultStateOther") //客戶故障狀況-其他
					{
						$("#hid_cFaultStateOther").val("N");
						$("#tbx_cFaultStateNoteOther").prop('disabled', true);
						$("#tbx_cFaultStateNoteOther").val("");
					}
					else if (objID == "chk_cFaultSpec1") //故障零件規格料號-零件規格
					{
						$("#hid_cFaultSpec1").val("N");
						$("#tbx_cFaultSpecNote1").prop('disabled', true);
						$("#tbx_cFaultSpecNote1").val("");
					}
					else if (objID == "chk_cFaultSpec2") //故障零件規格料號-零件料號
					{
						$("#hid_cFaultSpec2").val("N");
						$("#tbx_cFaultSpecNote2").prop('disabled', true);
						$("#tbx_cFaultSpecNote2").val("");
					}
					else if (objID == "chk_cFaultSpecOther") //故障零件規格料號-其他
					{
						$("#hid_cFaultSpecOther").val("N");
						$("#tbx_cFaultSpecNoteOther").prop('disabled', true);
						$("#tbx_cFaultSpecNoteOther").val("");
					}
				}
            });	
		}

		//取得要顯示的Checkbox
		//若傳入的ID有勾選，其他就不要勾選，反之若傳入的ID沒勾選，其他就要勾選
        function getShowCheck(objID, checked) {			
			$.each($(".i-checks input[name='CheckUsed']"), function (i, cbx) {
				if ($(this).attr("id") == objID) {
                    if (checked)
					{
						//判斷若有勾選本次使用且有合約編號，要將維護服務種類設為Z03.合約
						var tNumber = $(this).attr("id").replace('CheckThisID', '');
						var ContractID = $("#hidcContractID" + tNumber).val(); //合約編號

						if (ContractID != "")
						{
							$("#ddl_cMAServiceType").val("Z03");	//維護服務種類(Z03.合約)
						}
					}
                }
                else {
					if (checked)
					{
						$(this).iCheck('uncheck');

						var tNumber = $(this).attr("id").replace('CheckThisID', '');
						var objUsed = $("#hid_CheckUsedID" + tNumber); //本次使用hiddenValue
						objUsed.val("N");
					}					
                }
            })
        }

		//查詢保固SLA明細Table
		function QuerySRDetail_Warranty(tableName)
		{
			var cStatus = $("#ddl_cStatus").val();

			var ArySERIAL = new Array();

			var trs = $("#" + tableName + " tr");

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');
				var pQuantity = 0;
				var pAtoBQuantity = 0;
				var objSerial = tds.eq(1).children().eq(0);	//序號					
				var objDisabled = tds.eq(1).children().eq(1);	//是否停用(0.啟用 1.停用)

				if (objSerial.val() != undefined) {
					if (objDisabled.val() == "0")
					{
						ArySERIAL.push(objSerial.val());
					}
				}			
			})
			
			$("#dataDivWA").html('');
			$("#img_waiting_Warranty").show();

			var TempSerialID = "";

			$.ajax({
				url: '@Url.Action("QuerySRDetail_Warranty", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
				data: {
					ArySERIAL: ArySERIAL
				},
				success: function (result) {
					var list = "";
					$.each(result, function (i, bean) {
                        if (bean != null) {
							var tIsCheck = "";
							var trClass = bean.cBGColor;

							if (bean.cUsed == "Y")
							{
								tIsCheck="checked";
							}

							list += '<tr id="tr_WA' + bean.cID + '" class="' + trClass + '">'								
								+ "<td class='hidWASerialID' style='vertical-align: middle;'>" + bean.cSerialID
								+ "    <input type='hidden' name='hidcSerialID' value=" + bean.cSerialID + ">"
								+ "</td>"
								+ "<td class='hidWAWTYID' style='vertical-align: middle;'>" + bean.cWTYID
								+ "    <input type='hidden' name='hidcWTYID' value=" + bean.cWTYID + ">"
								+ "</td>"
								+ "<td class='hidWAWTYName' style='vertical-align: middle;'>" + bean.cWTYName
								+ "    <input type='hidden' name='hidcWTYName' value=" + bean.cWTYName + ">"
								+ "</td>"
								+ "<td class='hidWAWTYSDATE' style='vertical-align: middle;'>" + bean.cWTYSDATE
								+ "    <input type='hidden' name='hidcWTYSDATE' value=" + bean.cWTYSDATE + ">"
								+ "</td>"
								+ "<td class='hidWAWTYEDATE' style='vertical-align: middle;'>" + bean.cWTYEDATE
								+ "    <input type='hidden' name='hidcWTYEDATE' value=" + bean.cWTYEDATE + ">"
								+ "</td>"
                                + "<td class='hidWASLARESP' style='vertical-align: middle;'>" + bean.cSLARESP
								+ "    <input type='hidden' name='hidcSLARESP' value=" + bean.cSLARESP + ">"
								+ "</td>"
								+ "<td class='hidWASLASRV' style='vertical-align: middle;'>" + bean.cSLASRV
								+ "    <input type='hidden' name='hidcSLASRV' value=" + bean.cSLASRV + ">"
								+ "</td>"
								+ "<td>"
								+ "    <a href=" + bean.cContractIDUrl + " target='_blank'>" + bean.cContractID + "</a>"
								+ "    <input type='hidden' name='hidcContractID' id='hidcContractID" + bean.cID + "' value=" + bean.cContractID + ">"
								+ "</td>"
								+ "<td class='hidWASUB_CONTRACTID' style='vertical-align: middle;'>" + bean.cSUB_CONTRACTID
								+ "    <input type='hidden' name='hidcSUB_CONTRACTID' value=" + bean.cSUB_CONTRACTID + ">"
								+ "</td>"
								+ "<td>"
								+ "    <a href=" + bean.cBPMFormNoUrl + " target='_blank'>" + bean.cBPMFormNo + "</a>"
								+ "    <input type='hidden' name='hidcBPMFormNo' value=" + bean.cBPMFormNo + ">"
								+ "</td>"
								+ "<td class='hidWAAdvice' style='vertical-align: middle;'>" + bean.cAdvice
								+ "    <input type='hidden' name='hidcAdvice' value=" + bean.cAdvice + ">"
								+ "</td>"
								+ '<td>'
								+ '    <label class="i-checks">'
								+ "	       <input id='CheckThisID" + bean.cID + "' name='CheckUsed' class='AllCheck' type='checkbox' " + tIsCheck + ">"
								+ '    </label>'
								+ "    <input type='hidden' id='hid_CheckUsedID" + bean.cID + "' name='hid_CheckUsed' value='" + bean.cUsed + "'>"
								+ '</td>'								
								+ "</tr>";
						}
                    });

					if (list != "") {
						list = '<table id="tableADDWA" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">'
                                + "<thead>"                                
                                + "<th>序號</th>"
								+ "<th>保固代號</th>"
                                + "<th>保固說明</th>"
							    + "<th>保固起始日</th>"
								+ "<th>保固到期日</th>"
								+ "<th>SLA回應條件</th>"
								+ "<th>SLA服務條件</th>"
								+ "<th>合約編號</th>"
								+ "<th>下包文件編號</th>"
								+ "<th>保固申請</th>"
								+ "<th>客服主管建議</th>"
								+ "<th>本次使用</th>"							    
                                + "</tr></thead><tbody>"
                                + list
                                + "</tbody></table>";
					}
                    else {
						list = "查無保固資訊!";
                    }

					$("#dataDivWA").html(list);
					$("#img_waiting_Warranty").hide();
					init_iChceck();
				}
			});
		}		

		//取得保固SLA明細Table(非新建或駁回狀態)
		function getSRDetail_Warranty()
		{	
			var cSRID = $("input[name='hid_cSRID']").val();
			var cStatus = $("#ddl_cStatus").val();

			if(cStatus != "E0001" && cSRID != "")
			{
				$("#dataDivWA").html('');			

				$.ajax({
					url: '@Url.Action("getSRDetail_Warranty", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
					data: {
						cSRID: cSRID
					},
					success: function (result) {
						var list = "";
						$.each(result, function (i, bean) {
							if (bean != null) {
								var tIsCheck = "";
								var trClass = bean.cBGColor;

								if (bean.cUsed == "Y")
								{
									tIsCheck="checked";
								}

								list += '<tr id="tr_WA' + bean.cID + '" class="' + trClass + '">'								
									+ "<td class='hidWASerialID' style='vertical-align: middle;'>" + bean.cSerialID
									+ "    <input type='hidden' name='hidcSerialID' value=" + bean.cSerialID + ">"
									+ "</td>"
									+ "<td class='hidWAWTYID' style='vertical-align: middle;'>" + bean.cWTYID
									+ "    <input type='hidden' name='hidcWTYID' value=" + bean.cWTYID + ">"
									+ "</td>"
									+ "<td class='hidWAWTYName' style='vertical-align: middle;'>" + bean.cWTYName
									+ "    <input type='hidden' name='hidcWTYName' value=" + bean.cWTYName + ">"
									+ "</td>"
									+ "<td class='hidWAWTYSDATE' style='vertical-align: middle;'>" + bean.cWTYSDATE
									+ "    <input type='hidden' name='hidcWTYSDATE' value=" + bean.cWTYSDATE + ">"
									+ "</td>"
									+ "<td class='hidWAWTYEDATE' style='vertical-align: middle;'>" + bean.cWTYEDATE
									+ "    <input type='hidden' name='hidcWTYEDATE' value=" + bean.cWTYEDATE + ">"
									+ "</td>"
									+ "<td class='hidWASLARESP' style='vertical-align: middle;'>" + bean.cSLARESP
									+ "    <input type='hidden' name='hidcSLARESP' value=" + bean.cSLARESP + ">"
									+ "</td>"
									+ "<td class='hidWASLASRV' style='vertical-align: middle;'>" + bean.cSLASRV
									+ "    <input type='hidden' name='hidcSLASRV' value=" + bean.cSLASRV + ">"
									+ "</td>"
									+ "<td>"
									+ "    <a href=" + bean.cContractIDUrl + " target='_blank'>" + bean.cContractID + "</a>"
									+ "    <input type='hidden' name='hidcContractID' value=" + bean.cContractID + ">"
									+ "</td>"
									+ "<td class='hidWASUB_CONTRACTID' style='vertical-align: middle;'>" + bean.cSUB_CONTRACTID
									+ "    <input type='hidden' name='hidcSUB_CONTRACTID' value=" + bean.cSUB_CONTRACTID + ">"
									+ "</td>"
									+ "<td>"
									+ "    <a href=" + bean.cBPMFormNoUrl + " target='_blank'>" + bean.cBPMFormNo + "</a>"
									+ "    <input type='hidden' name='hidcBPMFormNo' value=" + bean.cBPMFormNo + ">"
									+ "</td>"
									+ "<td class='hidWAAdvice' style='vertical-align: middle;'>" + bean.cAdvice
									+ "    <input type='hidden' name='hidcAdvice' value=" + bean.cAdvice + ">"
									+ "</td>"
									+ '<td>'
									+ '    <label class="i-checks">'
									+ "	       <input id='CheckThisID" + bean.cID + "' name='CheckUsed' class='AllCheck' type='checkbox' " + tIsCheck + ">"
									+ '    </label>'
									+ "    <input type='hidden' id='hid_CheckUsedID" + bean.cID + "' name='hid_CheckUsed' value='" + bean.cUsed + "'>"
									+ '</td>'								
									+ "</tr>";
							}
						});

						if (list != "") {
							list = '<table id="tableADDWA" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">'
									+ "<thead>"                                
									+ "<th>序號</th>"
									+ "<th>保固代號</th>"
									+ "<th>保固說明</th>"
									+ "<th>保固起始日</th>"
									+ "<th>保固到期日</th>"
									+ "<th>SLA回應條件</th>"
									+ "<th>SLA服務條件</th>"
									+ "<th>合約編號</th>"
									+ "<th>下包文件編號</th>"
									+ "<th>保固申請</th>"
									+ "<th>客服主管建議</th>"
									+ "<th>本次使用</th>"							    
									+ "</tr></thead><tbody>"
									+ list
									+ "</tbody></table>";
						}                    

						$("#dataDivWA").html(list);					
						init_iChceck();
						
						var display = $('#btn_submit').css('display');
						if (display == 'none')
						{
							$("#dataDivWA").find("input").each(function (index, value) {
								$(this).prop('disabled', true);
							});
						}
					}
				});
			}
		}	
		//-----↑↑↑↑↑保固SLA檔 ↑↑↑↑↑-----

		//-----↓↓↓↓↓處理與工時紀錄 ↓↓↓↓↓-----		

		//新增明細
		function AddDetailItem_Record(tableName) {
			trRecordNoCount = $("input[name='hid_trRecordNo']").val();

			if (trRecordNoCount == "" || trRecordNoCount == "0") {
				trRecordNoCount = 1;
			}
			else {
				trRecordNoCount = parseInt(trRecordNoCount) + 1;
			}

			$("input[name='hid_trRecordNo']").val(trRecordNoCount);

			var RowNumber = SetRERowNumber();
			var Engineer = SetEngineer();			
			var ReceiveTime = SetReceiveTime();
			var StartTime = SetStartTime();
			var ArriveTime = SetArriveTime();			
			var FinishTime = SetFinishTime();
			var WorkHours = SetWorkHours();			
			var Desc = SetDesc();
			var SRReport = SeSRReport();			
			var tDelButton = SetREDelButton();

			var tAlltd = RowNumber + Engineer + ReceiveTime + StartTime + ArriveTime + FinishTime + WorkHours + Desc + SRReport + tDelButton;

			$("#" + tableName).append("<tr id='trRE" + trRecordNoCount + "'>" + tAlltd + "</tr>");			

			hidePopupInit_Record(trRecordNoCount);		//初始日期元件
			PeopleSearch();				//Ajax用中文或英文姓名查詢人員帳號
		}

		//組項次
		function SetRERowNumber() {
			var reValue = "<td><label name='lbl_RERowNumber' style='font-size:14pt'>"+ trRecordNoCount +"</label></td>";
			return reValue;
		}
		
		//組服務工程師/技術主管
		function SetEngineer() {
			var reValue = "<td><input type='text' name='tbx_REcEngineerName' id='tbx_REcEngineerName" + trRecordNoCount + "' class='form-control Peoploe' style='width:200px;' placeholder='請輸入人名或英文關鍵字搜尋'>";
				reValue += "<input type='hidden' name='hid_REcEngineerID' id='hid_REcEngineerID" + trRecordNoCount + "'>";    
				reValue += "<input type='hidden' name='hid_REcDisabled' id='hid_REcDisabled" + trRecordNoCount + "' value='0'></td>";
			return reValue;
		}

		//組接單時間
		function SetReceiveTime() {
			var reValue = "<td><input type='text' name='tbx_REcReceiveTime' id='tbx_REcReceiveTime" + trRecordNoCount + "' class='form-control datetimepicker' style='width:150px;' placeholder='接單時間' onchange='TransTimeSpan(this);'></td>";
			return reValue;
		}	

		//組出發時間
		function SetStartTime() {
			var reValue = "<td><input type='text' name='tbx_REcStartTime' id='tbx_REcStartTime" + trRecordNoCount + "' class='form-control datetimepicker' style='width:150px;' placeholder='出發時間' onchange='TransTimeSpan(this);'></td>";
			return reValue;
		}

		//組到場時間
		function SetArriveTime() {
			var reValue = "<td><input type='text' name='tbx_REcArriveTime' id='tbx_REcArriveTime" + trRecordNoCount + "' class='form-control datetimepicker' style='width:150px;' placeholder='到場時間' onchange='TransTimeSpan(this);'></td>";
			return reValue;
		}

		//組完成時間
		function SetFinishTime() {
			var reValue = "<td><input type='text' name='tbx_REcFinishTime' id='tbx_REcFinishTime" + trRecordNoCount + "' class='form-control datetimepicker' style='width:150px;' placeholder='完成時間' onchange='TransTimeSpan(this);'></td>";
			return reValue;
		}

		//組工時(分鐘)
		function SetWorkHours() {
			var reValue = "<td><input type='text' name='tbx_REcWorkHours' id='tbx_REcWorkHours" + trRecordNoCount + "' class='form-control' style='width:100px;' placeholder='工時(分鐘)' readonly></td>";
			return reValue;
		}

		//組處理紀錄
		function SetDesc() {
			var tDefaultValue = "一、問題判斷： \n \n二、問題處理過程： \n \n三、結論："
			var reValue = "<td><textarea rows='3' class='form-control' style='width:200px;' placeholder='處理紀錄' name='tbx_REcDesc'>" + tDefaultValue + "</textarea></td>";
			return reValue;
		}

		////組服務報告書
		//function SeSRReport() {
		//	 var reValue = "<td>";
		//		reValue += "		<div class='form-group row'>";
		//		reValue += "			<div class='col-lg-3 dropzoneDynamic' id='zoneRE_" + trRecordNoCount + "' style='width: 200px; min-height: 100px !important; padding: 0px; display: block !important;'>";
		//		reValue += "			<div class='fallback file-box'>";
		//		reValue += "				<input name='file' type='file' multiple />"
		//		reValue += "			</div>";
		//		reValue += "			<div class='col-lg-9'>";
		//		reValue += "				<div class='attachment' id='filezoneRE_" + trRecordNoCount + "'></div>";
		//		reValue += "				<input type='hidden' class='fileids' name='hid_filezoneRE_" + trRecordNoCount + "' id='hid_filezoneRE_" + trRecordNoCount + "' value='' />";
		//		reValue += "			</div>";
		//		reValue += "		</div>";
		//		reValue += "</td>";

		//	return reValue;
		//}

		//組服務報告書
		function SeSRReport() {
			 var reValue = "<td>";
				reValue += "		<div class='dropzone' id='zoneRE_" + trRecordNoCount + "' style='width: 200px; min-height: 100px !important; padding: 0px; display: block !important;'>";
				reValue += "		<div class='fallback file-box'><input name='file' type='file' multiple /></div>";
				reValue += "		<div class='attachment' id='filezoneRE_" + trRecordNoCount + "'></div>";
				reValue += "		<input type='hidden' class='fileids' name='hid_filezoneRE' id='hid_filezoneRE_" + trRecordNoCount + "' value='' />";
				reValue += "</td>";

			return reValue;
		}

		//組刪除按鈕
		function SetREDelButton() {
			var tTrID = $("input[name='hid_trRecordNo']").val();
			var reValue = "<td><button name='btn_RecordDel' class='btn btn-danger' type='button' onclick=DelDetailItem_Record('trRE" + tTrID + "','" + trRecordNoCount + "');><i class='fa fa-trash'></i></td>";
			return reValue;
		}		

		//刪除明細
		function DelDetailItem_Record(rowId, tNo) {
			//$('#' + rowId).remove();
			$('#' + rowId).hide();
			$('#hid_REcDisabled' + tNo).val("1");
		}		
		
		//處理與工時紀錄(For新增時呼叫)
		function hidePopupInit_Record(trRecordNoCount) {
            setTimeout(function () {
                initRecord(trRecordNoCount);
				initfile();
            }, 500);

        }		
		
		//initDateTimePicker
		function initRecord(trRecordNoCount) {
			var tbx_REcReceiveTime = $('#tbx_REcReceiveTime' + trRecordNoCount);
			var tbx_REcStartTime = $('#tbx_REcStartTime' + trRecordNoCount);
			var tbx_REcArriveTime = $('#tbx_REcArriveTime' + trRecordNoCount);
			var tbx_REcFinishTime = $('#tbx_REcFinishTime' + trRecordNoCount);
			
			initDateTimePicker(tbx_REcReceiveTime);
			initDateTimePicker(tbx_REcStartTime);
			initDateTimePicker(tbx_REcArriveTime);
			initDateTimePicker(tbx_REcFinishTime);
		}
		
		function initDateTimePicker(obj) {
			$(obj).datetimepicker({
				minView: "hour", //只顯示到每日的小時(含每小時5分鐘顯示)
                format: "yyyy-mm-dd hh:ii",
                autoclose: true, //當選擇一個日期之後是否立即關閉此日期時間選擇器。
                todayBtn: "linked", //如果此值為true或"linked"，則在日期時間選擇器組件的底部顯示一個today按鈕用以選擇當前日期。如果是true，today按鈕僅僅將視圖轉到當天的日期，如果是linked，當天日期將會被選中。
                todayHighlight: true, //如果為true，閃亮當前日期。
            });
		}
		
		
		//初始化dropzone
		function initfile()
		{
            dropzoneInit1("@Url.Action("AjaxFileUpload", "Ajax")");			
		}

		//初始化dropzone
        function dropzoneInit1(uploadUrl) {
            $.each($(".dropzone"), function () {
                try {
                    var zone = $(this);
                    $(this).dropzone({
                        url: uploadUrl,
                        method: 'post',
                        dictDefaultMessage: "把檔案拉進來或點我選檔案(可選多檔) <br/>※不支援.msg檔上傳, 請<a href='http://tsti-bpm01/files/msg_to_mht.png' target='_blank'> 轉換成MHT</a>或圖檔。",
                        accept: function (file, done) {
                            console.log($(zone).data("namerule"));
                            if ($(zone).data("namerule") != null) {
                                //檔名規則檢核
                                //file.name  上傳檔案的檔名（含副檔名）
                                var namerule = $(zone).data("namerule");
                                var pArray = namerule.split(",");
                                var tIsExits = false; //檔案是否合法

                                pArray.forEach(function (element) {
                                    if (file.name.indexOf(element) != -1) {
                                        tIsExits = true;
                                    }
                                });

                            } else {
                                done();
                            }
                        },
                        acceptedFiles: ".jpg,.png,.jpge,.gif,.pdf,.doc,.docx,.xls,.xlsx,.txt,.ppt,.pptx,.zip,.rar,.7z,.csv,.mht,.mp4,.mov",
                        createImageThumbnails: false,
                        init: function () {
                            this.on("success", function (result) {
								var obj = $.parseJSON(result.xhr.responseText);

								var doc = "<div class=\"file-box\" id='" + obj.id + "'>";
								doc += "<div class=\"file\">";
								doc += "<a href='" + fileUrl + obj.fileName + "'" + ((".jpg .jpeg .png .bmp .gif".indexOf(obj.fileExt) != -1) ? "" : "download='" + obj.fileOrgName + "'") + " target='_blank'>";
								doc += "<span class=\"corner\"></span>";
								


								if ($(zone).data("type") == null) {
									doc += "<div class=\"file-name\">" + obj.fileOrgName;
									doc += "<a href=\"javascript:delFile('" + obj.id + "', 'hid_file' + '" + zone.prop("id") + "')\" class='btn btn-xs btn-danger btn-del'>刪除</a></div></a>";
									doc += " </div></div>";

									var fileZoneObj = $("#file" + zone.prop("id"))
									fileZoneObj.append(doc);

									var hidFiles = $("#hid_file" + zone.prop("id"))
									hidFiles.val(hidFiles.val() + obj.id + ",");
									console.log(hidFiles.val());

								} else if ($(zone).data("type") == "type2") { //動態產生上傳區塊使用
									doc += "<div class=\"file-name\">" + obj.fileOrgName;
									doc += "<a href=\"javascript:delFile('" + obj.id + "', '" + zone.prop("id").substr(0, zone.prop("id").lastIndexOf('zone')) + 'hid_file' + zone.prop("id").substr(zone.prop("id").lastIndexOf('zone')) + "')\" class='btn btn-xs btn-danger btn-del'>刪除</a></div></a>";
									doc += " </div></div>";

									var fileZoneObj = $("#" + zone.prop("id").substr(0, zone.prop("id").lastIndexOf('zone')) + 'file' + zone.prop("id").substr(zone.prop("id").lastIndexOf('zone')))
									fileZoneObj.append(doc);

									var hidFiles = $("#" + zone.prop("id").substr(0, zone.prop("id").lastIndexOf('zone')) + 'hid_file' + zone.prop("id").substr(zone.prop("id").lastIndexOf('zone')))
									hidFiles.val(hidFiles.val() + obj.Id + ",");
									console.log(hidFiles.val());
								}

							});

							this.on("complete", function (file) {
								this.removeFile(file);
							});
                        }
                    })
                } catch (e) {
                    console.log(e);
                }
            })
        }		

		//日期相減取得分鐘
		function TransTimeSpan(obj)
		{			
			var Msg = "";
			var ReceiveTime =	$(obj).parent().parent().find('input[name="tbx_REcReceiveTime"]');	//接單時間
			var StartTime =	$(obj).parent().parent().find('input[name="tbx_REcStartTime"]');	//出發時間
			var ArriveTime =	$(obj).parent().parent().find('input[name="tbx_REcArriveTime"]');	//到場時間
			var FinishTime =	$(obj).parent().parent().find('input[name="tbx_REcFinishTime"]');	//完成時間
			var WorkHours = $(obj).parent().parent().find('input[name="tbx_REcWorkHours"]');		//工時(分鐘)
			
			if (ReceiveTime.val() != "" && StartTime.val() != "")
			{
				if (Date.parse(ReceiveTime.val()) > Date.parse(StartTime.val())) {
					Msg += '【接單時間】不能大於【出發時間】！\n';
				}
			}

			if (StartTime.val() != "" && ArriveTime.val() != "")
			{
				if (Date.parse(StartTime.val()) > Date.parse(ArriveTime.val())) {
					Msg += '【出發時間】不能大於【到場時間】！\n';
				}
			}

			if (ArriveTime.val() != "" && FinishTime.val() != "" )
			{
				if (Date.parse(ArriveTime.val()) > Date.parse(FinishTime.val())) {
					Msg += '【到場時間】不能大於【完成時間】！\n';
				}	
				else
				{
					var myStartDate = new Date(ArriveTime.val());
					var myEndDate = new Date(FinishTime.val());

					//分鐘
					var tMin = (myEndDate - myStartDate) / (1000 * 60);
					WorkHours.val(tMin);
				}
			}

			if (Msg != "")
			{
				alert(Msg);
				$(obj).val("");
			}			
		}		

		//檢查是否符合yyyy-MM-dd HH:mm格式
		function verifyMyDate(date) {			
			var pattern = /\d{4}\-\d{2}\-\d{2}\s\d{2}:\d{2}/;
			var correct_match = date.match(pattern);

			if (correct_match) {
				return true;
			}
			else {
			    return false;
			}
		}
		//-----↑↑↑↑↑處理與工時紀錄 ↑↑↑↑↑-----		

		//-----↓↓↓↓↓零件更換檔 ↓↓↓↓↓-----		

		//新增明細
		function AddDetailItem_Parts(tableName) {
			trPartsNoCount = $("input[name='hid_trPartsNo']").val();

			if (trPartsNoCount == "" || trPartsNoCount == "0") {
				trPartsNoCount = 1;
			}
			else {
				trPartsNoCount = parseInt(trPartsNoCount) + 1;
			}

			$("input[name='hid_trPartsNo']").val(trPartsNoCount);

			var RowNumber = SetPARowNumber();
			var XCHP = SetXCHP();
			var MaterialID = SetMaterialID_Parts();
			var MaterialName = SetMaterialName_Parts();
			var OldCT = SetOldCT();
			var NewCT = SetNewCT();			
			var HPCT = SetHPCT();
			var NewUEFI = SetNewUEFI();			
			var StandbySerialID = SetStandbySerialID();
			var HPCaseID = SetHPCaseID();
			var ArriveDate = SetArriveDate();			
			var ReturnDate = SetReturnDate();
			var PersonalDamage = SetPersonalDamage();
			var Note = SetNote();
			var tDelButton = SetPADelButton();

			var tAlltd = RowNumber + XCHP +MaterialID + MaterialName + OldCT + NewCT + HPCT + NewUEFI + StandbySerialID + 
			            HPCaseID + ArriveDate + ReturnDate + PersonalDamage + Note + tDelButton;

			$("#" + tableName).append("<tr id='trPA" + trPartsNoCount + "'>" + tAlltd + "</tr>");

			hidePopupInit();			//初始日期元件
			findMaterialByKeyword();	//用關鍵字查詢物料
		}

		//組項次
		function SetPARowNumber() {
			var reValue = "<td><label name='lbl_PARowNumber' style='font-size:14pt'>"+ trPartsNoCount +"</label></td>";
			return reValue;
		}

		//組XC HP申請零件
		function SetXCHP() {
			var reValue = "<td><input type='text' name='tbx_PAcXCHP' id='tbx_PAcXCHP" + trPartsNoCount + "' class='form-control' style='width:150px;' placeholder='XC HP申請零件'>";
			    reValue += "<input type='hidden' name='hid_PAcDisabled' id='hid_PAcDisabled" + trPartsNoCount + "' value='0'></td>";
			return reValue;
		}	
		
		//組更換零件料號ID
		function SetMaterialID_Parts() {
			var reValue = "<td><input type='text' name='tbx_PAcMaterialID' id='tbx_PAcMaterialID" + trPartsNoCount + "' class='form-control materialSpare' style='width:150px;' placeholder='請輸入料號或料號說明的關鍵字'></td>";
			return reValue;
		}

		//組料號說明
		function SetMaterialName_Parts() {
			var reValue = "<td><textarea rows='3' class='form-control' style='width:200px;' placeholder='料號說明' name='tbx_PAcMaterialName' id='tbx_PAcMaterialName" + trPartsNoCount + "'></textarea></td>";
			return reValue;
		}

		//組Old CT
		function SetOldCT() {
			var reValue = "<td><input type='text' name='tbx_PAcOldCT' id='tbx_PAcOldCT" + trPartsNoCount + "' class='form-control' style='width:100px;' placeholder='Old CT'></td>";
			return reValue;
		}		

		//組New CT
		function SetNewCT() {
			var reValue = "<td><input type='text' name='tbx_PAcNewCT' id='tbx_PAcNewCT" + trPartsNoCount + "' class='form-control' style='width:100px;' placeholder='New CT'></td>";
			return reValue;
		}		

		//組cHPCT
		function SetHPCT() {
			var reValue = "<td><input type='text' name='tbx_PAcHPCT' id='tbx_PAcHPCT" + trPartsNoCount + "' class='form-control' style='width:100px;' placeholder='HP CT'></td>";
			return reValue;
		}

		//組New UEFI 
		function SetNewUEFI () {
			var reValue = "<td><input type='text' name='tbx_PAcNewUEFI' id='tbx_PAcNewUEFI" + trPartsNoCount + "' class='form-control' style='width:100px;' placeholder='New UEFI '></td>";
			return reValue;
		}

		//組備機序號
		function SetStandbySerialID() {
			var reValue = "<td><input type='text' name='tbx_PAcStandbySerialID' id='tbx_PAcStandbySerialID" + trPartsNoCount + "' class='form-control' style='width:100px;' placeholder='備機序號'></td>";
			return reValue;
		}

		//組HP Case ID
		function SetHPCaseID() {
			var reValue = "<td><input type='text' name='tbx_PAcHPCaseID' id='tbx_PAcHPCaseID" + trPartsNoCount + "' class='form-control' style='width:100px;' placeholder='HP Case ID'></td>";
			return reValue;
		}

		//組到貨日
		function SetArriveDate() {
			var reValue = "<td><input type='text' name='tbx_PAcArriveDate' id='tbx_PAcArriveDate" + trPartsNoCount + "' class='form-control calendar' style='width:100px;' placeholder='到貨日'></td>";
			return reValue;
		}		

		//組歸還日
		function SetReturnDate() {
			var reValue = "<td><input type='text' name='tbx_PAcReturnDate' id='tbx_PAcReturnDate" + trPartsNoCount + "' class='form-control calendar' style='width:100px;' placeholder='歸還日'></td>";
			return reValue;
		}

		//組是否有人損
		function SetPersonalDamage() {
			var reValue = "<td><select class='form-control' style='width:80px;' name='ddl_PAcPersonalDamage' id='ddl_PAcPersonalDamage" + trPartsNoCount + "'><option value = 'N'>N_否</option><option value = 'Y'>Y_是</option></select></td>";
			return reValue;
		}		

		//組備註
		function SetNote() {
			var reValue = "<td><textarea rows='3' class='form-control' style='width:200px;' placeholder='備註' name='tbx_PAcNote'></textarea></td>";
			return reValue;
		}

		//組刪除按鈕
		function SetPADelButton() {
			var tTrID = $("input[name='hid_trPartsNo']").val();
			var reValue = "<td><button name='btn_PartsDel' class='btn btn-danger' type='button' onclick=DelDetailItem_Parts('trPA" + tTrID + "','" + trPartsNoCount + "');><i class='fa fa-trash'></i></td>";
			return reValue;
		}		

		//刪除明細
		function DelDetailItem_Parts(rowId, tNo) {
			//$('#' + rowId).remove();
			$('#' + rowId).hide();
			$('#hid_PAcDisabled' + tNo).val("1");
		}

		//零件更換檔(For新增時呼叫)
		function hidePopupInit() {
            setTimeout(function () {
                init();
            }, 500);

        }

		function init() {
			$('.calendar').datepicker({
				todayBtn: "linked",
				keyboardNavigation: false,
				forceParse: false,
				calendarWeeks: false,
				autoclose: true,
				format: "yyyy-mm-dd"
			});			
		}
		//-----↑↑↑↑↑零件更換檔 ↑↑↑↑↑-----
		
	</script>
}

	@section breadcrumb_section{
	<div class="col-lg-10">
		<h2>一般服務</h2>
		<ol class="breadcrumb">
			<li class="breadcrumb-item">
				<a href="#">服務管理</a>
			</li>
			<li class="breadcrumb-item active">
				<strong>一般服務</strong>
			</li>
		</ol>
	</div>
}

	<div class="row">
		<!--報修資訊-->
		<div class="col-lg-12">
			<div class="ibox ">
				<div class="ibox-title">
					<h5>
						報修資訊						
					</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					@model OneService.Controllers.ServiceRequestController.ViewModel //載入StatusViewModel
					<form id="form1" name="form" action='@Url.Action("SaveGenerallySR", "ServiceRequest")' method="post">
						<!--目前tr的筆數-->
						<input type="hidden" name="hid_trContactNo" value="@ViewBag.trContactNo">
						<input type="hidden" name="hid_trProductNo" value="@ViewBag.trProductNo">
						<input type="hidden" name="hid_trWarrantyNo">
						<input type="hidden" name="hid_trRecordNo" value="@ViewBag.trRecordNo">
						<input type="hidden" name="hid_trPartsNo" value="@ViewBag.trPartsNo">
						
						@{
							if (ViewBag.cSRID != "")
							{
								var srid = ViewBag.cSRID; 
															<div class="form-group row">
																<button id="btn_Edit" class="btn btn-info btn-lg" type="button" onclick="EditSRID();">
																	<i class="fa fa-pencil" style="font-size:large"> 編 輯</i>
																</button>
																<img id="waitingImgEdit" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:0px 10px" alt="">
																&nbsp;&nbsp;&nbsp;&nbsp;
																<button id="btn_submitUP" class="btn btn-primary btn-lg" type="button" onclick="ShowSRConfirmDialogMsg('確認', '您是否確認提交？');">
																	<i class="fa fa-arrow-circle-up" style="font-size:large"> 提 交</i>
																</button>
																<img id="waitingImgUP" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:0px 10px" alt="">
																&nbsp;&nbsp;&nbsp;&nbsp;
																<button id="btn_CopySRID" class="btn btn-success btn-lg" type="button" onclick="window.open('@Url.Action("GenerallySR", "ServiceRequest", new { CopySRID = srid })','_blank');">
																	<i class="fa fa-files-o" style="font-size:large"> 複 製</i>
																</button>										
																&nbsp;&nbsp;&nbsp;&nbsp;
																<button id="btn_ShowHistoryLog" class="btn btn-warning btn-lg" type="button">
																	<i class="fa fa-search" style="font-size:large">更改歷史記錄</i>
																</button>
																&nbsp;&nbsp;&nbsp;&nbsp;
																<a class="btn btn-danger btn-lg" href="@Url.Action("DownloadDeliveryInfo", "ServiceRequest", new { cSRID = srid })"><i class="fa fa-file-excel-o" style="font-size:large"> 產生快遞單 </i></a>
															</div>
							}
						}

						<div class="form-group row">
							<label class="col-lg-2 col-form-label">ID</label>
							<div class="col-lg-4">
								<label class="col-form-label" style="color:blue;">@ViewBag.cSRID</label>								
							</div>							
							<!--目前SRID-->
							<input type="hidden" name="hid_cSRID" value="@ViewBag.cSRID">
							<!--登入者是否可以編輯服務案件-->
							<input type="hidden" id="hid_pIsCanEditSR" name="hid_pIsCanEditSR" value="@ViewBag.pIsCanEditSR">
							<!--目前系統GUID-->
							<input type="hidden" name="hid_cSystemGUID" value="@ViewBag.pGUID">
							<!--登人者姓名-->
							<input type="hidden" id="hid_cLoginUser_Name" name="hid_cLoginUser_Name" value="@ViewBag.cLoginUser_Name">
							<!--登人者帳號-->
							<input type="hidden" id="hid_cLoginUser_EmployeeNO" name="hid_cLoginUser_EmployeeNO" value="@ViewBag.cLoginUser_EmployeeNO">
							<!--登人者ERPID-->
							<input type="hidden" id="hid_cLoginUser_ERPID" name="hid_cLoginUser_ERPID" value="@ViewBag.cLoginUser_ERPID">
							<!--登人者工作地點-->
							<input type="hidden" id="hid_cLoginUser_WorkPlace" name="hid_cLoginUser_WorkPlace" value="@ViewBag.cLoginUser_WorkPlace">
							<!--登人者公司別-->
							<input type="hidden" id="hid_cLoginUser_CompCode" name="hid_cLoginUser_CompCode" value="@ViewBag.cLoginUser_CompCode">
							<!--登人者工廠別-->
							<input type="hidden" id="hid_cLoginUser_BUKRS" name="hid_cLoginUser_BUKRS" value="@ViewBag.cLoginUser_BUKRS">
							<!--登人者單位-->
							<input type="hidden" id="hid_cLoginUser_DepartmentName" name="hid_cLoginUser_DepartmentName" value="@ViewBag.cLoginUser_DepartmentName">
							<!--登人者單位NO-->
							<input type="hidden" id="hid_cLoginUser_DepartmentNO" name="hid_cLoginUser_DepartmentNO" value="@ViewBag.cLoginUser_DepartmentNO">
							<!--登人者利潤中心ID-->
							<input type="hidden" id="hid_cLoginUser_ProfitCenterID" name="hid_cLoginUser_ProfitCenterID" value="@ViewBag.cLoginUser_ProfitCenterID">
							<!--登人者成本中心ID-->
							<input type="hidden" id="hid_cLoginUser_CostCenterID" name="hid_cLoginUser_CostCenterID" value="@ViewBag.cLoginUser_CostCenterID">
							<!--登人者是否為主管-->
							<input type="hidden" id="hid_cLoginUser_IsManager" name="hid_cLoginUser_IsManager" value="@ViewBag.pIsManager">
							<!--程式作業編號檔系統ID(一般服務)-->
							<input type="hidden" id="hid_OperationID" name="hid_OperationID" value="@ViewBag.pOperationID">
							<!--目前狀態-->
							<input type="hidden" id="hid_cNowStatus" name="hid_cNowStatus" value="@ViewBag.pStatus">
							<!--目前預排日期值-->
							<input type="hidden" id="hid_cNowScheduleDate" name="hid_cNowScheduleDate" value="@ViewBag.cScheduleDate">
							<label class="col-lg-2 col-form-label">*狀態</label>
							<div class="col-lg-4">
								<select asp-for="ddl_cStatus" asp-items="Model.ListStatus" class="form-control Status" disabled="@(ViewBag.cSRID == "" ? false : true)" ></select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">*客戶</label>
							<div class="col-lg-4">
							<input type="text" id="tbx_cCustomerName" name="tbx_cCustomerName" class="form-control CustName" placeholder="請輸入客戶名稱或統編的關鍵字" value="@ViewBag.cCustomerName">
								<label class="col-lg-2 col-form-label" id="lbl_cCustomerID" name="lbl_cCustomerID">@ViewBag.cCustomerID</label>
								<input type="hidden" id="hid_cCustomerID" name="hid_cCustomerID" value="@ViewBag.cCustomerID" />
							</div>
							<label class="col-lg-2 col-form-label">*客戶類型</label>
							<div class="col-lg-4">
								<select asp-for="ddl_cCustomerType" asp-items="Model.ListCustomerType" class="form-control CustomerType" disabled></select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">*說明</label>
							<div class="col-lg-10">
								<input type="text" id="tbx_cDesc" name="tbx_cDesc" class="form-control" placeholder="說明" value="@ViewBag.cDesc" title="@ViewBag.cDesc">
							</div>							
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">*詳細描述</label>
							<div class="col-lg-10">
								<textarea rows="3" class="form-control" placeholder="詳細描述" id="tbx_cNotes" name="tbx_cNotes" title="@ViewBag.cNotes">@ViewBag.cNotes</textarea>
							</div>							
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">檢附文件</label>
							<div class="col-lg-10">
								<!-- 檔案上傳start-->
								<div class="form-group row">
									<div class="col-lg-3 dropzone" id="zone_1">
										<div class="fallback file-box">
											<input name="file" type="file" multiple />
										</div>
									</div>
									<div class="col-lg-9">
										<div class="attachment" id="filezone_1"></div>
										<input type="hidden" class="fileids" name="hid_filezone_1" id="hid_filezone_1" value="@ViewBag.cAttachement" />
									</div>
								</div>
								<!-- 檔案上傳end-->
							</div>
						</div>

						<div class="hr-line-dashed"></div>

						<div class="form-group row">
							<label class="col-lg-2 col-form-label">*維護服務種類</label>
							<div class="col-lg-4">								
								<select asp-for="ddl_cMAServiceType" asp-items="Model.ListMAServiceType" class="form-control"></select>
							</div>
							<label class="col-lg-2 col-form-label">*是否為內部作業</label>
							<div class="col-lg-4">								
								<select asp-for="ddl_cIsInternalWork" asp-items="Model.ListIsInternalWork" class="form-control"></select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">報修類別</label>
							<div class="col-lg-4">
								@Html.DropDownList("ddl_cSRTypeOne", (IEnumerable<SelectListItem>)ViewBag.SRTypeOneList, new { @class = "form-control", @onchange = "javascript:onChangecSRTypeOne();" })
								@Html.DropDownList("ddl_cSRTypeSec", (IEnumerable<SelectListItem>)ViewBag.SRTypeSecList, new { @class = "form-control", @onchange = "javascript:onChangecSRTypeSec();" })
								@Html.DropDownList("ddl_cSRTypeThr", (IEnumerable<SelectListItem>)ViewBag.SRTypeThrList, new { @class = "form-control" })		
								<label class="col-form-label">(狀態選擇【完修】時，報修類別為必填)</label>
							</div>	
							<label class="col-lg-2 col-form-label">客戶單位類別</label>
							<div class="col-lg-4">								
								<select asp-for="ddl_cCustomerUnitType" asp-items="Model.ListCustomerUnitType" class="form-control"></select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">*報修管道</label>
							<div class="col-lg-4">								
								<select asp-for="ddl_cSRPathWay" asp-items="Model.ListSRPathWay" class="form-control SRPathWay" disabled></select>
							</div>
							<label class="col-lg-2 col-form-label">處理方式</label>
							<div class="col-lg-4">								
								<select asp-for="ddl_cSRProcessWay" asp-items="Model.ListSRProcessWay" class="form-control"></select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">*故障報修等級</label>
							<div class="col-lg-4">								
								<select asp-for="ddl_cSRRepairLevel" asp-items="Model.ListSRRepairLevel" class="form-control"></select>
							</div>
							<label class="col-lg-2 col-form-label">是否為二修</label>
							<div class="col-lg-4">								
								<select asp-for="ddl_cIsSecondFix" asp-items="Model.ListIsSecondFix" class="form-control"></select>
							</div>
						</div>	
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">延遲結案原因</label>
							<div class="col-lg-4">
								<textarea rows="3" class="form-control" placeholder="延遲結案原因" id="tbx_cDelayReason" name="tbx_cDelayReason" title="@ViewBag.cDelayReason">@ViewBag.cDelayReason</textarea>
							</div>	
							<label class="col-lg-2 col-form-label">預排日期</label>
							<div class="col-lg-4">								
								<input type="text" name="tbx_cScheduleDate" id="tbx_cScheduleDate" class="calendar form-control" placeholder="預排日期" value="@ViewBag.cScheduleDate">
								<label class="col-form-label" style="color:red;">※提醒：【延遲結案原因】欄位不為空白時，預排日期為必填。</label>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">備註</label>
							<div class="col-lg-4">
								<textarea rows="3" class="form-control" placeholder="備註" id="tbx_cRemark" name="tbx_cRemark" title="@ViewBag.cRemark">@ViewBag.cRemark</textarea>
								<label class="col-form-label" style="color:red;">※提醒：【備註】欄位的內容將會呈現於客戶服務報告書中，以利補充說明客戶聯繫事項、維修備註。</label>
							</div>							
							<label class="col-lg-2 col-form-label">建立日期</label>
							<div class="col-lg-4">
								<input type="text" id="tbx_CreatedDate" name="tbx_CreatedDate" class="form-control" placeholder="建立日期" value="@ViewBag.CreatedDate" readonly>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label"></label>
							<div class="col-lg-4"></div>	
							<label class="col-lg-2 col-form-label">派單人員</label>
							<div class="col-lg-4">
								<label class="col-form-label">@ViewBag.CreatedUserName</label>
							</div>
						</div>

						<!--L2客戶故障狀況分類資訊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										*客戶故障狀況分類資訊	(L2處理中時必填)
									</h5>
									<div class="ibox-tools">
										<a class="collapse-linkL2">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>
								<div class="ibox-content" id="div_Fault" style="display:none;">	
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">*客戶故障狀況分類</label>
										<div class="col-lg-4">		
											<input type="hidden" name="hid_cFaultGroup" id="hid_cFaultGroup" value="@ViewBag.cFaultGroup"/>
										</div>										
									</div>
									<div class="form-group row">	
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultGroup1" value="@ViewBag.cFaultGroup1"/>
											硬體<input id="chk_cFaultGroup1" name="chk_cFaultGroup1" type="checkbox" class="Fault">
										</label>	
										<div class="col-lg-6">																					
											<input type="text" id="tbx_cFaultGroupNote1" name="tbx_cFaultGroupNote1" class="form-control cFaultGroupNote" placeholder="勾選【硬體】時請說明" value="@ViewBag.cFaultGroupNote1" title="@ViewBag.cFaultGroupNote1" disabled>
										</div>										
									</div>	
									<div class="form-group row">
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultGroup2" value="@ViewBag.cFaultGroup2"/>
											系統<input id="chk_cFaultGroup2" name="chk_cFaultGroup2" type="checkbox" class="Fault">
										</label>
										<div class="col-lg-6">											
											<input type="text" id="tbx_cFaultGroupNote2" name="tbx_cFaultGroupNote2" class="form-control cFaultGroupNote" placeholder="勾選【系統】時請說明" value="@ViewBag.cFaultGroupNote2" title="@ViewBag.cFaultGroupNote2" disabled>
										</div>
									</div>
									<div class="form-group row">
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultGroup3" value="@ViewBag.cFaultGroup3"/>
											服務<input id="chk_cFaultGroup3" name="chk_cFaultGroup3" type="checkbox" class="Fault">
										</label>
										<div class="col-lg-6">											
											<input type="text" id="tbx_cFaultGroupNote3" name="tbx_cFaultGroupNote3" class="form-control cFaultGroupNote" placeholder="勾選【服務】時請說明" value="@ViewBag.cFaultGroupNote3" title="@ViewBag.cFaultGroupNote3" disabled>
										</div>
									</div>
									<div class="form-group row">
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultGroup4" value="@ViewBag.cFaultGroup4"/>
											網路<input id="chk_cFaultGroup4" name="chk_cFaultGroup4" type="checkbox" class="Fault">
										</label>
										<div class="col-lg-6">											
											<input type="text" id="tbx_cFaultGroupNote4" name="tbx_cFaultGroupNote4" class="form-control cFaultGroupNote" placeholder="勾選【網路】時請說明" value="@ViewBag.cFaultGroupNote4" title="@ViewBag.cFaultGroupNote4" disabled>
										</div>
									</div>
									<div class="form-group row">	
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultGroupOther" value="@ViewBag.cFaultGroupOther"/>
											其他<input id="chk_cFaultGroupOther" name="chk_cFaultGroupOther" type="checkbox" class="Fault">
										</label>
										<div class="col-lg-6">
											<input type="text" id="tbx_cFaultGroupNoteOther" name="tbx_cFaultGroupNoteOther" class="form-control cFaultGroupNote" placeholder="勾選【其他】時請說明" value="@ViewBag.cFaultGroupNoteOther" title="@ViewBag.cFaultGroupNoteOther" disabled>
										</div>
									</div>

									<div class="hr-line-dashed"></div>

									<div class="form-group row">
										<label class="col-lg-2 col-form-label">*客戶故障狀況</label>
										<div class="col-lg-4">		
											<input type="hidden" name="hid_cFaultState" id="hid_cFaultState" value="@ViewBag.cFaultState"/>
										</div>										
									</div>
									<div class="form-group row">	
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultState1" value="@ViewBag.cFaultState1"/>
											面板燈號<input id="chk_cFaultState1" name="chk_cFaultState1" type="checkbox" class="Fault">
										</label>	
										<div class="col-lg-6">																					
											<input type="text" id="tbx_cFaultStateNote1" name="tbx_cFaultStateNote1" class="form-control cFaultStateNote" placeholder="勾選【面板燈號】時請說明" value="@ViewBag.cFaultStateNote1" title="@ViewBag.cFaultStateNote1" disabled>
										</div>										
									</div>	
									<div class="form-group row">
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultState2" value="@ViewBag.cFaultState2"/>
											管理介面(iLO、IMM、iDRAC)<input id="chk_cFaultState2" name="chk_cFaultState2" type="checkbox" class="Fault">
										</label>
										<div class="col-lg-6">											
											<input type="text" id="tbx_cFaultStateNote2" name="tbx_cFaultStateNote2" class="form-control cFaultStateNote" placeholder="勾選【管理介面(iLO、IMM、iDRAC)】時請說明" value="@ViewBag.cFaultStateNote2" title="@ViewBag.cFaultStateNote2" disabled>
										</div>
									</div>
									<div class="form-group row">	
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultStateOther" value="@ViewBag.cFaultStateOther"/>
											其他<input id="chk_cFaultStateOther" name="chk_cFaultStateOther" type="checkbox" class="Fault">
										</label>
										<div class="col-lg-6">
											<input type="text" id="tbx_cFaultStateNoteOther" name="tbx_cFaultStateNoteOther" class="form-control cFaultStateNote" placeholder="勾選【其他】時請說明" value="@ViewBag.cFaultStateNoteOther" title="@ViewBag.cFaultStateNoteOther" disabled>
										</div>
									</div>

									<div class="hr-line-dashed"></div>

									<div class="form-group row">
										<label class="col-lg-2 col-form-label">*故障零件規格料號</label>
										<div class="col-lg-4">		
											<input type="hidden" name="hid_cFaultSpec" id="hid_cFaultSpec" value="@ViewBag.cFaultSpec"/>
										</div>										
									</div>
									<div class="form-group row">	
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultSpec1" value="@ViewBag.cFaultSpec1"/>
											零件規格<input id="chk_cFaultSpec1" name="chk_cFaultSpec1" type="checkbox" class="Fault">
										</label>	
										<div class="col-lg-6">																					
											<input type="text" id="tbx_cFaultSpecNote1" name="tbx_cFaultSpecNote1" class="form-control cFaultSpecNote" placeholder="勾選【零件規格】時請說明" value="@ViewBag.cFaultSpecNote1" title="@ViewBag.cFaultSpecNote1" disabled>
										</div>										
									</div>	
									<div class="form-group row">	
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultSpec2" value="@ViewBag.cFaultSpec2"/>
											零件料號<input id="chk_cFaultSpec2" name="chk_cFaultSpec2" type="checkbox" class="Fault">
										</label>
										<div class="col-lg-6">											
											<input type="text" id="tbx_cFaultSpecNote2" name="tbx_cFaultSpecNote2" class="form-control cFaultSpecNote" placeholder="勾選【零件料號】時請說明" value="@ViewBag.cFaultSpecNote2" title="@ViewBag.cFaultSpecNote2" disabled>
										</div>
									</div>
									<div class="form-group row">	
										<label class="col-lg-2 i-checks" style="text-align: right;">
											<input type="hidden" id="hid_cFaultSpecOther" value="@ViewBag.cFaultSpecOther"/>
											其他<input id="chk_cFaultSpecOther" name="chk_cFaultSpecOther" type="checkbox" class="Fault">
										</label>
										<div class="col-lg-6">
											<input type="text" id="tbx_cFaultSpecNoteOther" name="tbx_cFaultSpecNoteOther" class="form-control cFaultSpecNote" placeholder="勾選【其他】時請說明" value="@ViewBag.cFaultSpecNoteOther" title="@ViewBag.cFaultSpecNoteOther" disabled>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!--客戶報修窗口資訊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										*客戶報修窗口資訊
										<button id="btn_addRepairInfo" class="btn btn-success" type="button" style="margin-left: 10px;" onclick="btn_AddContactInfo_onclick();">
											<i class="fa fa-user-plus" style="margin-right: 5px;"></i>
											<span style="font-weight: bold; margin: 5px;">新增窗口</span>
										</button>
										<button id="btn_editRepairInfo" class="btn btn-primary" type="button" style="margin-left: 10px;">
											<i class="fa fa-pencil" style="margin-right: 5px;"></i>
											<span style="font-weight: bold; margin: 5px;">編輯窗口</span>
										</button>
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>
								<div class="ibox-content" id="div_Repair">
									<div class="form-group row">									
										<button id="btn_clearRepairInfo" class="btn btn-secondary btn-lg" type="button" onclick="clearRepairName();">
											<i class="fa fa-trash"></i>
											<span style="font-weight: bold; margin: 5px;">清除客戶報修人</span>
										</button>										
									</div>
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">*姓名(報修人)</label>
										<div class="col-lg-4">
											<input type="text" id="tbx_cRepairName" name="tbx_cRepairName" class="form-control RepairName" onclick="showContactInfo('tbx_cRepairName');" placeholder="請點擊我查詢姓名(報修人)" value="@ViewBag.cRepairName" title="@ViewBag.cRepairName" disabled readonly>
										</div>
										<label class="col-lg-2 col-form-label">*地址(報修人)</label>
										<div class="col-lg-4">
											<input type="text" id="tbx_cRepairAddress" name="tbx_cRepairAddress" class="form-control RepairAddress" placeholder="地址(報修人)" value="@ViewBag.cRepairAddress" title="@ViewBag.cRepairAddress" disabled>
										</div>
									</div>
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">電話(報修人)</label>
										<div class="col-lg-4">
											<input type="text" id="tbx_cRepairPhone" name="tbx_cRepairPhone" class="form-control RepairPhone" placeholder="電話(報修人)" value="@ViewBag.cRepairPhone" title="@ViewBag.cRepairPhone" disabled>
										</div>
										<label class="col-lg-2 col-form-label">手機(報修人)</label>
										<div class="col-lg-4">
											<input type="text" id="tbx_cRepairMobile" name="tbx_cRepairMobile" class="form-control RepairMobile" placeholder="手機(報修人)" value="@ViewBag.cRepairMobile" title="@ViewBag.cRepairMobile" disabled>
										</div>
									</div>									
									<div class="form-group row">										
										<label class="col-lg-2 col-form-label">Email(報修人)</label>
										<div class="col-lg-4">
										<input type="text" id="tbx_cRepairEmail" name="tbx_cRepairEmail" class="form-control RepairEmail" placeholder="Email(報修人)" value="@ViewBag.cRepairEmail" title="@ViewBag.cRepairEmail" disabled>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!--客戶聯絡窗口資訊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										*客戶聯絡窗口資訊										
										<button type="button" class="btn btn-success" onclick="AddDetailItem_Contact('tableCO');"><i class="fa fa-plus" style="margin-right: 5px;"></i>新增</button>
										<button id="btn_addContactInfo" class="btn btn-success" type="button" style="margin-left: 10px;" onclick="btn_AddContactInfo_onclick();">
											<i class="fa fa-user-plus" style="margin-right: 5px;"></i>
											<span style="font-weight: bold; margin: 5px;">新增窗口</span>
										</button>
										<button id="btn_editContactInfo" class="btn btn-primary" type="button" style="margin-left: 10px;">
											<i class="fa fa-pencil" style="margin-right: 5px;"></i>
											<span style="font-weight: bold; margin: 5px;">編輯窗口</span>
										</button>
										<button id="btn_CopyContactInfo" class="btn btn-info" type="button" style="margin-left: 10px;" onclick="CopyRepairInfo('tableCO');">
											<i class="fa fa-clipboard" style="margin-right: 5px;"></i>
											<span style="font-weight: bold; margin: 5px;">同報修人</span>
										</button>
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>
								@{
									if (ViewBag.pStatus == "E0001")
									{
																	<!--新建階段-->
																	<div class="ibox-content" style="overflow: scroll">											
																		<table id="tableCO" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
																			<thead>
																				<tr>													
																					<th>項次</th>	
																					<th>*姓名(聯絡人)</th>
																					<th>*地址(聯絡人)</th>
																					<th>電話(聯絡人)</th>
																					<th>手機(聯絡人)</th>
																					<th>E-Mail(聯絡人)</th>
																					<th width="130">刪除</th>
																				</tr>
																			</thead>
																			<tbody>
																				@{
														if (ViewBag.cSRID != "" || ViewBag.CopySRID != "")
														{
															int count = 0;
															foreach (var bean in ViewBag.Detailbean_Contact)
															{
																count++;
																														<tr id='trContactNo@(count)'>																	
																															<td>
																																<label name='lbl_CORowNumber' style='font-size:14pt'>@(count)</label>
																															</td>	
																															<td>
																																<input type='text' name='tbx_COcContactName' @("id=tbx_COcContactName" + count) class='form-control ContactName' style='width:200px;' value="@bean.CContactName" title="@bean.CContactName">
																																<input type='hidden' name='hid_COcDisabled' @("id=hid_COcDisabled" + count) value=@bean.Disabled>
																																<button type='button' name='btn_COcContactName' @("id=btn_COcContactName" + count) class='btn btn-primary' onclick="showContactInfo('tbx_COcContactName' + @(count));" title='請點擊我查詢姓名(聯絡人)'><i class='fa fa-search'></i></button>
																															</td>															
																															<td>
																																<textarea rows='3' name='tbx_COcContactAddress' @("id=tbx_COcContactAddress" + count) class='form-control ContactAddress' style='width:200px;' title="@bean.CContactAddress">@bean.CContactAddress</textarea>
																															</td>
																															<td>
																																<input type='text' name='tbx_COcContactPhone' @("id=tbx_COcContactPhone" + count) class='form-control ContactPhone' style='width:200px;' value="@bean.CContactPhone" title="@bean.CContactPhone">
																															</td>
																															<td>
																																<input type='text' name='tbx_COcContactMobile' @("id=tbx_COcContactMobile" + count) class='form-control ContactMobile' style='width:200px;' value="@bean.CContactMobile" title="@bean.CContactMobile">
																															</td>
																															<td>
																																<input type='text' name='tbx_COcContactEmail' @("id=tbx_COcContactEmail" + count) class='form-control ContactEmail' style='width:350px;' value="@bean.CContactEmail" title="@bean.CContactEmail">
																															</td>
																															<td>
																																<button name="btn_ContactDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Contact('trContactNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>																		
																															</td>																							
																														</tr>
															}
														}
																				}
																			</tbody>
																		</table>
																	</div>
									}
									else
									{
																	<!--審核、駁回階段-->
																	<div class="ibox-content" style="overflow: scroll">											
																		<table id="tableCO" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
																			<thead>
																				<tr>
																					<th>項次</th>
																					<th>*姓名(聯絡人)</th>
																					<th>*地址(聯絡人)</th>
																					<th>電話(聯絡人)</th>
																					<th>手機(聯絡人)</th>
																					<th>E-Mail(聯絡人)</th>
																					<th width="130">刪除</th>
																				</tr>
																			</thead>
																			<tbody>
																				@{
														if (ViewBag.cSRID != "")
														{
															int count = 0;
															foreach (var bean in ViewBag.Detailbean_Contact)
															{
																count++;
																														<tr id='trContactNo@(count)'>																	
																															<td>
																																<label name='lbl_CORowNumber' style='font-size:14pt'>@(count)</label>
																															</td>	
																															<td>
																																<input type='text' name='tbx_COcContactName' @("id=tbx_COcContactName" + count) class='form-control ContactName' style='width:200px;' value="@bean.CContactName" title="@bean.CContactName">
																																<input type='hidden' name='hid_COcDisabled' @("id=hid_COcDisabled" + count) value=@bean.Disabled>
																																<button type='button' name='btn_COcContactName' @("id=btn_COcContactName" + count) class='btn btn-primary' onclick="showContactInfo('tbx_COcContactName' + @(count));" title='請點擊我查詢姓名(聯絡人)'><i class='fa fa-search'></i></button>
																															</td>															
																															<td>
																																<textarea rows='3' name='tbx_COcContactAddress' @("id=tbx_COcContactAddress" + count) class='form-control ContactAddress' style='width:200px;' title="@bean.CContactAddress">@bean.CContactAddress</textarea>
																															</td>
																															<td>
																																<input type='text' name='tbx_COcContactPhone' @("id=tbx_COcContactPhone" + count) class='form-control ContactPhone' style='width:200px;' value="@bean.CContactPhone" title="@bean.CContactPhone">
																															</td>
																															<td>
																																<input type='text' name='tbx_COcContactMobile' @("id=tbx_COcContactMobile" + count) class='form-control ContactMobile' style='width:200px;' value="@bean.CContactMobile" title="@bean.CContactMobile">
																															</td>
																															<td>
																																<input type='text' name='tbx_COcContactEmail' @("id=tbx_COcContactEmail" + count) class='form-control ContactEmail' style='width:350px;' value="@bean.CContactEmail" title="@bean.CContactEmail">
																															</td>
																															<td>
																																<button name="btn_ContactDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Contact('trContactNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>																		
																															</td>																							
																														</tr>
															}
														}
																				}
																			</tbody>
																		</table>
																	</div>
									}								
								}
							</div>
						</div>

						<!--產品序號資訊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										產品序號資訊
										<button type="button" class="btn btn-success" onclick="AddDetailItem_Product('tablePR');"><i class="fa fa-plus" style="margin-right: 5px;"></i>新增</button>
										<small>											
											<br />
											(狀態選擇【完修】時，產品序號資訊為必填)
										</small>
										
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>
								@{
									if (ViewBag.pStatus == "E0001")
									{
																	<!--新建階段-->
																	<div class="ibox-content" style="overflow: scroll">											
																		<table id="tablePR" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
																			<thead>
																				<tr>													
																					<th>項次</th>	
																					<th>*序號</th>
																					<th>*機器型號</th>
																					<th>Product Number</th>
																					<th>料號</th>
																					<th>更換後序號</th>
																					<th>裝機資訊</th>
																					<th width="130">刪除</th>
																				</tr>
																			</thead>
																			<tbody>
																				@{
														if (ViewBag.cSRID != "" || ViewBag.CopySRID != "")
														{
															int count = 0;
															foreach (var bean in ViewBag.Detailbean_Product)
															{
																count++;
																														<tr id='trProductNo@(count)'>																	
																															<td>
																																<label name='lbl_PRRowNumber' style='font-size:14pt'>@(count)</label>
																															</td>	
																															<td>
																																<input type='text' name='tbx_PRcSerialID' @("id=tbx_PRcSerialID" + count) class='form-control Serial' style='width:200px;' placeholder='序號' value="@bean.CSerialId" title="@bean.CSerialId">																		
																																<input type='hidden' name='hid_PRcDisabled' @("id=hid_PRcDisabled" + count) value=@bean.Disabled>
																															</td>															
																															<td>
																																<textarea rows="3" class="form-control" style='width:200px;' placeholder="機器型號" name="tbx_PRcMaterialName" @("id=tbx_PRcMaterialName" + count) title="@bean.CMaterialName">@bean.CMaterialName</textarea>
																															</td>
																															<td>
																																<input type='text' name='tbx_PRcProductNumber' @("id=tbx_PRcProductNumber" + count) class='form-control' style='width:150px;' value="@bean.CProductNumber" title="@bean.CProductNumber">
																															</td>
																															<td>
																																<a href="javascript:void(0);showBOMDialog('@bean.CMaterialId')">@bean.CMaterialId</a>
																																<input type='hidden' name='hid_PRcMaterialID' @("id=hid_PRcMaterialID" + count) value="@bean.CMaterialId">
																															</td>
																															<td>
																																<input type='text' name='tbx_PRcNewSerialID' @("id=tbx_PRcNewSerialID" + count) class='form-control' style='width:150px;' value="@bean.CNewSerialId" title="@bean.CNewSerialId">
																															</td>
																															<td>
																																<input type='text' name='tbx_PRcInstallID' @("id=tbx_PRcInstallID" + count) class='form-control' style='width:150px;' value="@bean.CInstallId" title="@bean.CInstallId">
																															</td>
																															<td>
																																<button name="btn_ProductDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Product('trProductNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>																		
																															</td>																							
																														</tr>
															}
														}
																				}
																			</tbody>
																		</table>
																	</div>
									}
									else
									{
																	<!--審核、駁回階段-->
																	<div class="ibox-content" style="overflow: scroll">											
																		<table id="tablePR" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
																			<thead>
																				<tr>
																					<th>項次</th>	
																					<th>*序號</th>
																					<th>*機器型號</th>
																					<th>Product Number</th>
																					<th>料號</th>
																					<th>更換後序號</th>
																					<th>裝機資訊</th>
																					<th width="130">刪除</th>
																				</tr>
																			</thead>
																			<tbody>
																				@{
														if (ViewBag.cSRID != "")
														{
															int count = 0;
															foreach (var bean in ViewBag.Detailbean_Product)
															{
																count++;
																														<tr id='trProductNo@(count)'>																	
																															<td>
																																<label name='lbl_PRRowNumber' style='font-size:14pt'>@(count)</label>
																															</td>	
																															<td>
																																<input type='text' name='tbx_PRcSerialID' @("id=tbx_PRcSerialID" + count) class='form-control Serial' style='width:200px;' placeholder='序號' value="@bean.CSerialId" title="@bean.CSerialId">																		
																																<input type='hidden' name='hid_PRcDisabled' @("id=hid_PRcDisabled" + count) value=@bean.Disabled>
																															</td>															
																															<td>
																																<textarea rows="3" class="form-control" style='width:200px;' placeholder="機器型號" name="tbx_PRcMaterialName" @("id=tbx_PRcMaterialName" + count) title="@bean.CMaterialName">@bean.CMaterialName</textarea>
																															</td>
																															<td>
																																<input type='text' name='tbx_PRcProductNumber' @("id=tbx_PRcProductNumber" + count) class='form-control' style='width:150px;' value="@bean.CProductNumber" title="@bean.CProductNumber">
																															</td>
																															<td>
																																<a href="javascript:void(0);showBOMDialog('@bean.CMaterialId')">@bean.CMaterialId</a>
																																<input type='hidden' name='hid_PRcMaterialID' @("id=hid_PRcMaterialID" + count) value="@bean.CMaterialId">
																															</td>
																															<td>
																																<input type='text' name='tbx_PRcNewSerialID' @("id=tbx_PRcNewSerialID" + count) class='form-control' style='width:150px;' value="@bean.CNewSerialId" title="@bean.CNewSerialId">
																															</td>
																															<td>
																																<input type='text' name='tbx_PRcInstallID' @("id=tbx_PRcInstallID" + count) class='form-control' style='width:150px;' value="@bean.CInstallId" title="@bean.CInstallId">
																															</td>
																															<td>
																																<button name="btn_ProductDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Product('trProductNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>																		
																															</td>																							
																														</tr>
															}
														}
																				}
																			</tbody>
																		</table>
																	</div>
									}								
								}
							</div>
						</div>

						<!--保固SLA資訊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
								<h5>
									保固SLA資訊
									<button type="button" class="btn btn-success" onclick="QuerySRDetail_Warranty('tablePR');"><i class="fa fa-plus" style="margin-right: 5px;"></i>查詢保固SLA</button>
									<img id="img_waiting_Warranty" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">								
								</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>	
								<div class="ibox-content" id="dataDivWA" style="overflow: scroll">										
									<table id="tableADDWA" class="table table-striple table-bordered table-hover dataTables-example table table-striped table-hover" style="width:1280px !important">
										<thead>
											<tr>												
												<th>序號</th>
												<th>保固代號</th>
												<th>保固說明</th>
												<th>保固起始日</th>
												<th>保固到期日</th>
												<th>SLA回應條件</th>
												<th>SLA服務條件</th>
												<th>合約編號</th>
												<th>下包文件編號</th>
												<th>保固申請</th>
												<th>本次使用</th>
											</tr>
										</thead>
										<tbody>

										</tbody>
									</table>
								</div>							
							</div>
						</div>

						<!--服務團隊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										服務團隊										
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>
								<div class="ibox-content">
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">*服務團隊</label>
										<div class="col-lg-10 col-sm-10 input-group">
											<input type="hidden" id="hid_cTeamID" name="hid_cTeamID" value="@ViewBag.cTeamID">
											<input id="tbx_cTeamName" name="tbx_cTeamName" type="text" class="form-control labelDisabled" placeholder="服務團隊名稱" disabled>
											<div class="input-group-append">
												<button id="btn_pjTeam" class="btn btn-primary" type="button" @(ViewBag.cSRID == "" ? "" : "disabled")>
													<i class="fa fa-user-plus" aria-hidden="true"></i>
												</button>
											</div>
										</div>										
									</div>									
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">*主要工程師</label>
										<div class="col-lg-4">
											<input type="text" id="tbx_cMainEngineerName" name="tbx_cMainEngineerName" class="form-control PeoploeTeam" placeholder="請輸入人名或英文關鍵字搜尋" value="@ViewBag.cMainEngineerName">
											<input type="hidden" id="hid_cMainEngineerID" name="hid_cMainEngineerID" value="@ViewBag.cMainEngineerID" />
										</div>										
									</div>
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">協助工程師</label>
										<div class="col-lg-10 col-sm-10 input-group">
											<input type="hidden" id="hid_cAssEngineerID" name="hid_cAssEngineerID" value="@ViewBag.cAssEngineerID">
											<input id="tbx_cAssEngineerName" name="tbx_cAssEngineerName" type="text" class="form-control labelDisabled" placeholder="協助工程師姓名" disabled>
											<div class="input-group-append">
												<button id="btn_pjAssEngineer" class="btn btn-primary" type="button">
													<i class="fa fa-user-plus" aria-hidden="true"></i>
												</button>
											</div>
										</div>										
									</div>
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">技術主管</label>
										<div class="col-lg-10 col-sm-10 input-group">
											<input type="hidden" id="hid_cTechManagerID" name="hid_cTechManagerID" value="@ViewBag.cTechManagerID">
											<input id="tbx_cTechManagerName" name="tbx_cTechManagerName" type="text" class="form-control labelDisabled" placeholder="技術主管姓名" disabled>
											<div class="input-group-append">
												<button id="btn_pjTechManager" class="btn btn-primary" type="button">
													<i class="fa fa-user-plus" aria-hidden="true"></i>
												</button>
											</div>
										</div>										
									</div>
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">SQ人員</label>
										<div class="col-lg-4">
											<input type="text" id="tbx_cSQPersonName" name="tbx_cSQPersonName" class="form-control SQPerson" placeholder="請輸入人名或類別關鍵字搜尋" value="@ViewBag.cSQPersonName">
											<input type="hidden" id="hid_cSQPersonID" name="hid_cSQPersonID" value="@ViewBag.cSQPersonID" />
										</div>
										<label class="col-lg-2 col-form-label">計費業務</label>
										<div class="col-lg-4">
											<input type="text" id="tbx_cSalesName" name="tbx_cSalesName" class="form-control Peoploe" placeholder="請輸入人名或英文關鍵字搜尋" value="@ViewBag.cSalesName">
											<input type="hidden" id="hid_cSalesID" name="hid_cSalesID" value="@ViewBag.cSalesID" />
										</div>
									</div>
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">SLA回應條件(單筆per call)</label>
										<div class="col-lg-4">
											@Html.DropDownList("ddl_cPerCallSLARESP", (IEnumerable<SelectListItem>)ViewBag.SLARESPList, new { @class = "form-control" })	
										</div>
										<label class="col-lg-2 col-form-label">SLA服務條件(單筆per call)</label>
										<div class="col-lg-4">
											@Html.DropDownList("ddl_cPerCallSLASRV", (IEnumerable<SelectListItem>)ViewBag.SLASRVList, new { @class = "form-control" })
										</div>
									</div>
								</div>
							</div>
						</div>

						<!--處理與工時紀錄-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										處理與工時紀錄
										@if (ViewBag.pStatus != "E0001" && ViewBag.pStatus != "E0014") //非新建或駁回
										{
											<button id="btn_add_pRecord" class="btn btn-success" type="button" style="margin-left: 10px;" onclick="AddDetailItem_Record('tableRecord');"><i class="fa fa-plus" style="margin-right: 5px;"></i>新增</button>
										}
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>	
								@{
									if (ViewBag.pStatus == "E0001")
									{
																							<!--新建階段-->
																							<div class="ibox-content" style="overflow: scroll">
																								<table id="tableRecord" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
																									<thead>
																										<tr>														
																											<th>項次</th>
																											<th>*服務工程師/技術主管</th>
																											<th>*接單時間</th>
																											<th>*出發時間</th>
																											<th>*到場時間</th>
																											<th>*完成時間</th>
																											<th>*工時(分鐘)</th>
																											<th>*處理紀錄</th>
																											<th>*服務報告書</th>
																											<th width="130">刪除</th>
																										</tr>
																									</thead>
																									<tbody>
																																																																																													
																									</tbody>
																								</table>
																							</div>							
									}
									else
									{
																							<!--審核、駁回階段-->
																							<div class="ibox-content" style="overflow: scroll">											
																								<table id="tableRecord" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
																									<thead>
																										<tr>														
																											<th>項次</th>
																											<th>*服務工程師/技術主管</th>
																											<th>*接單時間</th>
																											<th>*出發時間</th>
																											<th>*到場時間</th>
																											<th>*完成時間</th>
																											<th>*工時(分鐘)</th>
																											<th>*處理紀錄</th>
																											<th>*服務報告書</th>
																											<th width="130">刪除</th>
																										</tr>
																									</thead>
																									<tbody>
																									@{
													if (ViewBag.cSRID != "")
													{
														string TechManagerID = ViewBag.cTechManagerID;
														string LoginUser_ERPID = ViewBag.cLoginUser_ERPID;

														int count = 0;
															foreach (var bean in ViewBag.Detailbean_Record)
															{
																count++;
																																										@if ((LoginUser_ERPID == bean.CEngineerId) && (TechManagerID.Contains(LoginUser_ERPID))) //判斷登入人員是否為技術主管
	{
																																											<tr id='trRecordNo@(count)' class='table-success'>	
																																											<td>
																																												<label name='lbl_RERowNumber' style='font-size:14pt'>@(count)</label>
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_REcEngineerName' @("id=tbx_REcEngineerName" + count) class='form-control' style='width:200px;' placeholder='服務工程師/技術主管' value="@bean.CEngineerName" title="@bean.CEngineerName">
																																												<input type='hidden' name='hid_REcEngineerID' @("id=hid_REcEngineerID" + count) value=@bean.CEngineerId>
																																												<input type='hidden' name='hid_REcDisabled' @("id=hid_REcDisabled" + count) value=@bean.Disabled>
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_REcReceiveTime' @("id=tbx_REcReceiveTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='接單時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CReceiveTime))" title="@(TransDateFormat_min(bean.CReceiveTime))">
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_REcStartTime' @("id=tbx_REcStartTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='出發時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CStartTime))" title="@(TransDateFormat_min(bean.CStartTime))">
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_REcArriveTime' @("id=tbx_REcArriveTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='到場時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CArriveTime))" title="@(TransDateFormat_min(bean.CArriveTime))">
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_REcFinishTime' @("id=tbx_REcFinishTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='完成時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CFinishTime))" title="@(TransDateFormat_min(bean.CFinishTime))">
																																											</td>																	
																																											<td>
																																												<input type='text' name='tbx_REcWorkHours' @("id=tbx_REcWorkHours" + count) class='form-control' style='width:100px;' placeholder='組工時(分鐘)' value="@bean.CWorkHours" title="@bean.CWorkHours" readonly>
																																											</td>																	
																																											<td>
																																												<textarea rows="3" class="form-control" style='width:200px;' placeholder="處理紀錄" name="tbx_REcDesc" title="@bean.CDesc">@bean.CDesc</textarea>
																																											</td>
																																											<td>
																																												<div class="dropzone" @("id=zoneRE_" + count) style="width: 200px; min-height: 100px !important; padding: 0px;">
																																													<div class="fallback file-box" >
																																														<input name="file" type="file" multiple />
																																													</div>
																																												</div>
																																												<div class="attachment" @("id=filezoneRE_" + count) ></div>
																																												<input type="hidden" class="fileids" name="hid_filezoneRE" @("id=hid_filezoneRE_" + count) value="@bean.CSrreport" />
																																											</td>
																																											<td>
																																											<button name="btn_RecordDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Record('trRecordNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>
																																											</td>																							
																																										</tr>
																}
																else
																{
																																												<tr id='trRecordNo@(count)'>	
																																												<td>
																																													<label name='lbl_RERowNumber' style='font-size:14pt'>@(count)</label>
																																												</td>
																																												<td>
																																													<input type='text' name='tbx_REcEngineerName' @("id=tbx_REcEngineerName" + count) class='form-control' style='width:200px;' placeholder='服務工程師/技術主管' value="@bean.CEngineerName" title="@bean.CEngineerName">
																																													<input type='hidden' name='hid_REcEngineerID' @("id=hid_REcEngineerID" + count) value=@bean.CEngineerId>
																																													<input type='hidden' name='hid_REcDisabled' @("id=hid_REcDisabled" + count) value=@bean.Disabled>
																																												</td>
																																												<td>
																																													<input type='text' name='tbx_REcReceiveTime' @("id=tbx_REcReceiveTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='接單時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CReceiveTime))" title="@(TransDateFormat_min(bean.CReceiveTime))">
																																												</td>
																																												<td>
																																													<input type='text' name='tbx_REcStartTime' @("id=tbx_REcStartTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='出發時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CStartTime))" title="@(TransDateFormat_min(bean.CStartTime))">
																																												</td>
																																												<td>
																																													<input type='text' name='tbx_REcArriveTime' @("id=tbx_REcArriveTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='到場時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CArriveTime))" title="@(TransDateFormat_min(bean.CArriveTime))">
																																												</td>
																																												<td>
																																													<input type='text' name='tbx_REcFinishTime' @("id=tbx_REcFinishTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='完成時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CFinishTime))" title="@(TransDateFormat_min(bean.CFinishTime))">
																																												</td>																	
																																												<td>
																																													<input type='text' name='tbx_REcWorkHours' @("id=tbx_REcWorkHours" + count) class='form-control' style='width:100px;' placeholder='組工時(分鐘)' value="@bean.CWorkHours" title="@bean.CWorkHours" readonly>
																																												</td>																	
																																												<td>
																																													<textarea rows="3" class="form-control" style='width:200px;' placeholder="處理紀錄" name="tbx_REcDesc" title="@bean.CDesc">@bean.CDesc</textarea>
																																												</td>
																																												<td>
																																													<div class="dropzone" @("id=zoneRE_" + count) style="width: 200px; min-height: 100px !important; padding: 0px;">
																																														<div class="fallback file-box" >
																																															<input name="file" type="file" multiple />
																																														</div>
																																													</div>
																																													<div class="attachment" @("id=filezoneRE_" + count) ></div>
																																													<input type="hidden" class="fileids" name="hid_filezoneRE" @("id=hid_filezoneRE_" + count) value="@bean.CSrreport" />
																																												</td>
																																												<td>
																																												<button name="btn_RecordDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Record('trRecordNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>
																																												</td>																							
																																											</tr>
																}																
															}
														}
																										}
																									</tbody>
																								</table>
																							</div>
									}
								}								
							</div>
						</div>

						<!--零件更換資訊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										零件更換資訊
										@if (ViewBag.pStatus != "E0001" && ViewBag.pStatus != "E0014") //非新建或駁回
										{
										<button type="button" class="btn btn-success" onclick="AddDetailItem_Parts('tablePA');"><i class="fa fa-plus" style="margin-right: 5px;"></i>新增</button>
										}
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>	
								@{									
									if (ViewBag.pStatus == "E0001")
									{
																							<!--新建階段-->
																							<div class="ibox-content" style="overflow: scroll">
																								<table id="tablePA" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
																									<thead>
																										<tr>
																											<th>項次</th>
																											<th>XC HP申請零件</th>
																											<th>*更換零件料號ID</th>
																											<th>*料號說明</th>
																											<th>Old CT</th>
																											<th>New CT</th>
																											<th>HP CT </th>
																											<th>New UEFI</th>
																											<th>備機序號</th>
																											<th>HP Case ID</th>
																											<th>到貨日</th>
																											<th>歸還日</th>
																											<th>是否有人損</th>
																											<th>備註</th>
																											<th width="130">刪除</th>
																										</tr>
																									</thead>
																									<tbody>

																									</tbody>
																								</table>
																							</div>
									}
									else
									{
																							<!--審核、駁回階段-->
																							<div class="ibox-content" style="overflow: scroll">											
																								<table id="tablePA" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
																									<thead>
																										<tr>
																											<th>項次</th>
																											<th>XC HP申請零件</th>
																											<th>*更換零件料號ID</th>
																											<th>*料號說明</th>
																											<th>Old CT</th>
																											<th>New CT</th>
																											<th>HP CT </th>
																											<th>New UEFI</th>
																											<th>備機序號</th>
																											<th>HP Case ID</th>
																											<th>到貨日</th>
																											<th>歸還日</th>
																											<th>是否有人損</th>
																											<th>備註</th>
																											<th width="130">刪除</th>
																										</tr>
																									</thead>
																									<tbody>
																										@{
														if (ViewBag.cSRID != "")
														{
															int count = 0;
															foreach (var bean in ViewBag.Detailbean_Parts)
															{
																count++;
																																										<tr id='trPartsNo@(count)'>
																																											<td>
																																												<label name='lbl_PARowNumber' style='font-size:14pt'>@(count)</label>
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_PAcXCHP' @("id=tbx_PAcXCHP" + count) class='form-control' style='width:150px;' placeholder='XC HP申請零件' value="@bean.CXchp" title="@bean.CXchp">
																																												<input type='hidden' name='hid_PAcDisabled' @("id=hid_PAcDisabled" + count) value=@bean.Disabled>																		
																																											</td>																	
																																											<td>
																																												<input type='text' name='tbx_PAcMaterialID' @("id=tbx_PAcMaterialID" + count) class='form-control materialSpare' style='width:150px;' placeholder='更換零件料號ID' value="@bean.CMaterialId" title="@bean.CMaterialId">
																																											</td>																	
																																											<td>
																																												<textarea rows="3" class="form-control" style='width:200px;' placeholder="料號說明" name="tbx_PAcMaterialName" @("id=tbx_PAcMaterialName" + count) title="@bean.CMaterialName">@bean.CMaterialName</textarea>
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_PAcOldCT' @("id=tbx_PAcOldCT" + count) class='form-control' style='width:100px;' placeholder='Old CT' value="@bean.COldCt" title="@bean.COldCt">
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_PAcNewCT' @("id=tbx_PAcNewCT" + count) class='form-control' style='width:100px;' placeholder='New CT' value="@bean.CNewCt" title="@bean.CNewCt">
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_PAcHPCT' @("id=tbx_PAcHPCT" + count) class='form-control' style='width:100px;' placeholder='HP CT' value="@bean.CHpct" title="@bean.CHpct">
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_PAcNewUEFI' @("id=tbx_PAcNewUEFI" + count) class='form-control' style='width:100px;' placeholder='New UEFI' value="@bean.CNewUefi" title="@bean.CNewUefi">
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_PAcStandbySerialID' @("id=tbx_PAcStandbySerialID" + count) class='form-control' style='width:100px;' placeholder='備機序號' value="@bean.CStandbySerialId" title="@bean.CStandbySerialId">
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_PAcHPCaseID' @("id=tbx_PAcHPCaseID" + count) class='form-control' style='width:100px;' placeholder='HP Case ID' value="@bean.CHpcaseId" title="@bean.CHpcaseId">
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_PAcArriveDate' @("id=tbx_PAcArriveDate" + count) class='form-control calendar' style='width:100px;' placeholder='到貨日' value="@(TransDateFormat(bean.CArriveDate))" title="@(TransDateFormat(bean.CArriveDate))">
																																											</td>
																																											<td>
																																												<input type='text' name='tbx_PAcReturnDate' @("id=tbx_PAcReturnDate" + count) class='form-control calendar' style='width:100px;' placeholder='歸還日' value="@(TransDateFormat(bean.CReturnDate))" title="@(TransDateFormat(bean.CReturnDate))">
																																											</td>
																																											<td>
																																												<select asp-for="ddl_PAcPersonalDamage" asp-items="@(new SelectList(Model.ListPersonalDamage, "Value", "Text", @bean.CPersonalDamage))" class="form-control" style="width:80px;"></select>
																																											</td>																	
																																											<td>
																																												<textarea rows="3" class="form-control" style='width:200px;' placeholder="備註" name="tbx_PAcNote" title="@bean.CNote">@bean.CNote</textarea>
																																											</td>
																																											<td>
																																												<button name="btn_PartsDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Parts('trPartsNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>
																																											</td>																							
																																										</tr>
															}
														}
																										}
																									</tbody>
																								</table>
																							</div>
									}
								}								
							</div>
						</div>
						<div class="form-group row">
							<button id="btn_submit" class="btn btn-primary btn-lg" type="button" onclick="ShowSRConfirmDialogMsg('確認', '您是否確認提交？');">
								<i class="fa fa-arrow-circle-up" style="font-size:large"> 提 交</i>
							</button>
							<img id="waitingImg" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:0px 10px" alt="">
						</div>
					</form>
				</div>
			</div>
		</div>
		
	</div>

	<!--新增客戶聯絡人彈出視窗-->
	<div class="modal fade" id="dialog_pAddContactInfo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label"><i class="fa fa-calendar-plus-o" aria-hidden="true"></i>新增客戶【報修/聯絡】窗口資訊</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">														
					<div class="form-group row">
					<label class="col-lg-2 col-form-label">查詢縣市鄉鎮路段和地址</label>
                        <div class="input-group col-lg-10">
                            <div class="col-lg-6 col-xs-12">
								<label class="col-form-label">縣市名稱：</label>
								<select id="ddl_PostAddressCity" class="changePostCity form-control"></select>
							</div>
							<div class="col-lg-6 col-xs-12">
								<label class="col-form-label">鄉鎮市區：</label>
								<select id="ddl_PostAddressTownship" class="changePostTownship form-control"></select>
							</div>
							<div class="col-lg-12 col-xs-12">
								<label class="col-form-label">路段(名)：</label>
								<input type="text" id="tbx_PostAddressRoad" name="tbx_PostAddressRoad" class="changePostRoad form-control" placeholder="請先選擇【縣市名稱】和【鄉鎮市區】，再輸入路段(名)關鍵字">
							</div>							
                        </div>                       
                    </div>
					<div class="hr-line-dashed"></div>									
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">姓名*</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cAddContactName" name="tbx_cAddContactName" class="form-control" placeholder="姓名">
						</div>
						<label class="col-lg-2 col-form-label">電話</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cAddContactPhone" name="tbx_cAddContactPhone" class="form-control" placeholder="電話">
						</div>
					</div>	
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">城市*</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cAddContactCity" name="tbx_cAddContactCity" class="form-control" placeholder="城市" disabled>
						</div>	
						<label class="col-lg-2 col-form-label">手機</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cAddContactMobile" name="tbx_cAddContactMobile" class="form-control" placeholder="手機">
						</div>
					</div>
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">詳細地址*</label>
						<div class="col-lg-10">							
							<input type="text" id="tbx_cAddContactAddress" name="tbx_cAddContactAddress" class="form-control" placeholder="詳細地址" disabled>							
							<input type="text" id="tbx_cAddContactAddress_No" name="tbx_cAddContactAddress_No" class="form-control" placeholder="門牌號碼/樓層">
						</div>
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">Email</label>
						<div class="col-lg-10">
							<input type="text" id="tbx_cAddContactEmail" name="tbx_cAddContactEmail" class="form-control" placeholder="Email" onblur="CheckEmailValid();">
						</div>
					</div>					
				</div>
				<div class="modal-footer">
					<div class="col-lg-5"></div>
					<button id="btn_saveContactInfo" class="btn btn-primary col-lg-2 col-xs-12" type="button" onclick="saveContactInfo();">
						<i class="fa fa-save"></i> 儲 存
					</button>
					<img id="img_waiting_saveContactInfo" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
					<div class="col-lg-5"></div>
				</div>
			</div>
		</div>
	</div>

	<!--編輯/刪除客戶【報修/聯絡】窗口彈出視窗-->
	<div class="modal fade" id="dialog_pjEditContactInfo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
				<label class="col-form-label"><i class="fa fa-users"></i> 編輯/刪除客戶【報修/聯絡】窗口設定</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">					
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">聯絡人姓名</label>
						<div class="input-group col-sm-10 col-lg-6" style="height: 36px;">							
							<input type="text" id="tbx_editContactName" class="form-control Contact" placeholder="請輸入姓名關鍵字">
							<button id="btn_pjEditContact" class="btn btn-info" type="button" onclick="getpjEditContact();">查詢</button>
						</div>						
					</div>
					<div class="hr-line-dashed"></div>
					<div class="form-group row">						
						<input type="hidden" id="hid_cEditContactID" />
						<label class="col-lg-2 col-form-label">姓名*</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cEditContactName" name="tbx_cEditContactName" class="form-control" placeholder="姓名" disabled>
						</div>
						<label class="col-lg-2 col-form-label">電話</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cEditContactPhone" name="tbx_cEditContactPhone" class="form-control" placeholder="電話">
						</div>
					</div>	
					<div class="form-group row">							
						<label class="col-lg-2 col-form-label">城市*</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cEditContactCity" name="tbx_cEditContactCity" class="form-control" placeholder="城市">
						</div>					
						<label class="col-lg-2 col-form-label">手機</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cEditContactMobile" name="tbx_cEditContactMobile" class="form-control" placeholder="手機">
						</div>
					</div>
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">詳細地址*</label>
						<div class="col-lg-10">							
							<input type="text" id="tbx_cEditContactAddress" name="tbx_cEditContactAddress" class="form-control" placeholder="詳細地址">							
						</div>
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">Email</label>
						<div class="col-lg-10">
							<input type="text" id="tbx_cEditContactEmail" name="tbx_cEditContactEmail" class="form-control" placeholder="Email" onblur="CheckEditEmailValid();">
						</div>
					</div>					
					<div class="form-group row">
						<div class="col-lg-2">
							<button id="btn_savepjEditContact" class="btn btn-primary col-lg-12 col-xs-12" style="display:none;" type="button" onclick="savepjEditContact();">
								<i class="fa fa-save" style="margin-right: 4px;"></i> 儲 存
							</button>
							<img id="img_waiting_savepjEditContact" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
						</div>
					</div>
				</div>
				<hr style="border: 1px solid lightgray; width: 98%;" />
				<div class="modal-body" id="tb_pjeditContact" style="overflow: scroll;">

				</div>
			</div>
		</div>
	</div>

	<!--選擇客戶聯絡人彈出視窗-->
	<div class="modal fade" id="dialog_pContactInfo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document" style="max-width:50%">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label">客戶【報修/聯絡】窗口資訊</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" id="tb_pContactInfo">
				</div>
			</div>
		</div>
	</div>

	<!--ShowSRConfirmDialog-->
	<div class="modal fade" id="ShowSRConfirmDialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="ShowSRConfirmdialogTitle">確認</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" id="ShowSRConfirmdialogContent">
				</div>
				<div class="modal-footer">
					<button id="BtnCancel" type="button" class="btn btn-lg btn-dark" data-dismiss="modal">取消</button>
					<button id="BtnSave" type="button" class="btn btn-lg btn-primary" data-dismiss="modal" onclick="onclickBtnSave();">確認</button>
				</div>
			</div>
		</div>
	</div>

	<!--協助工程師彈出視窗-->
	<div class="modal fade" id="dialog_pjAssEngineer" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label"><i class="fa fa-users"></i> 協助工程師設定</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">協助工程師姓名</label>
						<div class="input-group col-sm-10 col-lg-6" style="height: 36px;">
							<input type="hidden" id="hid_pjAssEngineerAcc" />
							<input type="text" id="tbx_pjAssEngineerName" class="form-control Peoploe" placeholder="請輸入人名或英文關鍵字搜尋">
						</div>
						<div class="col-lg-2">
							<button id="btn_savepjAssEngineer" class="btn btn-primary col-lg-12 col-xs-12" type="button" onclick="savepjAssEngineer();">
								<i class="fa fa-save" style="margin-right: 4px;"></i> 儲 存
							</button>
							<img id="img_waiting_savepjAssEngineer" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
						</div>
					</div>
				</div>
				<hr style="border: 1px solid lightgray; width: 98%;" />
				<div class="modal-body" id="tb_pjAssEngineer" style="overflow: scroll;">

				</div>
			</div>
		</div>
	</div>

	<!--技術主管彈出視窗-->
	<div class="modal fade" id="dialog_pjTechManager" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label"><i class="fa fa-users"></i> 技術主管設定</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">技術主管姓名</label>
						<div class="input-group col-sm-10 col-lg-6" style="height: 36px;">
							<input type="hidden" id="hid_pjTechManagerAcc" />
							<input type="text" id="tbx_pjTechManagerName" class="form-control Peoploe" placeholder="請輸入人名或英文關鍵字搜尋">
						</div>
						<div class="col-lg-2">
							<button id="btn_savepjTechManager" class="btn btn-primary col-lg-12 col-xs-12" type="button" onclick="savepjTechManager();">
								<i class="fa fa-save" style="margin-right: 4px;"></i> 儲 存
							</button>
							<img id="img_waiting_savepjTechManager" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
						</div>
					</div>
				</div>
				<hr style="border: 1px solid lightgray; width: 98%;" />
				<div class="modal-body" id="tb_pjTechManager" style="overflow: scroll;">

				</div>
			</div>
		</div>
	</div>

	<!--服務團隊彈出視窗-->
	<div class="modal fade" id="dialog_pjTeam" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label"><i class="fa fa-users"></i> 服務團隊設定</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">服務團隊名稱</label>
						<div class="input-group col-sm-10 col-lg-6" style="height: 36px;">							
							@Html.DropDownList("ddl_cTeamID", (IEnumerable<SelectListItem>)ViewBag.SRTeamIDList, new { @class = "form-control" })
						</div>
						<div class="col-lg-2">
							<button id="btn_savepjTeam" class="btn btn-primary col-lg-12 col-xs-12" type="button" onclick="savepjTeam();">
								<i class="fa fa-save" style="margin-right: 4px;"></i> 儲 存
							</button>
							<img id="img_waiting_savepjTeam" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
						</div>
					</div>
				</div>
				<hr style="border: 1px solid lightgray; width: 98%;" />
				<div class="modal-body" id="tb_pjTeam" style="overflow: scroll;">

				</div>
			</div>
		</div>
	</div>

	<!--執行處理與工時紀錄彈出視窗-->
	<div class="modal fade" id="dialog_pRecord" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
				<label class="col-form-label"><i class="fa fa-calendar-plus-o" aria-hidden="true"></i> 執行處理與工時紀錄</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<!--執行工時紀錄Id-->
					<input type="hidden" id="hid_pRecordCId" runat="server" />					
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">服務工程師/技術主管*</label>
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordEngineerName" type="text" class="form-control Peoploe" placeholder="請輸入人名或英文關鍵字搜尋" style="padding-left: 15px;">
							<input type="hidden" id="hid_pjRecordEngineerID" runat="server" />
						</div>						
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">接單時間*</label>
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordReceiveTime" type="text" class="form-control datetimepicker" placeholder="請選擇接單時間" style="padding-left: 15px;">	
							
						</div>
						<label class="col-lg-2 col-form-label">出發時間*</label>
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordStartTime" type="text" class="form-control datetimepicker" placeholder="請選擇出發時間" style="padding-left: 15px;">							
						</div>
					</div>					
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">到場時間*</label>
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordArriveTime" type="text" class="form-control datetimepicker" placeholder="請選擇到場時間" style="padding-left: 15px;">	
							
						</div>
						<label class="col-lg-2 col-form-label">完成時間*</label>
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordFinishTime" type="text" class="form-control datetimepicker" placeholder="請選擇完成時間" style="padding-left: 15px;">							
						</div>
					</div>					
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">工時(分鐘)*</label>						
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordWorkHours" type="text" class="form-control" placeholder="工時(分鐘)" disabled/>
						</div>	
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">處理紀錄*</label>
						<textarea id="tbx_pjRecordDesc" rows="3" class="col-lg-10 form-control" placeholder="請輸入處理紀錄" onkeyup="showRemainWords(this, 255, '#remainPrDesc');" onfocusout="hideRemainWords('#remainPrDesc');"></textarea>
						<div class="col-lg-2"></div>
						<span id='remainPrDesc' style="font-size: 10px; color: red;"></span>
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">服務報告書*</label>
						<div class="dropzone popupDropzone" id="zone_pr" style="width: 200px; min-height: 100px !important; padding: 0px;">
							<div class="fallback file-box">
								<input name="file" type="file" multiple />
							</div>
						</div>
						<div class="attachment" id="filezone_pjRecord"></div>
						<input type="hidden" class="fileids" name="hid_filezone" id="hid_filezone_pjRecord" value="" />
					</div>
				</div>
				<div class="modal-footer">
					<div class="col-lg-5"></div>
					<button id="btn_savepjRecord" class="btn btn-primary col-lg-2 col-xs-12" type="button" onclick="savepjRecord($('#hid_pRecordCId').val());"> <i class="fa fa-save"></i> 儲 存</button>
					<img id="img_waiting_savePR" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
					<div class="col-lg-5"></div>
				</div>
			</div>
		</div>
	</div>

	<!--執行處理與工時紀錄的服務報告書彈出視窗-->
	<div class="modal fade" id="dialog_pRecordReport" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label">執行處理與工時紀錄的服務報告書</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" id="tb_pRecordReport">

				</div>
			</div>
		</div>
	</div>

	<!--ShowBOMDialog-->
    <div class="modal fade" id="ShowBOMDialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ShowBOMdialogTitle">BOM表</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="ShowBOMdialogContent">

                </div>
                <div class="modal-footer">
                    <button id="BtnClose" type="button" class="btn btn-lg btn-dark" data-dismiss="modal">關閉</button>
                </div>
            </div>
        </div>
    </div>