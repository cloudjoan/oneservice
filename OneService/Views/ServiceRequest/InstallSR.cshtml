@{
	ViewData["Title"] = "InstallSR";
	Layout = "~/Views/Shared/_LayoutHome.cshtml";
}

<!--要透過Server Code處理寫在裡面-->
@functions{	
	public string TransDateFormat(object tDate)
	{
		string reValue = string.Empty;
		string TempDate = string.Empty;

        if (tDate != null)
        {
			TempDate = Convert.ToString(tDate);
            reValue = Convert.ToDateTime(TempDate).ToString("yyyy-MM-dd");
        }

        return reValue;
    }

	public string TransDateFormat_min(object tDate)
	{
		string reValue = string.Empty;
		string TempDate = string.Empty;

        if (tDate != null)
        {
			TempDate = Convert.ToString(tDate);
            reValue = Convert.ToDateTime(TempDate).ToString("yyyy-MM-dd HH:mm");
        }

        return reValue;
    }
}

<!--Java Script寫在js_section裡面-->
@section js_section{
	<script>
		var trContactNoCount = 0;				//記錄目前明細列(客戶聯絡資訊檔)的ID數
		var trMaterialNoCount = 0;				//記錄目前明細列(物料訊息檔)的ID數		
		var trSerialNoCount = 0;				//記錄目前明細列(序號回報檔)的ID數
		var trRecordNoCount = 0;				//記錄目前明細列(處理與工時紀錄)的ID數		
		var AryPNowPrSERIAL = new Array();		//記錄目前產品的序號
		var AryPNowWASERIAL = new Array();		//記錄目前保固的序號

		$(document).ready(function () {
			initPage();					//初始頁面		
			initRow();					//初始明細列
			openPostAddress();			//開啟郵遞區號和地址查詢視窗
			RoadSearch();				//Ajax路段(名)關鍵字查詢
			CustSearch();				//取得客戶資料	
			SerialSearch();				//產品序號資訊查詢
			findMaterialByKeyword();	//用關鍵字查詢物料
			PeopleSearch();				//Ajax用中文或英文姓名查詢人員帳號		
			PeopleTeamSearch();			//Ajax用中文或英文姓名查詢人員帳號(by服務團隊)
			getpjTeam();				//取得服務團隊
			getpjAssEngineer();			//取得協助工程師
		});		

		//初始頁面
		function initPage()
		{
			 $('.datetimepicker').datetimepicker({
				minView: "hour", //只顯示到每日的小時(含每小時5分鐘顯示)
                format: "yyyy-mm-dd hh:ii",
                autoclose: true, //當選擇一個日期之後是否立即關閉此日期時間選擇器。
                todayBtn: "linked", //如果此值為true或"linked"，則在日期時間選擇器組件的底部顯示一個today按鈕用以選擇當前日期。如果是true，today按鈕僅僅將視圖轉到當天的日期，如果是linked，當天日期將會被選中。
                todayHighlight: true, //如果為true，閃亮當前日期。
            });			

			//顯示編輯/刪除聯絡人設定popup
            $('#btn_editContactInfo').click(function () {
				var CustomerID = $('#hid_cCustomerID').val();
				if (CustomerID == "")
				{
					alert("您尚未輸入【客戶】！");
				}
				else
				{
					$('#dialog_pjEditContactInfo').modal('show');				
					$("#tbx_editContactName").val("");
					$("#tb_pjeditContact").html("");
					$("#btn_savepjEditContact").hide();
					cleanpjeditContact();
				}
            })		
			
			//查詢更改歷史記錄popup
            $('#btn_ShowHistoryLog').click(function () {                
				getHistoryLog();			//顯示更改歷史記錄
				$('#dialog_ShowHistoryLog').modal('show');				
            })

			//顯示協助工程師設定popup
            $('#btn_pjAssEngineer').click(function () {
                $('#dialog_pjAssEngineer').modal('show');
            })			

			//顯示服務團隊設定popup
            $('#btn_pjTeam').click(function () {
                $('#dialog_pjTeam').modal('show');
            })

			var pIsCanEditSR = $("#hid_pIsCanEditSR").val();
			var cSRID = $("input[name='hid_cSRID']").val();
			var ddl_cStatus = $("#ddl_cStatus");

			if (cSRID == "") //若沒有SRID，則不准許調整【狀態】
			{					
				disabledPopup("#form1", false);
				ddl_cStatus.prop('disabled', true);

				$("#btn_submit").show();
				$("#btn_submitUP").show();
				$("#btn_Edit").hide();
				$("#btn_CopySRID").hide();
				$("#btn_ShowHistoryLog").hide();
			}
			else
			{
				disabledPopup("#form1", true);

				$("#btn_CopySRID").show();
				$("#btn_CopySRID").prop('disabled', false);
				$("#btn_ShowHistoryLog").show();
				$("#btn_ShowHistoryLog").prop('disabled', false);

				$("#btn_submit").hide();
				$("#btn_submitUP").hide();

				if (pIsCanEditSR == "True")
				{
					$("#btn_Edit").show();
					$("#btn_Edit").prop('disabled', false);
				}
				else
				{
					$("#btn_Edit").hide();
				}
			}
		}

		//初始明細列
		function initRow() {
			//只准許輸入數字
			$('.Quantity').keyup(function (event) {
				if (event.keyCode != 37 && event.keyCode != 39 && event.keyCode != 109 && event.keyCode != 189)
					$(this).val($(this).val().replace(/\D|^/g, ''));
				calculatorAll();
			})
		}

		//顯示剩餘字數
        function showRemainWords(obj, maxLength, remainWord) {
            $(remainWord).show();
            var len = obj.value.length;
            if (len > 0) {
                $(remainWord).html("剩餘字數: " + (maxLength - len));
            }
            if (len > maxLength) {
                $(remainWord).html("已超過字數上限: " + (len - maxLength));
            }
        }

        //隱藏剩餘字數
        function hideRemainWords(obj) {
            $(obj).html('');
            $(obj).hide();
        }

		//popup各欄位reset
		function resetPopup(popupId) {
			$(popupId).find("input").each(function (index, value) {
				$(this).val("");
			});
			$(popupId).find("select").each(function (index, value) {
				$(this).val("-1");
			});
			$(popupId).find("textarea").each(function (index, value) {
				$(this).val("");
			});
			$(popupId).find(".file-box").each(function (index, value) {
				$(this).remove();
			});
		}

		//popup各欄位disabled
		//popupId.傳入的obj、IsDisabled(true.不准許輸入 false.准許輸入)
		function disabledPopup(popupId, IsDisabled) {
			$(popupId).find("input").each(function (index, value) {				
				var reValue = checkInputSkipList($(this).attr("name"));				
				if (!reValue){
					$(this).prop('disabled', IsDisabled);
				}
			});

			$(popupId).find("select").each(function (index, value) {
				var reValue = checkSelectSkipList($(this).attr("name"));				
				if (!reValue){
					$(this).prop('disabled', IsDisabled);
				}
			});

			$(popupId).find("button").each(function (index, value) {
				var reValue = checkButtonSkipList($(this).attr("name"));				
				if (!reValue){
					$(this).prop('disabled', IsDisabled);
				}
			});

			$(popupId).find("textarea").each(function (index, value) {
				var reValue = checkTextareaSkipList($(this).attr("name"));				
				if (!reValue){
					$(this).prop('disabled', IsDisabled);
				}
			});

			setTimeout(function () {
                if (IsDisabled)
				{
					$(".dropzone").hide();
					$(".btn-del").hide();
				}
				else
				{
					$(".dropzone").show();
					$(".btn-del").show();
				}
            }, 500);			
		}

		//要略過的清單(Input)
		function checkInputSkipList(tID)
		{
			var ArrayList = ["tbx_cTeamName", "tbx_cAssEngineerName", "tbx_REcWorkHours"]; 
			return SkiptList(tID, ArrayList);
		}

		//要略過的清單(select)
		function checkSelectSkipList(tID)
		{
			var ArrayList = ["ddl_cCustomerType"];
			return SkiptList(tID, ArrayList);
		}

		//要略過的清單(button)
		function checkButtonSkipList(tID)
		{
			var ArrayList = ["btn_ShowHistoryLog", "btn_CopySRID", "btn_addContactInfo", "btn_editContactInfo", "btn_pjTeam", "btn_pjAssEngineer"];
			return SkiptList(tID, ArrayList);
		}

		//要略過的清單(textarea)
		function checkTextareaSkipList(tID)
		{
			var ArrayList = ["tbx_MIcMaterialName"]; 			
			return SkiptList(tID, ArrayList);
		}		

		//執行要略過的清單
		function SkiptList(tID, ArrayList)
		{	
			var tIsExits = false;

			ArrayList.every(function(v){
				if(v == tID) {
					tIsExits = true;
					return false;
				}
				else{ 
					return true;
				}
			});

			return tIsExits;
		}

		//更改歷史記錄動態載入時，要呼叫此方法，頁籤才可以收合
		function callCollapse()
		{
			// Collapse ibox function
			$('.collapse-linkZ').on('click', function (e) {
				e.preventDefault();
				var ibox = $(this).closest('div.ibox');
				var button = $(this).find('i');
				var content = ibox.children('.ibox-content');
				content.slideToggle(200);
				button.toggleClass('fa-chevron-up').toggleClass('fa-chevron-down');
				ibox.toggleClass('').toggleClass('border-bottom');
				setTimeout(function () {
					ibox.resize();
					ibox.find('[id^=map-]').resize();
				}, 50);
			});			
		}

		//呼叫日期轉換
		function TransDate(Obj)
		{
			if (Obj != null)
			{
				return getDateString(new Date(Obj));
			}

			return "";
		}

		//日期Format(補0)
		function pad(v){
			return (v<10)?'0'+v:v
		}		

		//日期Format
		function getDateString(d){		 
			try {
				  var year = d.getFullYear();
				  var month = pad(d.getMonth()+1);
				  var day = pad(d.getDate());
				  var hour = pad(d.getHours());
				  var min = pad(d.getMinutes());
				  var sec = pad(d.getSeconds());	
		  
				  return year + "-" + month + "-" + day + " " + hour + ":" + min + ":" + sec;
			}
			catch (e) {
				return "";
			}
		}

		//查詢更改歷史記錄
		function getHistoryLog()
		{
			var cSRID = $("input[name='hid_cSRID']").val();			//SRID
			var cCustomerID = $("#hid_cCustomerID").val();			//客戶ID
            
			$.ajax({
				url: '@Url.Action("GetHistoryLog", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {                    
					cSRID : cSRID,
					cCustomerID: cCustomerID
                },
                success: function (result) {
                    var ALLList = ""
					var listOneLog = "";
					var listContactChangLog = "";
					var listContact = "";
					var listMaterial = "";
					var listFeedBack = "";
					var listRecord = "";					
					
					//↓↓↓↓↓歷史記錄資訊(共用) ↓↓↓↓↓/
					$.each(result.srOneLog, function (i, bean) {
                        if (bean != null) {                    
							var tDate = TransDate(bean.createdDate);
							var strLog = bean.log.replace(/\n/g,"<br />");

                            listOneLog += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cSrid + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.eventName + "</td>"
                                + "<td style='vertical-align: left;'>" + strLog + "</td>"
                                + "<td style='vertical-align: left;'>" + tDate + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.createdUserName + "</td>"                                
                            + "</tr>";
						}
                    });

                    if (listOneLog != "") {
                        listOneLog = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>報修主檔資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>SRID</th>"
                            + "				<th>事件名稱</th>"
                            + "				<th>Log</th>"
                            + "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"                                
                            + "				</tr></thead><tbody>"
                            + listOneLog
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑歷史記錄資訊(共用) ↑↑↑↑↑/

					//↓↓↓↓↓聯絡人主檔異動資訊(共用) ↓↓↓↓↓/
					$.each(result.srContactChangLog, function (i, bean) {
                        if (bean != null) {                    
							var tDate = TransDate(bean.createdDate);
							var strLog = bean.log.replace(/\n/g,"<br />");

                            listContactChangLog += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cSrid + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.eventName + "</td>"
                                + "<td style='vertical-align: left;'>" + strLog + "</td>"
                                + "<td style='vertical-align: left;'>" + tDate + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.createdUserName + "</td>"                                
                            + "</tr>";
						}
                    });

                    if (listContactChangLog != "") {
                        listContactChangLog = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>聯絡人主檔異動資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content' style='display:none;'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>SRID</th>"
                            + "				<th>事件名稱</th>"
                            + "				<th>Log</th>"
                            + "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"                                
                            + "				</tr></thead><tbody>"
                            + listContactChangLog
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑聯絡人主檔異動資訊(共用) ↑↑↑↑↑/

					//↓↓↓↓↓客戶聯絡窗口資訊(共用) ↓↓↓↓↓/
					$.each(result.srDetailContact, function (i, bean) {
                        if (bean != null) {
							var tDate = TransDate(bean.modifiedDate);

                            listContact += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cContactName + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cContactAddress + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cContactPhone + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cContactMobile + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cContactEmail + "</td>"                                
								+ "<td style='vertical-align: left;'>" + tDate + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.modifiedUserName + "</td>"
                            + "</tr>";
						}
                    });

                    if (listContact != "") {
                        listContact = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>客戶聯絡窗口資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content' style='display:none;'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>聯絡人姓名</th>"
                            + "				<th>聯絡人地址</th>"
                            + "				<th>聯絡人電話</th>"
                            + "				<th>聯絡人手機</th>"
                            + "				<th>聯絡人E-Mail</th>"  
							+ "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"
                            + "				</tr></thead><tbody>"
                            + listContact
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑客戶聯絡人資訊(共用) ↑↑↑↑↑/

					//↓↓↓↓↓物料訊息資訊(裝機) ↓↓↓↓↓/
					$.each(result.srDetailMaterialInfo, function (i, bean) {
                        if (bean != null) {
							var tDate = TransDate(bean.modifiedDate);

                            listMaterial += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cMaterialId + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cMaterialName + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cQuantity + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cBasicContent + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cMfpnumber + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cBrand + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cProductHierarchy + "</td>"
								+ "<td style='vertical-align: left;'>" + tDate + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.modifiedUserName + "</td>"
                            + "</tr>";
						}
                    });

                    if (listMaterial != "") {
                        listMaterial = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>物料訊息資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content' style='display:none;'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>物料代號</th>"
                            + "				<th>料號說明</th>"
							+ "				<th>數量</th>"
                            + "				<th>基本內文</th>"
                            + "				<th>製造商零件號碼</th>"
							+ "				<th>廠牌</th>"
                            + "				<th>產品階層</th>"
							+ "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"
                            + "				</tr></thead><tbody>"
                            + listMaterial
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑物料訊息資訊(裝機) ↑↑↑↑↑/

					//↓↓↓↓↓序號回報資訊(裝機) ↓↓↓↓↓/
					$.each(result.srDetailSerialFeedback, function (i, bean) {
                        if (bean != null) {
							var tDate = TransDate(bean.modifiedDate);

                            listFeedBack += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cSerialId + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cMaterialId + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cMaterialName + "</td>"
                                + "<td style='vertical-align: left;'>" + bean.cConfigReport + "</td>"                                
								+ "<td style='vertical-align: left;'>" + tDate + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.modifiedUserName + "</td>"
                            + "</tr>";
						}
                    });

                    if (listFeedBack != "") {
                        listFeedBack = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>序號回報資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content' style='display:none;'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"     
							+ "				<th>序號</th>"
                            + "				<th>物料代號</th>"
                            + "				<th>料號說明</th>"							
                            + "				<th>裝機Config檔</th>"
							+ "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"
                            + "				</tr></thead><tbody>"
                            + listFeedBack
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑序號回報資訊(裝機) ↑↑↑↑↑/

					//↓↓↓↓↓處理與工時紀錄資訊(共用) ↓↓↓↓↓/
					$.each(result.srDetailRecord, function (i, bean) {
                        if (bean != null) {
							var tDateR = TransDate(bean.cReceiveTime);
							var tDateS = TransDate(bean.cStartTime);
							var tDateA = TransDate(bean.cArriveTime);
							var tDateF = TransDate(bean.cFinishTime);
							var tDate = TransDate(bean.modifiedDate);

                            listRecord += '<tr>'                                
                                + "<td style='vertical-align: left;'>" + bean.cEngineerName + "</td>"
                                + "<td style='vertical-align: left;'>" + tDateR + "</td>"
                                + "<td style='vertical-align: left;'>" + tDateS + "</td>"
                                + "<td style='vertical-align: left;'>" + tDateA + "</td>"
                                + "<td style='vertical-align: left;'>" + tDateF + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cWorkHours + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cDesc + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.cSrreport + "</td>"
								+ "<td style='vertical-align: left;'>" + tDate + "</td>"
								+ "<td style='vertical-align: left;'>" + bean.modifiedUserName + "</td>"
                            + "</tr>";
						}
                    });

                    if (listRecord != "") {
                        listRecord = "<div class='col-lg-12'>"
						    + "	<div class='ibox'>"
							+ "		<div class='ibox-title'>"
							+ "			<h5>處理與工時紀錄資訊</h5>"
							+ "          <div class='ibox-tools'><a class='collapse-linkZ'><i class='fa fa-chevron-up'></i></a></div>"
							+ "      </div>"
							+ "      <div class='ibox-content' style='display:none;'>"
						    + "			<table class='table table-striple table-bordered table-hover dataTables-example'>"
                            + "				<thead><tr>"                                
                            + "				<th>服務工程師</th>"
                            + "				<th>接單時間</th>"
                            + "				<th>出發時間</th>"
                            + "				<th>到場時間</th>"
                            + "				<th>完成時間</th>"  
							+ "				<th>工時(分鐘)</th>"  
							+ "				<th>處理紀錄</th>"  
							+ "				<th>服務報告書</th>"  
							+ "				<th>異動時間</th>"
                            + "				<th>異動人員</th>"
                            + "				</tr></thead><tbody>"
                            + listRecord
                            + "</tbody></table></div></div></div>";
					}
					//↑↑↑↑↑處理與工時紀錄資訊(共用) ↑↑↑↑↑/					

					ALLList += listOneLog + listContactChangLog + listContact + listMaterial + listFeedBack + listRecord;

                    $("#tb_ShowHistoryLog").html(ALLList);  
					callCollapse();
                }
			});
		}
		
		//確認提交事件
		function onclickBtnSave() {
			if (checkBeforeSend()) 
			{ 
				getSRID(); 
			}			
		}

		//產生SRID
		function getSRID() {
			var cTitle = "63";	//SRID開頭編號(裝機服務)
			var cSRID = $("input[name='hid_cSRID']").val();
			var cGUID = $("input[name='hid_cSystemGUID']").val();

			$.ajax({
				url: '@Url.Action("getSRID", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
				async: false,
				data: { cTitle: cTitle, cSRID: cSRID, cGUID: cGUID },
				success: function (result) {
					if (result != "") {
						if (result == "CHANGE") {
							alert("【資料已被其他人異動】，請關閉頁面後再重新登入此表單！！");
							$("#waitingImg").hide();
							$("#waitingImgUP").hide();
							event.returnValue = false;
						}
						else {
							$("input[name='hid_cSRID']").val(result);
							$("#form1").submit();
						}
					}
					else {
						alert("產生SRID失敗！");
						$("#waitingImg").hide();
						$("#waitingImgUP").hide();
						event.returnValue = false;
					}
				}
			})
		}

		//按下編輯事件
		function EditSRID()
		{
			$("#btn_Edit").hide();
			$("#btn_submit").show();			
			$("#btn_submitUP").show();			

			disabledPopup("#form1", false);

			//$("#tbx_cCustomerName").prop('disabled', true); //客戶名稱不得編輯
		}

		 //送出前檢查
		function checkBeforeSend() {

			$("#btn_submit").hide();
			$("#btn_submitUP").hide();
			$("#waitingImg").show();
			$("#waitingImgUP").show();

			var Msg = "";
			var cSRID = $("input[name='hid_cSRID']").val();			//SRID
			var cNowStatus = $("#hid_cNowStatus").val();			//目前狀態
			var ddl_cStatus = $("#ddl_cStatus");					//下拉後的狀態
			var tbx_cCustomerName = $("#tbx_cCustomerName");			//客戶名稱	
			var hid_cCustomerID = $("#hid_cCustomerID");			//客戶ID							
			var tbx_cDesc = $("#tbx_cDesc");						//說明
			var tbx_cNotes = $("#tbx_cNotes");						//詳細描述						
			var tbx_cSalesNo = $("#tbx_cSalesNo");					//銷售訂單號
			var tbx_cShipmentNo = $("#tbx_cShipmentNo");			//出貨單號	
			var tbx_cDelayReason =  $("#tbx_cDelayReason");			//延遲結案原因
			var hid_cNowScheduleDate = $("#hid_cNowScheduleDate");	//目前預排日期值
			var tbx_cScheduleDate = $("#tbx_cScheduleDate");			//預排日期
			//var ddl_cSRTypeOne = $("#ddl_cSRTypeOne");				//報修類別(大類)
			//var ddl_cSRTypeSec = $("#ddl_cSRTypeSec");				//報修類別(中類)
			//var ddl_cSRTypeThr = $("#ddl_cSRTypeThr");				//報修類別(小類)

			var hid_cTeamID = $("#hid_cTeamID");					//服務團隊
			var tbx_cMainEngineerName = $("#tbx_cMainEngineerName");	//主要工程師
			var hid_cMainEngineerID = $("#hid_cMainEngineerID");		//主要工程師ERPID
			var tbx_cSalesName = $("#tbx_cSalesName");				//業務人員
			var hid_cSalesID = $("#hid_cSalesID");					//業務人員ERPID
			var tbx_cSecretaryName = $("#tbx_cSecretaryName");		//業務祕書
			var hid_cSecretaryID = $("#hid_cSecretaryID");			//業務祕書ERPID

			if (ddl_cStatus.val() == "") {
				Msg += "請選擇【狀態】！\n";
			}
			else
			{
				if (cSRID != "")
				{
					if (cNowStatus == "E0001" && hid_cMainEngineerID.val() != "")
					{
						if (ddl_cStatus.val() == "E0001") {						
							Msg += "【狀態】不得為新建，請重新選擇！\n";
						}
					}
					else
					{
						if (cNowStatus != "E0001")
						{
							if (ddl_cStatus.val() == "E0001") {						
								Msg += "【狀態】不得為新建，請重新選擇！\n";
							}
						}
					}
				}
			}

			if (tbx_cCustomerName.val() == "") {
				Msg += "【客戶名稱】不得為空！\n";
			}

			if (hid_cCustomerID.val() == "") {
				Msg += "您未下拉選取【客戶名稱】，請輸入關鍵字後再重新選取！\n";
			}
			
			if (tbx_cDesc.val() == "") {
				Msg += "【說明】不得為空！\n";
			}

			if (tbx_cNotes.val() == "") {
				Msg += "【詳細描述】不得為空！\n";
			}

			if (tbx_cSalesNo.val() == "") {
				Msg += "【銷售訂單號】不得為空！\n";
			}

			if (tbx_cShipmentNo.val() == "") {
				Msg += "【出貨單號】不得為空！\n";
			}

			//if (ddl_cSRTypeOne.val() == "") {
			//	Msg += "請選擇【報修類別(大類)】！\n";
			//}

			//if (ddl_cSRTypeSec.val() == "") {
			//	Msg += "請選擇【報修類別(中類)】！\n";
			//}

			//if (ddl_cSRTypeOne.val() != "ZA05" && ddl_cSRTypeOne.val() != "ZA06")
			//{
			//	if (ddl_cSRTypeThr.val() == "") {
			//		Msg += "請選擇【報修類別(小類)】！\n";
			//	}
			//}				

			if (hid_cTeamID.val() == "") {
				Msg += "請選擇【服務團隊】！\n";
			}

			if (tbx_cMainEngineerName.val() == "") {
				Msg += "【主要工程師】不得為空！\n";
			}

			if (hid_cMainEngineerID.val() == "") {
				Msg += "您未下拉選取【主要工程師】，請輸入關鍵字後再重新選取！\n";
			}

			if (tbx_cSalesName.val() == "") {
				Msg += "【業務人員】不得為空！\n";
			}

			if (hid_cSalesID.val() == "") {
				Msg += "您未下拉選取【業務人員】，請輸入關鍵字後再重新選取！\n";
			}

			if (tbx_cSecretaryName.val() == "") {
				Msg += "【業務祕書】不得為空！\n";
			}

			if (hid_cSecretaryID.val() == "") {
				Msg += "您未下拉選取【業務祕書】，請輸入關鍵字後再重新選取！\n";
			} 

			//提交前【主要工程師姓名和ERPID】是否不一致
			Msg += checkPersonIsMatch("M");

			//提交前【業務人員姓名和ERPID】是否不一致
			Msg += checkPersonIsMatch("S");

			//提交前【業務祕書姓名和ERPID】是否不一致
			Msg += checkPersonIsMatch("ASS");		
		
			//預排日期檢查
			if (cNowStatus != "E0010" && cNowStatus != "E0015") //非裝機完成且非取消才檢查
			{
				if (tbx_cDelayReason.val() != "" && hid_cNowScheduleDate.val() == "")
				{
					if (tbx_cScheduleDate.val() == "")
					{
						Msg += "【預排日期】不得為空！\n";
					}
					else
					{
						var Today = new Date();
						var NowDay = Today.getFullYear() + "-" + (Today.getMonth() + 1) + "-" + Today.getDate();

						if (tbx_cScheduleDate.val() < NowDay) {
							Msg += "【預排日期】不能小於系統日期！\n";							
						}
					}
				}
			}

			//【聯絡人窗口資訊】明細檢查
			Msg += checkDetail_CO();

			//【物料訊息資訊】明細檢查
			Msg += checkDetail_MI();

			//【序號回報資訊】明細檢查
			Msg += checkDetail_SF();

			//【處理與工時紀錄】明細檢查
			Msg += checkDetail_PE();			

			if (Msg != "") {
				alert(Msg);
				
				$("#btn_submit").show();
				$("#btn_submitUP").show();
				$("#waitingImg").hide();
				$("#waitingImgUP").hide();
				return false;
			}
			else {
				SetAllobjEnabledorDisabled(false); 
			}

			return true;
		}		

		//提交前【姓名和ERPID】是否不一致
		//tType：M.主要工程師 S.業務人員 ASS.祕書人員
		function checkPersonIsMatch(tType)
		{
			var Msg = "";
			var cERPID = "";
			var cEName = "";

			var tbx_cMainEngineerName = $("#tbx_cMainEngineerName");	//主要工程師
			var hid_cMainEngineerID = $("#hid_cMainEngineerID");		//主要工程師ERPID		
			var tbx_cSalesName = $("#tbx_cSalesName");				//業務人員
			var hid_cSalesID = $("#hid_cSalesID");					//業務人員ERPID
			var tbx_cSecretaryName = $("#tbx_cSecretaryName");		//業務祕書
			var hid_cSecretaryID = $("#hid_cSecretaryID");			//業務祕書ERPID

			if (tType == "M") //主要工程師
			{
				cERPID = hid_cMainEngineerID.val();
				cEName = tbx_cMainEngineerName.val();
			}
			else if (tType == "S") //業務人員
			{
				cERPID = hid_cSalesID.val();
				cEName = tbx_cSalesName.val();
			}
			else if (tType == "ASS") //業務祕書
			{
				cERPID = hid_cSecretaryID.val();
				cEName = tbx_cSecretaryName.val();
			}

			if (cEName != "") {
				$.ajax({
					url: '@Url.Action("checkPersonIsMatch", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
					async: false,
					data: { 
						cERPID: cERPID, 
						cEName: cEName,
						tType: tType
					},
					success: function (result) {
						if (result != "") {
							Msg = result;
						}
					}
				})
			}

			return Msg;			 
		}

		//提交前【聯絡人窗口資訊】明細檢查
		function checkDetail_CO() {
			var Msg = "";
			var cStatus = $("#ddl_cStatus").val();						
            var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別
			var tCount = 0; //記錄目前有效的明細

			var tableName = "tableCO";
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');
				var tIsError = false;								//記錄是否有錯誤
				var objRowNumber = tds.eq(0).children();			//項次
				var objContactName = tds.eq(1).children().eq(0);	//姓名(聯絡人)
				var objDisabled = tds.eq(1).children().eq(1);		//是否停用(0.啟用 1.停用)				
				var objContactAddress = tds.eq(2).children();		//地址(聯絡人)
				var objContactPhone = tds.eq(3).children();		//電話(聯絡人)
				var objContactMoblie = tds.eq(4).children();		//手機(聯絡人)
				//var objContactEmail = tds.eq(5).children();		//E-Mail(聯絡人)

				if (objContactName.val() != undefined) {                    
					if (objDisabled.val() == "0"){
						if (objContactName.val() == "") {
							Msg += "明細【聯絡人窗口資訊】「項次：" + objRowNumber.html() + "」的【姓名(聯絡人)】不得為空！\n";
							tIsError = true;
						}						

						if (objContactAddress.val() == "") {
							Msg += "明細【聯絡人窗口資訊】「項次：" + objRowNumber.html() + "」的【地址(聯絡人)】不得為空！\n";
							tIsError = true;
						}

						//if (objContactPhone.val() == "" && objContactMoblie.val() == "") {
						//	Msg += "明細【聯絡人窗口資訊】「項次：" + objRowNumber.html() + "」的【電話、手機(聯絡人)】請至少擇一輸入！\n";
						//	tIsError = true;
						//}

						if (!tIsError)
						{
							tCount++;
						}

						//if (objContactEmail.val() == "") {
						//	Msg += "明細【聯絡人窗口資訊】「項次：" + objRowNumber.html() + "」的【E-Mail(聯絡人)】不得為空！\n";
						//}						
					}
                }				
			})		
			
			if (tCount == 0)
			{
				Msg += "請至少新增一筆【客戶聯絡窗口資訊】明細！\n";
			}

			return Msg;
		}

		//提交前【物料訊息資訊】明細檢查
		function checkDetail_MI() {
			var Msg = "";
			var cStatus = $("#ddl_cStatus").val();			
            var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別
			var tCount = 0; //記錄目前有效的明細

			var tableName = "tableMI";
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');		
				var tIsError = false;								//記錄是否有錯誤
				var objRowNumber = tds.eq(0).children();			//項次
				var objMaterialID = tds.eq(1).children().eq(0);	//物料代號
				var objDisabled = tds.eq(1).children().eq(1);		//是否停用(0.啟用 1.停用)				
				var objMaterialName = tds.eq(2).children();		//料號說明
				var objQuantity = tds.eq(3).children();			//數量				

				if (objMaterialID.val() != undefined) {
                    if (objDisabled.val() == "0")
					{
						if (objMaterialID.val() == "") {
							Msg += "明細【物料訊息資訊】「項次：" + objRowNumber.html() + "」的【物料代號】不得為空！\n";
							tIsError = true;
						}

						if (objMaterialName.val() == "") {
							Msg += "明細【物料訊息資訊】「項次：" + objRowNumber.html() + "」的【料號說明】不得為空！\n";
							tIsError = true;
						}

						if (objQuantity.val() == "") {
							Msg += "明細【物料訊息資訊】「項次：" + objRowNumber.html() + "」的【數量】不得為空！\n";
							tIsError = true;
						}

						if (!tIsError)
						{
							tCount++;
						}
					}
                }					
			})	
			
			if (tCount == 0)
			{
				Msg += "請至少新增一筆【物料訊息資訊】明細！\n";
			}

			return Msg;
		}

		//提交前【序號回報資訊】明細檢查
		function checkDetail_SF() {
			var Msg = "";
			var cStatus = $("#ddl_cStatus").val();						
            var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別

			var tableName = "tableSF";
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');
				var objRowNumber = tds.eq(0).children();			//項次
				var objSerialID = tds.eq(1).children().eq(0);		//序號
				var objDisabled = tds.eq(1).children().eq(1);		//是否停用(0.啟用 1.停用)				
				//var objMaterialID = tds.eq(2).children();			//物料代號

				if (objSerialID.val() != undefined) {                    
					if (objDisabled.val() == "0"){
						if (objSerialID.val() == "") {
							Msg += "明細【序號回報資訊】「項次：" + objRowNumber.html() + "」的【序號】不得為空！\n";
						}						

						//if (objMaterialID.val() == "") {
						//	Msg += "明細【序號回報資訊】「項次：" + objRowNumber.html() + "」的【物料代號】不得為空！\n";
						//}						
					}
                }				
			})			

			return Msg;
		}

		//提交前【處理與工時紀錄】明細檢查
		function checkDetail_PE() {
			var Msg = "";
			var cStatus = $("#ddl_cStatus").val();			
            var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別
			var tCount = 0; //記錄目前有效的明細

			var tableName = "tableRecord";
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');	
				var tIsError = false;									//記錄是否有錯誤
				var objRowNumber = tds.eq(0).children();				//項次
				var objEngineerName = tds.eq(1).children().eq(0);		//服務工程師			
				var objEngineerID = tds.eq(1).children().eq(1);		//服務工程師
				var objDisabled = tds.eq(1).children().eq(2);			//是否停用(0.啟用 1.停用)
				var objReceiveTime = tds.eq(2).children();				//接單時間
				var objStartTime = tds.eq(3).children();				//出發時間
				var objArriveTime = tds.eq(4).children();				//到場時間
				var objFinishTime = tds.eq(5).children();				//完成時間
				var objWorkHours = tds.eq(6).children();				//工時(分鐘)
				var objDesc = tds.eq(7).children();					//處理紀錄
				var objSRReport =  tds.eq(8).children().find('input[name="hid_filezoneRE"]');				

				if (objEngineerName.val() != undefined) {
                    if (objDisabled.val() == "0")
					{
						if (objEngineerName.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【服務工程師】不得為空！\n";
							tIsError = true;
						}

						if (objEngineerID.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」未下拉選取【服務工程師】，請輸入關鍵字後再重新選取！\n";
							tIsError = true;
						}

						if (objReceiveTime.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【接單時間】不得為空！\n";
							tIsError = true;
						}

						if (objStartTime.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【出發時間】不得為空！\n";
							tIsError = true;
						}

						if (objArriveTime.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【到場時間】不得為空！\n";
							tIsError = true;
						}

						if (objFinishTime.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【完成時間】不得為空！\n";
							tIsError = true;
						}

						if (objWorkHours.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【工時(分鐘)】不得為空！\n";
							tIsError = true;
						}

						if (objDesc.val() == "") {
							Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【處理紀錄】不得為空！\n";
							tIsError = true;
						}

						if (!tIsError)
						{
							tCount++;
						}

						//if (objSRReport.val() == "") {
						//	Msg += "明細【處理與工時紀錄】「項次：" + objRowNumber.html() + "」的【服務報告書】不得為空！\n";
						//}
					}
                }					
			})	
			
			if (cStatus == "E0010") //下拉選擇裝機完成
			{
				if (tCount == 0)
				{
					Msg += "請至少新增一筆【處理與工時紀錄】明細！\n";
				}
			}

			return Msg;
		}		

		//將所有要儲存的欄位(Disabled、Enabled互換)
		//IsDisabled：true.不可改 false.可改
		function SetAllobjEnabledorDisabled(IsDisabled) {			
			//儲存前將狀態設為可改，後端才能儲存
			$(".Status").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});			
			
			//儲存前將客戶名稱設為可改，後端才能儲存
			$(".CustName").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});			

			//儲存前將姓名(聯絡人)設為可改，後端才能儲存
			$(".ContactName").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將地址(聯絡人)設為可改，後端才能儲存
			$(".ContactAddress").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將電話(聯絡人)設為可改，後端才能儲存
			$(".ContactPhone").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將手機(聯絡人)設為可改，後端才能儲存
			$(".ContactMobile").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});

			//儲存前將客Email(聯絡人)設為可改，後端才能儲存
			$(".ContactEmail").each(function () {
				var obj = $(this);
				obj.prop('disabled', IsDisabled);
			});
		}		

		//客戶名稱onchange事件(清除客戶報修人和聯絡人資訊)
		function onChang_tbx_cCustomerName()
		{
			clearDetail_CO();				//清除所有【聯絡人窗口資訊】檢查
		}

		//清除所有【聯絡人窗口資訊】檢查
		function clearDetail_CO() {
			var Msg = "";
			var tableName = "tableCO";
			var trs = $("#" + tableName + " tr");			

			$.each(trs, function (i, itr) {
				var tds = $(itr).find('td');
				var objContactName = tds.eq(1).children().eq(0);	//姓名(聯絡人)
				var objDisabled = tds.eq(1).children().eq(1);		//是否停用(0.啟用 1.停用)

				if (objContactName.val() != undefined) {                    
					tds.hide();
					objDisabled.val("1");
                }				
			})			
		}

		//SAP客戶代號/客戶名稱查詢
		//compcde(Comp-1.大世科 Comp-2.群輝 Comp-3.上海 Comp-4.協志)
		function CustSearch() {
			var compcde = $("#hid_cLoginUser_CompCode").val();
			
			$(".CustName").unbind();

			$(".CustName").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 37 && event.keyCode != 38 && event.keyCode != 39 && event.keyCode != 40) {
						var keyword = $(this).val();
						if (keyword.length > 1) {
							var obj = $(this);
							$.ajax({
								url: '@Url.Action("findCustByKeywordAndComp", "ServiceRequest")',
								type: 'post',
								dataType: 'json',
								data: { functionName: 'findCustByKeywordAndComp', keyword: keyword, compcde: compcde },
								success: function (result) {
									Customers = [];
									$.each(result, function (i, idata) {
										Customers[i] = {
											label: idata.Kna1Kunnr + "\\" + idata.Kna1Name1, //顯示在清單的東西
											idx: i,
											id: idata.Kna1Kunnr,
											value: idata.Kna1Name1 //這個是要填入textbox的值
										};
									});

									//綁定foucs事件
									obj.autocomplete({
										source: Customers,
										select: function (event, ui) {
											var hid_cCustomerID = $("#hid_cCustomerID");			//客戶ID		
											var lbl_cCustomerID = $("#lbl_cCustomerID");			//客戶ID Lable

											if (hid_cCustomerID.val() != "" && hid_cCustomerID.val() != ui.item.id)
											{
												onChang_tbx_cCustomerName(); //清除客戶報修人和聯絡人資訊
											}

											lbl_cCustomerID.html(ui.item.id);
											hid_cCustomerID.val(ui.item.id);
											
											var tType =  ui.item.id.substr(0,1);

											if (tType == "P") 
											{
												$('#ddl_cCustomerType').val("P");
											}
											else
											{
												$('#ddl_cCustomerType').val("C");
											}
										}
									}).bind('focus', function () { $(this).autocomplete("search"); });

									//開啟autocomplete選單
									obj.focus();
								}
							})
						}
					}

				}
			})
		}

		//產品序號資訊查詢
	    function SerialSearch() {
			$(".Serial").unbind();

			$(".Serial").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 37 && event.keyCode != 38 && event.keyCode != 39 && event.keyCode != 40) {
						var IV_SERIAL = $(this).val();

						if (IV_SERIAL.length > 1) {
							var obj = $(this);
							$.ajax({
								url: '@Url.Action("findMaterialBySerial", "ServiceRequest")',
								type: 'post',
								dataType: 'json',
								data: { functionName: 'findMaterialBySerial', IV_SERIAL: IV_SERIAL},
								success: function (result) {
									materials = [];
									$.each(result, function (i, idata) {
										materials[i] = {
											label: idata.iV_SERIAL + "\\" + idata.prodID + "\\" + idata.product, //顯示在清單的東西
											idx: i,
											value: idata.iV_SERIAL,       //這個是要填入textbox的值(序號)
                                            ProdID: idata.prodID,			//料號
											Product: idata.product		//品名/規格											
										};
									});

									//綁定foucs事件
									obj.autocomplete({
										source: materials,
										select: function (event, ui) {
											var tr = obj.parent().parent();
											var tds = tr.find("td");

											tds.eq(2).children().val(ui.item.ProdID);
											tds.eq(3).children().val(ui.item.Product);
										}
									}).bind('focus', function () { $(this).autocomplete("search"); });

									//開啟autocomplete選單
                                    obj.focus();									
								}
							})
						}
					}

				}
			})
        }		

		//用物料編號查詢BOM表
		function showBOMDialog(ProdID) {
			if (ProdID != "")
			{
				$("#ShowBOMDialog").modal("show");
				$("#ShowBOMdialogTitle").html("BOM表");
				
				$.ajax({
					url: '@Url.Action("SpareBOM", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
					data: {
						ProdID: ProdID		//物料編號
					},
					success: function (result) {
					},
					complete: function (result) {
						$("#ShowBOMdialogContent").html(result.responseText);
					}
				});
			}
		}

		//Ajax取得物料相關資訊
		function findMaterialInfo(obj, ProdID) {			

			$.ajax({
				url: '@Url.Action("findMaterialInfo", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
				data: { functionName: 'findMaterialInfo', ProdID: ProdID },
				success: function (result) {
					if (result != undefined) {
						var tr = obj.parent().parent();
						var tds = tr.find("td");
						
						tds.eq(2).children().val(result.materialName);
						tds.eq(4).children().val(result.basicContent);						
						tds.eq(5).children().val(result.mfpNumber);
						tds.eq(6).children().val(result.brand);
						tds.eq(7).children().val(result.productHierarchy);
					}
				}
			})
		}

		//用關鍵字查詢物料
		function findMaterialByKeyword() {
			var cBUKRS = $("#hid_cLoginUser_BUKRS").val();		  //公司別
			$(".material").unbind();

			$(".material").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 38 && event.keyCode != 40) {
						var keyword = $(this).val();
						var obj = $(this);
						var ojbID = $(this).attr("id");
							$.ajax({
								url: '@Url.Action("findMaterial", "ServiceRequest")',
								type: 'post',
								dataType: 'json',
								data: { 
									functionName: 'findMaterial', 
									cBUKRS: cBUKRS,
									keyword: keyword 
								},
								success: function (result) {
									materials = [];
									$.each(result, function (i, idata) {
										materials[i] = {
											label: idata.maraMatnr + "\\" + idata.maktTxza1Zf,
											idx: i,
											value: idata.maraMatnr,
											Name: idata.maktTxza1Zf,
										Desc: idata.maktTxza1Zf
										};
									});

									 //綁定foucs事件
									obj.autocomplete({
										source: materials,
										select: function (event, ui) {
											var tr = obj.parent().parent();
											var tds = tr.find("td");
											if (ojbID.indexOf('tbx_MIcMaterialID') >= 0)
											{
												findMaterialInfo(obj, ui.item.value);
											}
											else if (ojbID.indexOf('tbx_SFcMaterialID') >= 0)
											{
												tds.eq(3).children().val(ui.item.Name);
											}												
										}
									}).bind('focus', function () { $(this).autocomplete("search"); });

									//開啟autocomplete選單
									obj.focus();
								}
							})
					}
				}
			})
		}

		//Ajax用中文或英文姓名查詢人員帳號
		function PeopleSearch() {
			$(".Peoploe").unbind();

			$(".Peoploe").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 37 && event.keyCode != 38 && event.keyCode != 39 && event.keyCode != 40) {
						var keyword = $(this).val();						
						if (keyword.length > 1) {
							var obj = $(this);
							var ojbID = $(this).attr("id");

							$.ajax({
									url: '@Url.Action("AjaxfindEmployeeByKeyword", "ServiceRequest")',
									type: 'post',
									dataType: 'json',
									data: { 
										functionName: 'AjaxfindEmployeeByKeyword', keyword: keyword },
										success: function (result) {
										objects = [];
										$.each(result, function (i, idata) {
											objects[i] = {
												label: idata.CEmployeeCName + "\\" + idata.CEmployeeEname + "\\" + idata.CEmployeeErpid,
												idx: i,
												value: idata.CEmployeeCName + " " + idata.CEmployeeEname,
												ERPID: idata.CEmployeeErpid  //value這個值，一定要在label裡才能顯示出下拉
											};
										});

										//綁定foucs事件
										obj.autocomplete({
											source: objects,
											select: function (event, ui) {
												if (ojbID.indexOf('tbx_cMainEngineerName') >= 0)
												{
													$('#hid_cMainEngineerID').val(ui.item.ERPID);
												}
												else if (ojbID.indexOf('tbx_cSalesName') >= 0)
												{
													$('#hid_cSalesID').val(ui.item.ERPID);
												}
												else if (ojbID.indexOf('tbx_cSecretaryName') >= 0)
												{
													$('#hid_cSecretaryID').val(ui.item.ERPID);
												}
												else if (ojbID.indexOf('tbx_pjAssEngineerName') >= 0)
												{
													$('#hid_pjAssEngineerAcc').val(ui.item.ERPID);
												}												
												else if (ojbID.indexOf('tbx_REcEngineerName') >= 0)
												{
													var tNo = ojbID.replace('tbx_REcEngineerName','');
													$('#hid_REcEngineerID' + tNo).val(ui.item.ERPID);
												}												
											}
										}).bind('focus', function () { obj.autocomplete("search"); });

										//開啟autocomplete選單
										obj.focus();
										$(".ui-autocomplete").css({ 'z-index': '2051', 'font-size': '16px' }); //可以正常顯示關鍵字查詢
									}
								})
							
						}
					}
				}
			})
		}		

		//Ajax用中文或英文姓名查詢人員帳號(by服務團隊)
		function PeopleTeamSearch() {
			$(".PeoploeTeam").unbind();

			$(".PeoploeTeam").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13 && event.keyCode != 37 && event.keyCode != 38 && event.keyCode != 39 && event.keyCode != 40) {
						var keyword = $(this).val();	
						var cTeamID = $("#hid_cTeamID").val();

						if (keyword.length > 1) {
							
							if (cTeamID == "")
							{
								alert("請先選擇服務團隊，再輸入關鍵字查詢!");
								$(this).val("");
							}
							else
							{
								var obj = $(this);
								var ojbID = $(this).attr("id");

								$.ajax({
										url: '@Url.Action("AjaxfindTeamEmployeeByKeyword", "ServiceRequest")',
										type: 'post',
										dataType: 'json',
										data: { 
											functionName: 'AjaxfindTeamEmployeeByKeyword', cTeamID: cTeamID, keyword: keyword },
											success: function (result) {
											objects = [];
											$.each(result, function (i, idata) {
												objects[i] = {
													label: idata.Name2 + "\\" + idata.Name + "\\" + idata.ErpId,
													idx: i,
													value: idata.Name2 + " " + idata.Name,
													ERPID: idata.ErpId  //value這個值，一定要在label裡才能顯示出下拉
												};
											});

											//綁定foucs事件
											obj.autocomplete({
												source: objects,
												select: function (event, ui) {
													if (ojbID.indexOf('tbx_cMainEngineerName') >= 0)
													{
														$('#hid_cMainEngineerID').val(ui.item.ERPID);
													}													
													else if (ojbID.indexOf('tbx_pjAssEngineerName') >= 0)
													{
														$('#hid_pjAssEngineerAcc').val(ui.item.ERPID);
													}										
												}
											}).bind('focus', function () { obj.autocomplete("search"); });

											//開啟autocomplete選單
											obj.focus();
											$(".ui-autocomplete").css({ 'z-index': '2051', 'font-size': '16px' }); //可以正常顯示關鍵字查詢
										}
								})
							}
						}
					}
				}
			})
		}
		//-----↓↓↓↓↓客戶聯絡人 ↓↓↓↓↓-----

		//Email格式檢查
		function CheckEmailValid() {
			var email = $("#tbx_cAddContactEmail").val();

			if (email != "")
			{
				$.ajax({
					url: '@Url.Action("CheckEmailValid", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
					data: { functionName: 'CheckEmailValid', email: email },
					success: function (result) {
						if (!result) {
							alert("Email格式不正確，請重新輸入！");
							$("#tbx_cAddContactEmail").val("");
						}
					}
				})
			}			
		}

		//Email格式檢查(for編輯聯絡人)
		function CheckEditEmailValid() {
			var email = $("#tbx_cEditContactEmail").val();

			if (email != "")
			{
				$.ajax({
					url: '@Url.Action("CheckEmailValid", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
					data: { functionName: 'CheckEmailValid', email: email },
					success: function (result) {
						if (!result) {
							alert("Email格式不正確，請重新輸入！");
							$("#tbx_cEditContactEmail").val("");
						}
					}
				})
			}
		}

		//顯示選擇客戶聯絡人popup
		function showContactInfo(tIDName) {			
			var CustomerID = $('#hid_cCustomerID').val();
			var cBUKRS = $("#hid_cLoginUser_BUKRS").val();

			if (CustomerID == "")
			{
				alert("您尚未輸入【客戶】！");
			}
			else
			{
				FindContactInfo(tIDName, cBUKRS, CustomerID);
				$('#dialog_pContactInfo').modal('show');
			}
		}
		
		//取得客戶聯絡人
		//cBUKRS.公司別
		//CustomerID.客戶ID
		function FindContactInfo(tIDName, cBUKRS, CustomerID) {
			$.ajax({
				url: '@Url.Action("FindContactInfo", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
				data: {
					tIDName: tIDName,
					cBUKRS: cBUKRS,
					CustomerID: CustomerID
				},
				success: function (result) {
				},
				complete: function (result) {
					$("#tb_pContactInfo").html(result.responseText);				
				}				
			});
		}		

		//選取客戶聯絡人並將相關資訊帶回已更新聯絡資訊
		function selectContactInfo(tIDName, Name, City, Address, Email, phone, Mobile) {
			var tbx_cRepairName = $("#tbx_cRepairName");				//客戶報修人			
			var tbx_cRepairAddress = $("#tbx_cRepairAddress");			//地址(報修人)
			var tbx_cRepairPhone = $("#tbx_cRepairPhone");				//電話(報修人)
			var tbx_cRepairMobile = $("#tbx_cRepairMobile");				//手機(報修人)
			var tbx_cRepairEmail = $("#tbx_cRepairEmail");				//Email(報修人)

			var tNo = tIDName.replace("tbx_COcContactName","");			//聯絡人目前No
			var tbx_COcContactName = $("#tbx_COcContactName" + tNo);		//姓名(聯絡人)
			var tbx_COcContactAddress = $("#tbx_COcContactAddress"+ tNo);	//地址(聯絡人)
			var tbx_COcContactPhone = $("#tbx_COcContactPhone"+ tNo);		//電話(聯絡人)
			var tbx_COcContactMobile = $("#tbx_COcContactMobile"+ tNo);	//手機(聯絡人)
			var tbx_COcContactEmail = $("#tbx_COcContactEmail"+ tNo);		//Email(聯絡人)

			Name = Name.replace(/\’/g, "'");							//單引號，全型->半型
			City = City.replace(/\’/g, "'");							//單引號，全型->半型
			Address = Address.replace(/\’/g, "'");					//單引號，全型->半型
			phone = phone.replace(/\’/g, "'");						//單引號，全型->半型
			Mobile = Mobile.replace(/\’/g, "'");						//單引號，全型->半型
			
			if (tIDName == "tbx_cRepairName") {
				tbx_cRepairName.val(Name);
				tbx_cRepairAddress.val(City + Address);
				tbx_cRepairPhone.val(phone);
				tbx_cRepairMobile.val(Mobile);
				tbx_cRepairEmail.val(Email);
			}
			else
			{
				tbx_COcContactName.val(Name);
				tbx_COcContactAddress.val(City + Address);
				tbx_COcContactPhone.val(phone);
				tbx_COcContactMobile.val(Mobile);
				tbx_COcContactEmail.val(Email);
			}

			$("#dialog_pContactInfo").modal('hide');
		}

		//清除客戶報修人
		function clearRepairName() {
			$("#tbx_cRepairName").val('');			//姓名(報修人)
			$("#tbx_cRepairAddress").val('');		//地址(報修人)
			$("#tbx_cRepairPhone").val('');		//電話(報修人)
			$("#tbx_cRepairMobile").val('');		//手機(報修人)
			$("#tbx_cRepairEmail").val('');		//Email(報修人)
		}			

		//新增客戶聯絡人
		function btn_AddContactInfo_onclick() {			
			var CustomerID = $('#hid_cCustomerID').val();			

			if (CustomerID == "")
			{
				alert("您尚未輸入【客戶】！");
			}
			else
			{
				resetPopup("#dialog_pAddContactInfo");		//popup各欄位reset				

				$("#dialog_pAddContactInfo .dropzone").show();
				$("#dialog_pAddContactInfo").modal('show');
			}
		}		

		//取得要編輯/刪除的聯絡人資訊
        function getpjEditContact() {
            var cBUKRS = $("#hid_cLoginUser_BUKRS").val();
			var cCustomerID = $("#hid_cCustomerID").val();	
			var ContactName = $("#tbx_editContactName").val();	

			if(ContactName == "")
			{
				alert("您未輸入聯絡人姓名！")
				return false;
			}
            
			$.ajax({
				url: '@Url.Action("AjaxfindContactByKeyword", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {
					cBUKRS: cBUKRS,
					cCustomerID: cCustomerID,
					keyword: ContactName
                },
                success: function (result) {
                    var list = "";
					
					$.each(result, function (i, bean) {
                        if (bean != null) {
                            var Mobile = "";
							
							if (bean.contactMobile != null) 
							{
								Mobile = bean.contactMobile;
							}
							
							list += '<tr id="tr_pjeditContact_' + bean.contactId + '">'
                                + "<input type='hidden' class='hidpjContactID' value='" + bean.contactId + "'>"								
                                + "<td>"
								+ '	<button class="btn btn-info btn-sm" type="button" onclick="editpjeditContact(this)"; style="margin: 2px;">'
                                + '		<i class="fa fa-pencil"></i>'
                                + '	</button>'
                                + '	<button class="btn btn-danger btn-sm" type="button" onclick="deletepjeditContact(this);" style="margin: 2px;">'
                                + '		<i class="fa fa-trash"></i>'
                                + '	</button>'
                                + "</td>"
                                + "<td class='pjeditcontactName' style='vertical-align: middle;'>" + bean.contactName + "</td>"
                                + "<td class='pjeditcontactPhone' style='vertical-align: middle;'>" + bean.contactPhone + "</td>"
								+ "<td class='pjeditcontactMobile' style='vertical-align: middle;'>" + Mobile + "</td>"
                                + "<td class='pjeditcontactCity' style='vertical-align: middle;'>" + bean.contactCity + "</td>"
								+ "<td class='pjeditcontactAddress' style='vertical-align: middle;'>" + bean.contactAddress + "</td>"
								+ "<td class='pjeditcontactEmail' style='vertical-align: middle; text-align: left;'>" + bean.contactEmail + "</td>"                                
                            + "</tr>";
						}
                    });

                    if (list != "") {
                        list = "<table class='table table-striple table-bordered table-hover dataTables-example' style='word-break: keep-all; white-space: nowrap; text-align: center;'>"
                            + "<thead><tr>"
                                + "<th>編輯/刪除</th>"
                                + "<th>姓名</th>"
                                + "<th>電話</th>"
								+ "<th>手機</th>"
                                + "<th>城市</th>"
								+ "<th>詳細地址</th>"                                
                                + "<th>Email</th>"                                
                            + "</tr></thead><tbody>"
                            + list
                            + "</tbody></table>";
					}
					else {
						list = "查無聯絡人資訊！";
					}

                    $("#tb_pjeditContact").html(list);                    
                }
			});
        }

		//清除編輯客戶聯絡人欄位
		function cleanpjeditContact()
		{
			$("#hid_cEditContactID").val("");
			$("#tbx_cEditContactName").val("");
			$("#tbx_cEditContactPhone").val("");
			$("#tbx_cEditContactMobile").val("");
			$("#tbx_cEditContactCity").val("");
			$("#tbx_cEditContactAddress").val("");
			$("#tbx_cEditContactEmail").val("");
		}

		//編輯客戶聯絡人
        function editpjeditContact(obj) {
            var pjContactID = $(obj).parent().parent().find(".hidpjContactID").val();
			
			var tds =  $(obj).parent().parent().find('td');
			var pjeditcontactName = tds.eq(1).html();
			var pjeditcontactPhone = tds.eq(2).html();
			var pjeditcontactMobile = tds.eq(3).html();
			var pjeditcontactCity = tds.eq(4).html();
			var pjeditcontactAddress = tds.eq(5).html();
			var pjeditcontactEmail = tds.eq(6).html();
			
			$("#hid_cEditContactID").val(pjContactID);
			$("#tbx_cEditContactName").val(pjeditcontactName);
			$("#tbx_cEditContactPhone").val(pjeditcontactPhone);
			$("#tbx_cEditContactMobile").val(pjeditcontactMobile);
			$("#tbx_cEditContactCity").val(pjeditcontactCity);
			$("#tbx_cEditContactAddress").val(pjeditcontactAddress);
			$("#tbx_cEditContactEmail").val(pjeditcontactEmail);

			$("#btn_savepjEditContact").show();
        }

		//刪除客戶聯絡人
        function deletepjeditContact(obj) {
            var pjContactID = $(obj).parent().parent().find(".hidpjContactID").val();			

            if (confirm("確認刪除此聯絡人？")) {
                $.ajax({
					url: '@Url.Action("DeletepjContact", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {
                        cContactID: pjContactID						
                    },
                    success: function (result) {
                        if (result.indexOf("Error") >= 0) {
                           alert("刪除失敗！");
                        }
                        else {							
                            alert("刪除成功！");
							getpjEditContact();
                        }
                    }
				});
            }
        }

		//儲存客戶聯絡人(for編輯)
		function savepjEditContact() {
			var strMsg = "";
			
			var hid_cLoginUser_Name = $("#hid_cLoginUser_Name");
			var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS");
			var tbx_cCustomerName = $("#tbx_cCustomerName");
			var hid_cCustomerID = $("#hid_cCustomerID");
			
			var hid_cEditContactID = $("#hid_cEditContactID");			    //客戶聯絡人GUID
			var tbx_cEditContactName = $("#tbx_cEditContactName");			//客戶聯絡人姓名
			var tbx_cEditContactCity = $("#tbx_cEditContactCity");			//客戶聯絡人城市
			var tbx_cEditContactAddress = $("#tbx_cEditContactAddress");		//客戶聯絡人詳細地址			
			var tbx_cEditContactPhone = $("#tbx_cEditContactPhone");			//客戶聯絡人電話
			var tbx_cEditContactMobile = $("#tbx_cEditContactMobile");		//客戶聯絡人手機
			var tbx_cEditContactEmail = $("#tbx_cEditContactEmail");			//客戶聯絡人Email			

			if (tbx_cEditContactName.val() == "") {
				strMsg += "客戶聯絡人【姓名】不得為空！\n";
			}

			if (tbx_cEditContactCity.val() == "") {
				strMsg += "客戶聯絡人【城市】不得為空！\n";
			}

			if (tbx_cEditContactAddress.val() == "") {
				strMsg += "客戶聯絡人【詳細地址】不得為空！\n";
			}			

			//if (tbx_cEditContactPhone.val() == "" && tbx_cEditContactMobile.val() == "") {
			//	strMsg += "客戶聯絡人【電話】【手機】請至少擇一輸入！\n";
			//}			

			//if (tbx_cEditContactEmail.val() == "") {
			//	strMsg += "客戶聯絡人【Email】不得為空！\n";
			//}

			if (strMsg != "") {
				alert(strMsg);
			}
            else {
				$("#btn_savepjEditContact").hide();
                $("#img_waiting_savepjEditContact").show();
				$.ajax({
					url: '@Url.Action("SaveEditContactInfo", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {
						cEditContactID: hid_cEditContactID.val(),
						cBUKRS:hid_cLoginUser_BUKRS.val(),
						cCustomerID: hid_cCustomerID.val(),
						cCustomerName: tbx_cCustomerName.val(),
						cEditContactName: tbx_cEditContactName.val(),
						cEditContactCity: tbx_cEditContactCity.val(),
						cEditContactAddress: tbx_cEditContactAddress.val(),
						cEditContactPhone: tbx_cEditContactPhone.val(),
						cEditContactMobile: tbx_cEditContactMobile.val(),
						cEditContactEmail: tbx_cEditContactEmail.val(),
						ModifiedUserName: hid_cLoginUser_Name.val()
                    },
                    success: function (result) {
                        if (result == "SUCCESS") {                           
                            alert("儲存成功！");
							 $('#dialog_pjEditContactInfo').modal('hide');
                        }
                        else {
							alert("儲存失敗！");
                        }
                        $("#img_waiting_savepjEditContact").hide();
                        $("#btn_savepjEditContact").show();
                    },                   
				});
			}
        }

		//儲存客戶聯絡人(for新增)
		function saveContactInfo() {
			var strMsg = "";
			
			var hid_cLoginUser_Name = $("#hid_cLoginUser_Name");
			var hid_cLoginUser_BUKRS = $("#hid_cLoginUser_BUKRS");
			var tbx_cCustomerName = $("#tbx_cCustomerName");
			var hid_cCustomerID = $("#hid_cCustomerID");
			
			var tbx_cAddContactName = $("#tbx_cAddContactName");				//客戶聯絡人姓名
			var tbx_cAddContactCity = $("#tbx_cAddContactCity");				//客戶聯絡人城市
			var tbx_cAddContactAddress = $("#tbx_cAddContactAddress");		//客戶聯絡人詳細地址
			var tbx_cAddContactAddress_No = $("#tbx_cAddContactAddress_No");	//客戶聯絡人門牌號碼/樓層
			var tbx_cAddContactPhone = $("#tbx_cAddContactPhone");			//客戶聯絡人電話
			var tbx_cAddContactMobile = $("#tbx_cAddContactMobile");			//客戶聯絡人手機
			var tbx_cAddContactEmail = $("#tbx_cAddContactEmail");			//客戶聯絡人Email			

			if (tbx_cAddContactName.val() == "") {
				strMsg += "客戶聯絡人【姓名】不得為空！\n";
			}

			if (tbx_cAddContactCity.val() == "") {
				strMsg += "客戶聯絡人【城市】不得為空！\n";
			}

			if (tbx_cAddContactAddress.val() == "") {
				strMsg += "客戶聯絡人【詳細地址】不得為空！\n";
			}

			if (tbx_cAddContactAddress_No.val() == "") {
				strMsg += "客戶聯絡人【門牌號碼/樓層】不得為空！\n";
			}

			//if (tbx_cAddContactPhone.val() == "" && tbx_cAddContactMobile.val() == "") {
			//	strMsg += "客戶聯絡人【電話】【手機】請至少擇一輸入！\n";
			//}

			//if (tbx_cAddContactEmail.val() == "") {
			//	strMsg += "客戶聯絡人【Email】不得為空！\n";
			//}

			if (strMsg != "") {
				alert(strMsg);
			}
            else {
				var tAddress = tbx_cAddContactAddress.val() + tbx_cAddContactAddress_No.val();

				$("#btn_saveContactInfo").hide();
                $("#img_waiting_saveContactInfo").show();
				$.ajax({
					url: '@Url.Action("SaveContactInfo", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {						
						cBUKRS:hid_cLoginUser_BUKRS.val(),
						cCustomerID: hid_cCustomerID.val(),
						cCustomerName: tbx_cCustomerName.val(),
						cAddContactName: tbx_cAddContactName.val(),
						cAddContactCity: tbx_cAddContactCity.val(),
						cAddContactAddress: tAddress,
						cAddContactPhone: tbx_cAddContactPhone.val(),
						cAddContactMobile:tbx_cAddContactMobile.val(),
						cAddContactEmail: tbx_cAddContactEmail.val(),
						ModifiedUserName: hid_cLoginUser_Name.val()
                    },
                    success: function (result) {
                        if (result == "SUCCESS") {                           
                            alert("儲存成功！");
							$("#dialog_pAddContactInfo").modal('hide');							
                        }
                        else {
							alert("儲存失敗！");
                        }
                        $("#img_waiting_saveContactInfo").hide();
                        $("#btn_saveContactInfo").show();
                    },                   
				});
			}
        }
		//-----↑↑↑↑↑客戶聯絡人 ↑↑↑↑↑-----

		//-----↓↓↓↓↓服務團隊 ↓↓↓↓↓-----
        //修改服務團隊
        function savepjTeam() {
            var hid_cTeamID = $("#hid_cTeamID");

			if ($("#ddl_cTeamID").val() == "") {
                alert("請選擇服務團隊");
            }
            else {
					$("#btn_savepjTeam").hide();
                    $("#img_waiting_savepjTeam").show();

				    $.ajax({
					    url: '@Url.Action("SavepjTeam", "ServiceRequest")',
					    type: 'post',
					    dataType: 'json',
                        data: {                            
                            cTeamID: hid_cTeamID.val(),
							cTeamAcc: $("#ddl_cTeamID").val(),
                        },
                        success: function (result) {
                            if (result.indexOf("Error") >= 0) {
							   alert("儲存失敗！" + result);
							}
							else {
								//alert("儲存成功");
								hid_cTeamID.val(result);
								getpjTeam();                            
							}
                        }
                    });

                    $("#img_waiting_savepjTeam").hide();
                    $("#btn_savepjTeam").show();
            }
        }

        //取得服務團隊
        function getpjTeam() {            
			$("#ddl_cTeamID").val("");
			
			var hid_cTeamID = $("#hid_cTeamID");
            
			$.ajax({
				url: '@Url.Action("GetpjTeam", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {                    
					cTeamID : hid_cTeamID.val(),
                },
                success: function (result) {
                    var list = "";
					var pjTeamName = "";
					$.each(result, function (i, bean) {
                        if (bean != null) {
							pjTeamName += bean.teamName + ";";

                            list += '<tr id="tr_pjTeam_' + bean.id + '">'
                                + "<input type='hidden' class='hidpjTeamAcc' value='" + bean.teamID + "'>"
                                + '<td>'
                                    + '<button class="btn btn-danger btn-sm btnCtDelete btnPreventDefault" type="button" onclick="deletepjTeam(this);" style="margin: 2px;">'
                                        + '<i class="fa fa-trash"></i>'
                                    + '</button>'
                                + '</td>'								
                                + "<td style='vertical-align: middle;'>" + bean.teamName + "</td>"
								+ "<td style='vertical-align: middle;'>" + bean.deptId + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.deptName + "</td>"
                            + "</tr>";
						}
                    });

                    if (list != "") {
                        list = "<table class='table table-striple table-bordered table-hover dataTables-example' style='word-break: keep-all; white-space: nowrap; text-align: center;'>"
                            + "<thead><tr>"
                                + "<th>刪除</th>"                                
                                + "<th>服務團隊</th>"
                                + "<th>部門ID</th>"
                                + "<th>部門名稱</th>"                                
                            + "</tr></thead><tbody>"
                            + list
                            + "</tbody></table>";
					}
                    $("#tb_pjTeam").html(list);

                    pjTeamName = pjTeamName.substr(0, pjTeamName.length - 1);
                    $("#tbx_cTeamName").val(pjTeamName);
                }
			});
        }

        //刪除服務團隊
        function deletepjTeam(obj) {
            var pjTeamAcc = $(obj).parent().parent().find(".hidpjTeamAcc").val();
			var hid_cTeamID = $("#hid_cTeamID");

            if (confirm("確認刪除此服務團隊？")) {
                $.ajax({
					url: '@Url.Action("DeletepjTeam", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {
                        cTeamID: hid_cTeamID.val(),
						cTeamAcc: pjTeamAcc,
                    },
                    success: function (result) {
                        if (result.indexOf("Error") >= 0) {
                           alert("刪除失敗！");
                        }
                        else {
							//alert("刪除成功");
							hid_cTeamID.val(result);
                            getpjTeam();                            
                        }
                    }
				});
            }
        }
		//-----↑↑↑↑↑服務團隊 ↑↑↑↑↑-----

		//-----↓↓↓↓↓協助工程師 ↓↓↓↓↓-----
        //修改協助工程師
        function savepjAssEngineer() {
            var hid_cAssEngineerID = $("#hid_cAssEngineerID");

			if ($("#hid_pjAssEngineerAcc").val() == "") {
                alert("請輸入協助工程師姓名");
            }
            else {
					$("#btn_savepjAssEngineer").hide();
                    $("#img_waiting_savepjAssEngineer").show();

				    $.ajax({
					    url: '@Url.Action("SavepjAssEngineer", "ServiceRequest")',
					    type: 'post',
					    dataType: 'json',
                        data: {                            
                            cAssEngineerID: hid_cAssEngineerID.val(),
							cAssEngineerAcc: $("#hid_pjAssEngineerAcc").val(),
                        },
                        success: function (result) {
                            if (result.indexOf("Error") >= 0) {
							   alert("儲存失敗！" + result);
							}
							else {
								//alert("儲存成功");
								hid_cAssEngineerID.val(result);
								getpjAssEngineer();                            
							}
                        }
                    });

                    $("#img_waiting_savepjAssEngineer").hide();
                    $("#btn_savepjAssEngineer").show();
            }
        }

        //取得協助工程師
        function getpjAssEngineer() {
            $("#hid_pjAssEngineerAcc").val("");
            $("#tbx_pjAssEngineerName").val("");
			
			var hid_cAssEngineerID = $("#hid_cAssEngineerID");
            
			$.ajax({
				url: '@Url.Action("GetpjAssEngineer", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {                    
					cAssEngineerID : hid_cAssEngineerID.val(),
                },
                success: function (result) {
                    var list = "";
					var pjAssEngineerName = "";
					$.each(result, function (i, bean) {
                        if (bean != null) {
                            pjAssEngineerName += bean.name + ";";

                            list += '<tr id="tr_pjAssEngineer_' + bean.id + '">'
                                + "<input type='hidden' class='hidpjAssEngineerAcc' value='" + bean.acc + "'>"
                                + '<td>'
                                    + '<button class="btn btn-danger btn-sm btnCtDelete btnPreventDefault" type="button" onclick="deletepjAssEngineer(this);" style="margin: 2px;">'
                                        + '<i class="fa fa-trash"></i>'
                                    + '</button>'
                                + '</td>'
                                + "<td style='vertical-align: middle;'>" + bean.name + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.ext + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.mobile + "</td>"
                                + "<td style='vertical-align: middle; text-align: left;'>" + bean.email + "</td>"
                                + "<td style='vertical-align: middle;'>" + bean.deptName + "</td>"                                
                            + "</tr>";
						}
                    });

                    if (list != "") {
                        list = "<table class='table table-striple table-bordered table-hover dataTables-example' style='word-break: keep-all; white-space: nowrap; text-align: center;'>"
                            + "<thead><tr>"
                                + "<th>刪除</th>"
                                + "<th>姓名</th>"
                                + "<th>分機</th>"
                                + "<th>手機</th>"
                                + "<th>Email</th>"
                                + "<th>部門</th>"                                
                            + "</tr></thead><tbody>"
                            + list
                            + "</tbody></table>";
					}
                    $("#tb_pjAssEngineer").html(list);

                    pjAssEngineerName = pjAssEngineerName.substr(0, pjAssEngineerName.length - 1);
                    $("#tbx_cAssEngineerName").val(pjAssEngineerName);
                }
			});
        }

        //刪除協助工程師
        function deletepjAssEngineer(obj) {
            var pjAssEngineerAcc = $(obj).parent().parent().find(".hidpjAssEngineerAcc").val();
			var hid_cAssEngineerID = $("#hid_cAssEngineerID");

            if (confirm("確認刪除此協助工程師？")) {
                $.ajax({
					url: '@Url.Action("DeletepjAssEngineer", "ServiceRequest")',
					type: 'post',
					dataType: 'json',
                    data: {
                        cAssEngineerID: hid_cAssEngineerID.val(),
						cAssEngineerAcc: pjAssEngineerAcc,
                    },
                    success: function (result) {
                        if (result.indexOf("Error") >= 0) {
                           alert("刪除失敗！");
                        }
                        else {
							//alert("刪除成功");
							hid_cAssEngineerID.val(result);
                            getpjAssEngineer();                            
                        }
                    }
				});
            }
        }
		//-----↑↑↑↑↑協助工程師 ↑↑↑↑↑-----		

		//-----↓↓↓↓↓報修類別 ↓↓↓↓↓-----
		//第一階(大類) onChange
		function onChangecSRTypeOne() {

			//先清空下拉選單選項，才不會一直append
			$('#ddl_cSRTypeSec').empty();
			$('#ddl_cSRTypeThr').empty();

			$.ajax({
				url: '@Url.Action("findSRTypeSecList", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {
					keyword: $('#ddl_cSRTypeOne').val(),
				},
                success: function (result) {
                    $.each(result, function (index, obj) {
						$("#ddl_cSRTypeSec").append(
                            $('<option></option>').val(obj.value).html(obj.text)
                        );
                    });
				}
			});
		}

		//第二階(中類) onChange
		function onChangecSRTypeSec() {

			//先清空下拉選單選項，才不會一直append
			$('#ddl_cSRTypeThr').empty();			

			$.ajax({
				url: '@Url.Action("findSRTypeThrList", "ServiceRequest")',
				type: 'post',
				dataType: 'json',
                data: {
					keyword: $('#ddl_cSRTypeSec').val(),
				},
                success: function (result) {
                    $.each(result, function (index, obj) {
						$("#ddl_cSRTypeThr").append(
                            $('<option></option>').val(obj.value).html(obj.text)
                        );
                    });
				}
			});
		}
		//-----↑↑↑↑↑報修類別 ↑↑↑↑↑-----

		//-----↓↓↓↓↓客戶聯絡窗口資訊 ↓↓↓↓↓-----
		//新增明細
		function AddDetailItem_Contact(tableName) {
			trContactNoCount = $("input[name='hid_trContactNo']").val();

			if (trContactNoCount == "" || trContactNoCount == "0") {
				trContactNoCount = 1;
			}
			else {
				trContactNoCount = parseInt(trContactNoCount) + 1;
			}

			$("input[name='hid_trContactNo']").val(trContactNoCount);

			var RowNumber = SetCORowNumber();
			var ContactName = SetContactName();	
			var ContactAddress = SetContactAddress();
			var ContactPhone = SetContactPhone();
			var ContactMobile = SetContactMobile();
			var ContactEmail = SetContactEmail();
			var tDelButton = SetCODelButton();

			var tAlltd = RowNumber + ContactName + ContactAddress + ContactPhone + ContactMobile + ContactEmail + tDelButton;

			$("#" + tableName).append("<tr id='trCO" + trContactNoCount + "'>" + tAlltd + "</tr>");			
		}

		//組項次
		function SetCORowNumber() {
			var reValue = "<td><label name='lbl_PRRowNumber' style='font-size:14pt'>"+ trContactNoCount +"</label></td>";
			return reValue;
		}
		
		//組姓名(聯絡人)
		function SetContactName() {
			var reValue = "<td><input type='text' name='tbx_COcContactName' id='tbx_COcContactName" + trContactNoCount + "' onclick=showContactInfo('tbx_COcContactName" + trContactNoCount + "'); class='form-control ContactName' style='width:200px;' placeholder='請點擊我查詢姓名(聯絡人)' readonly>";					
			reValue += "<input type='hidden' name='hid_COcDisabled' id='hid_COcDisabled" + trContactNoCount + "' value='0'></td>";
			return reValue;
		}			

		//組地址(聯絡人)
		function SetContactAddress() {			
			var reValue = "<td><textarea rows='3' class='form-control ContactAddress' style='width:200px;' placeholder='地址(聯絡人)' name='tbx_COcContactAddress' id='tbx_COcContactAddress" + trContactNoCount + "' disabled></textarea></td>";
			return reValue;
		}

		//組電話(聯絡人)
		function SetContactPhone() {
			var reValue = "<td><input type='text' name='tbx_COcContactPhone' id='tbx_COcContactPhone" + trContactNoCount + "' class='form-control ContactPhone' style='width:200px;' placeholder='電話(聯絡人)' disabled></td>";
			return reValue;
		}

		//組手機(聯絡人)
		function SetContactMobile() {
			var reValue = "<td><input type='text' name='tbx_COcContactMobile' id='tbx_COcContactMobile" + trContactNoCount + "' class='form-control ContactMobile' style='width:200px;' placeholder='手機(聯絡人)' disabled></td>";
			return reValue;
		}

		//組E-Mail(聯絡人)
		function SetContactEmail() {
			var reValue = "<td><input type='text' name='tbx_COcContactEmail' id='tbx_COcContactEmail" + trContactNoCount + "' class='form-control ContactEmail' style='width:350px;' placeholder='E-Mail(聯絡人)' disabled></td>";
			return reValue;
		}

		//組刪除按鈕
		function SetCODelButton()
		{
			var tTrID = $("input[name='hid_trContactNo']").val();
			var reValue = "<td><button name='btn_ContactDel' class='btn btn-danger' type='button' onclick=DelDetailItem_Contact('trCO" + tTrID + "','" + trContactNoCount + "');><i class='fa fa-trash'></i></button></td>";
			return reValue;
		}		

		//刪除明細
		function DelDetailItem_Contact(rowId, tNo) {	
			$('#' + rowId).hide();
			$('#hid_COcDisabled' + tNo).val("1");
		}
		//-----↑↑↑↑↑客戶聯絡窗口資訊 ↑↑↑↑↑-----

		//-----↓↓↓↓↓物料訊息檔 ↓↓↓↓↓-----		

		//新增明細
		function AddDetailItem_Material(tableName) {
			trMaterialNoCount = $("input[name='hid_trMaterialNo']").val();

			if (trMaterialNoCount == "" || trMaterialNoCount == "0") {
				trMaterialNoCount = 1;
			}
			else {
				trMaterialNoCount = parseInt(trMaterialNoCount) + 1;
			}

			$("input[name='hid_trMaterialNo']").val(trMaterialNoCount);

			var RowNumber = SetMIRowNumber();			
			var MaterialID = SetMIMaterialID();
			var MaterialName = SetMIMaterialName();
			var Quantity = SetMIQuantity();
			var BasicContent = SetMIBasicContent();
			var MFPNumber = SetMIMFPNumber();
			var Brand = SetMIBrand();
			var ProductHierarchy = SetMIProductHierarchy();			
			var tDelButton = SetMIDelButton();

			var tAlltd = RowNumber + MaterialID + MaterialName + Quantity + BasicContent + MFPNumber + Brand + ProductHierarchy + tDelButton;

			$("#" + tableName).append("<tr id='trMA" + trMaterialNoCount + "'>" + tAlltd + "</tr>");
			
			findMaterialByKeyword();	//用關鍵字查詢物料
			initRow();
		}

		//組項次
		function SetMIRowNumber() {
			var reValue = "<td><label name='lbl_MIRowNumber' style='font-size:14pt'>"+ trMaterialNoCount +"</label></td>";
			return reValue;
		}

		//組物料代號
		function SetMIMaterialID() {
			var reValue = "<td><input type='text' name='tbx_MIcMaterialID' id='tbx_MIcMaterialID" + trMaterialNoCount + "' class='form-control material' style='width:150px;' placeholder='請輸入料號或料號說明的關鍵字'>";
			    reValue += "<input type='hidden' name='hid_MIcDisabled' id='hid_MIcDisabled" + trMaterialNoCount + "' value='0'></td>";
			return reValue;
		}

		//組料號說明
		function SetMIMaterialName() {
			var reValue = "<td><textarea rows='3' class='form-control' style='width:200px;' placeholder='料號說明' name='tbx_MIcMaterialName' id='tbx_MIcMaterialName" + trMaterialNoCount + "' readonly></textarea></td>";
			return reValue;
		}

		//組數量
		function SetMIQuantity() {
			var reValue = "<td><input type='text' name='tbx_MIcQuantity' id='tbx_MIcQuantity" + trMaterialNoCount + "' class='form-control Quantity' style='width:100px;' placeholder='數量'></td>";
			return reValue;
		}

		//組基本內文
		function SetMIBasicContent() {
			var reValue = "<td><textarea rows='3' class='form-control' style='width:200px;' placeholder='基本內文' name='tbx_MIcBasicContent' id='tbx_MIcBasicContent" + trMaterialNoCount + "' readonly></textarea></td>";
			return reValue;
		}

		//組製造商零件號碼
		function SetMIMFPNumber() {
			var reValue = "<td><input type='text' name='tbx_MIcMFPNumber' id='tbx_MIcMFPNumber" + trMaterialNoCount + "' class='form-control' style='width:150px;' placeholder='製造商零件號碼' readonly></td>";
			return reValue;
		}

		//組廠牌
		function SetMIBrand() {
			var reValue = "<td><input type='text' name='tbx_MIcBrand' id='tbx_MIcBrand" + trMaterialNoCount + "' class='form-control' style='width:150px;' placeholder='廠牌' readonly></td>";
			return reValue;
		}

		//組產品階層
		function SetMIProductHierarchy() {
			var reValue = "<td><input type='text' name='tbx_MIcProductHierarchy' id='tbx_MIcProductHierarchy" + trMaterialNoCount + "' class='form-control' style='width:150px;' placeholder='產品階層' readonly></td>";
			return reValue;
		}

		//組刪除按鈕
		function SetMIDelButton() {
			var tTrID = $("input[name='hid_trMaterialNo']").val();
			var reValue = "<td><button name='btn_MaterialDel' class='btn btn-danger' type='button' onclick=DelDetailItem_Material('trMA" + tTrID + "','" + trMaterialNoCount + "');><i class='fa fa-trash'></i></td>";
			return reValue;
		}		

		//刪除明細
		function DelDetailItem_Material(rowId, tNo) {			
			$('#' + rowId).hide();
			$('#hid_MIcDisabled' + tNo).val("1");
		}		
		//-----↑↑↑↑↑物料訊息檔 ↑↑↑↑↑-----

		//-----↓↓↓↓↓序號回報檔 ↓↓↓↓↓-----		

		//新增明細
		function AddDetailItem_Serial(tableName) {
			trSerialNoCount = $("input[name='hid_trSerialNo']").val();

			if (trSerialNoCount == "" || trSerialNoCount == "0") {
				trSerialNoCount = 1;
			}
			else {
				trSerialNoCount = parseInt(trSerialNoCount) + 1;
			}

			$("input[name='hid_trSerialNo']").val(trSerialNoCount);

			var RowNumber = SetSFRowNumber();
			var SerialID = SetSFSerialID();	
			var MaterialID = SetSFMaterialID();
			var MaterialName = SetSFMaterialName();
			var SRConfig = SetSRConfig();	
			var tDelButton = SetSFDelButton();

			var tAlltd = RowNumber + SerialID + MaterialID + MaterialName + SRConfig + tDelButton;

			$("#" + tableName).append("<tr id='trSF" + trSerialNoCount + "'>" + tAlltd + "</tr>");

			hidePopupInit_Serial();		//檔案元件
			SerialSearch();				//產品序號資訊查詢
			findMaterialByKeyword();	//用關鍵字查詢物料
		}

		//組項次
		function SetSFRowNumber() {
			var reValue = "<td><label name='lbl_SFRowNumber' style='font-size:14pt'>"+ trSerialNoCount +"</label></td>";
			return reValue;
		}
		
		//組序號
		function SetSFSerialID() {
			var reValue = "<td><input type='text' name='tbx_SFcSerialID' id='tbx_SFcSerialID" + trSerialNoCount + "' class='form-control Serial' style='width:200px;' placeholder='請輸入序號關鍵字查詢'>";			    
				reValue += "<input type='hidden' name='hid_SFcDisabled' id='hid_SFcDisabled" + trSerialNoCount + "' value='0'></td>";
			return reValue;
		}			

		//組物料代號
		function SetSFMaterialID() {
			var reValue = "<td><input type='text' name='tbx_SFcMaterialID' id='tbx_SFcMaterialID" + trSerialNoCount + "' class='form-control material' style='width:150px;' placeholder='請輸入料號或料號說明的關鍵字'></td>";
			return reValue;
		}

		//組料號說明
		function SetSFMaterialName() {
			var reValue = "<td><textarea rows='3' class='form-control' style='width:200px;' placeholder='料號說明' name='tbx_SFcMaterialName' id='tbx_SFcMaterialName" + trSerialNoCount + "' ></textarea></td>";
			return reValue;
		}

		//組裝機Config檔
		function SetSRConfig() {
			 var reValue = "<td>";
				reValue += "		<div class='dropzone' id='zoneSF_" + trSerialNoCount + "' style='width: 200px; min-height: 100px !important; padding: 0px; display: block !important;'>";
				reValue += "		<div class='fallback file-box'><input name='file' type='file' multiple /></div>";
				reValue += "		<div class='attachment' id='filezoneSF_" + trSerialNoCount + "'></div>";
				reValue += "		<input type='hidden' class='fileids' name='hid_filezoneSF' id='hid_filezoneSF_" + trSerialNoCount + "' value='' />";
				reValue += "</td>";

			return reValue;
		}

		//組刪除按鈕
		function SetSFDelButton()
		{
			var tTrID = $("input[name='hid_trSerialNo']").val();
			var reValue = "<td><button name='btn_SerialDel' class='btn btn-danger' type='button' onclick=DelDetailItem_Serial('trSF" + tTrID + "','" + trSerialNoCount + "');><i class='fa fa-trash'></i></button></td>";
			return reValue;
		}		

		//刪除明細
		function DelDetailItem_Serial(rowId, tNo) {			
			$('#' + rowId).hide();
			$('#hid_SFcDisabled' + tNo).val("1");
		}

		//序號回報(For新增時呼叫)
		function hidePopupInit_Serial() {
            setTimeout(function () {                
				initfile();
            }, 500);

        }
		//-----↑↑↑↑↑序號回報檔 ↑↑↑↑↑-----		
		
		//-----↓↓↓↓↓處理與工時紀錄 ↓↓↓↓↓-----		

		//新增明細
		function AddDetailItem_Record(tableName) {
			trRecordNoCount = $("input[name='hid_trRecordNo']").val();

			if (trRecordNoCount == "" || trRecordNoCount == "0") {
				trRecordNoCount = 1;
			}
			else {
				trRecordNoCount = parseInt(trRecordNoCount) + 1;
			}

			$("input[name='hid_trRecordNo']").val(trRecordNoCount);

			var RowNumber = SetRERowNumber();
			var Engineer = SetEngineer();			
			var ReceiveTime = SetReceiveTime();
			var StartTime = SetStartTime();
			var ArriveTime = SetArriveTime();			
			var FinishTime = SetFinishTime();
			var WorkHours = SetWorkHours();			
			var Desc = SetDesc();
			var SRReport = SeSRReport();			
			var tDelButton = SetREDelButton();

			var tAlltd = RowNumber + Engineer + ReceiveTime + StartTime + ArriveTime + FinishTime + WorkHours + Desc + SRReport + tDelButton;

			$("#" + tableName).append("<tr id='trPR" + trRecordNoCount + "'>" + tAlltd + "</tr>");			

			hidePopupInit_Record(trRecordNoCount);		//初始日期元件
			PeopleSearch();				//Ajax用中文或英文姓名查詢人員帳號
		}

		//組項次
		function SetRERowNumber() {
			var reValue = "<td><label name='lbl_RERowNumber' style='font-size:14pt'>"+ trRecordNoCount +"</label></td>";
			return reValue;
		}
		
		//組服務工程師
		function SetEngineer() {
			var reValue = "<td><input type='text' name='tbx_REcEngineerName' id='tbx_REcEngineerName" + trRecordNoCount + "' class='form-control Peoploe' style='width:200px;' placeholder='請輸入人名或英文關鍵字搜尋'>";
				reValue += "<input type='hidden' name='hid_REcEngineerID' id='hid_REcEngineerID" + trRecordNoCount + "'>";    
				reValue += "<input type='hidden' name='hid_REcDisabled' id='hid_REcDisabled" + trRecordNoCount + "' value='0'></td>";
			return reValue;
		}

		//組接單時間
		function SetReceiveTime() {
			var reValue = "<td><input type='text' name='tbx_REcReceiveTime' id='tbx_REcReceiveTime" + trRecordNoCount + "' class='form-control datetimepicker' style='width:150px;' placeholder='接單時間' onchange='TransTimeSpan(this);'></td>";
			return reValue;
		}	

		//組出發時間
		function SetStartTime() {
			var reValue = "<td><input type='text' name='tbx_REcStartTime' id='tbx_REcStartTime" + trRecordNoCount + "' class='form-control datetimepicker' style='width:150px;' placeholder='出發時間' onchange='TransTimeSpan(this);'></td>";
			return reValue;
		}

		//組到場時間
		function SetArriveTime() {
			var reValue = "<td><input type='text' name='tbx_REcArriveTime' id='tbx_REcArriveTime" + trRecordNoCount + "' class='form-control datetimepicker' style='width:150px;' placeholder='到場時間' onchange='TransTimeSpan(this);'></td>";
			return reValue;
		}

		//組完成時間
		function SetFinishTime() {
			var reValue = "<td><input type='text' name='tbx_REcFinishTime' id='tbx_REcFinishTime" + trRecordNoCount + "' class='form-control datetimepicker' style='width:150px;' placeholder='完成時間' onchange='TransTimeSpan(this);'></td>";
			return reValue;
		}

		//組工時(分鐘)
		function SetWorkHours() {
			var reValue = "<td><input type='text' name='tbx_REcWorkHours' id='tbx_REcWorkHours" + trRecordNoCount + "' class='form-control' style='width:100px;' placeholder='工時(分鐘)' readonly></td>";
			return reValue;
		}

		//組處理紀錄
		function SetDesc() {
			var tDefaultValue = "一、問題判斷： \n \n二、問題處理過程： \n \n三、結論："
			var reValue = "<td><textarea rows='3' class='form-control' style='width:200px;' placeholder='處理紀錄' name='tbx_REcDesc'>" + tDefaultValue + "</textarea></td>";
			return reValue;
		}		

		//組服務報告書
		function SeSRReport() {
			 var reValue = "<td>";
				reValue += "		<div class='dropzone' id='zoneRE_" + trRecordNoCount + "' style='width: 200px; min-height: 100px !important; padding: 0px; display: block !important;'>";
				reValue += "		<div class='fallback file-box'><input name='file' type='file' multiple /></div>";
				reValue += "		<div class='attachment' id='filezoneRE_" + trRecordNoCount + "'></div>";
				reValue += "		<input type='hidden' class='fileids' name='hid_filezoneRE' id='hid_filezoneRE_" + trRecordNoCount + "' value='' />";
				reValue += "</td>";

			return reValue;
		}

		//組刪除按鈕
		function SetREDelButton() {
			var tTrID = $("input[name='hid_trRecordNo']").val();
			var reValue = "<td><button name='btn_RecordDel' class='btn btn-danger' type='button' onclick=DelDetailItem_Record('trPR" + tTrID + "','" + trRecordNoCount + "');><i class='fa fa-trash'></i></td>";
			return reValue;
		}		

		//刪除明細
		function DelDetailItem_Record(rowId, tNo) {
			//$('#' + rowId).remove();
			$('#' + rowId).hide();
			$('#hid_REcDisabled' + tNo).val("1");
		}		
		
		//處理與工時紀錄(For新增時呼叫)
		function hidePopupInit_Record(trRecordNoCount) {
            setTimeout(function () {
                initRecord(trRecordNoCount);
				initfile();
            }, 500);

        }		
		
		//initDateTimePicker
		function initRecord(trRecordNoCount) {
			var tbx_REcReceiveTime = $('#tbx_REcReceiveTime' + trRecordNoCount);
			var tbx_REcStartTime = $('#tbx_REcStartTime' + trRecordNoCount);
			var tbx_REcArriveTime = $('#tbx_REcArriveTime' + trRecordNoCount);
			var tbx_REcFinishTime = $('#tbx_REcFinishTime' + trRecordNoCount);
			
			initDateTimePicker(tbx_REcReceiveTime);
			initDateTimePicker(tbx_REcStartTime);
			initDateTimePicker(tbx_REcArriveTime);
			initDateTimePicker(tbx_REcFinishTime);
		}
		
		function initDateTimePicker(obj) {
			$(obj).datetimepicker({
				minView: "hour", //只顯示到每日的小時(含每小時5分鐘顯示)
                format: "yyyy-mm-dd hh:ii",
                autoclose: true, //當選擇一個日期之後是否立即關閉此日期時間選擇器。
                todayBtn: "linked", //如果此值為true或"linked"，則在日期時間選擇器組件的底部顯示一個today按鈕用以選擇當前日期。如果是true，today按鈕僅僅將視圖轉到當天的日期，如果是linked，當天日期將會被選中。
                todayHighlight: true, //如果為true，閃亮當前日期。
            });
		}
		
		
		//初始化dropzone
		function initfile()
		{
            dropzoneInit1("@Url.Action("AjaxFileUpload", "Ajax")");			
		}

		//初始化dropzone
        function dropzoneInit1(uploadUrl) {
            $.each($(".dropzone"), function () {
                try {
                    var zone = $(this);
                    $(this).dropzone({
                        url: uploadUrl,
                        method: 'post',
                        dictDefaultMessage: "把檔案拉進來或點我選檔案(可選多檔) <br/>※不支援.msg檔上傳, 請<a href='http://tsti-bpm01/files/msg_to_mht.png' target='_blank'> 轉換成MHT</a>或圖檔。",
                        accept: function (file, done) {
                            console.log($(zone).data("namerule"));
                            if ($(zone).data("namerule") != null) {
                                //檔名規則檢核
                                //file.name  上傳檔案的檔名（含副檔名）
                                var namerule = $(zone).data("namerule");
                                var pArray = namerule.split(",");
                                var tIsExits = false; //檔案是否合法

                                pArray.forEach(function (element) {
                                    if (file.name.indexOf(element) != -1) {
                                        tIsExits = true;
                                    }
                                });

                            } else {
                                done();
                            }
                        },
						acceptedFiles: ".jpg,.png,.jpge,.gif,.pdf,.doc,.docx,.xls,.xlsx,.txt,.ppt,.pptx,.zip,.rar,.7z,.csv,.mht,.mp4,.mov",
                        createImageThumbnails: false,
                        init: function () {
                            this.on("success", function (result) {
								var obj = $.parseJSON(result.xhr.responseText);

								var doc = "<div class=\"file-box\" id='" + obj.id + "'>";
								doc += "<div class=\"file\">";
								doc += "<a href='" + fileUrl + obj.fileName + "'" + ((".jpg .jpeg .png .bmp .gif".indexOf(obj.fileExt) != -1) ? "" : "download='" + obj.fileOrgName + "'") + " target='_blank'>";
								doc += "<span class=\"corner\"></span>";
								


								if ($(zone).data("type") == null) {
									doc += "<div class=\"file-name\">" + obj.fileOrgName;
									doc += "<a href=\"javascript:delFile('" + obj.id + "', 'hid_file' + '" + zone.prop("id") + "')\" class='btn btn-xs btn-danger btn-del'>刪除</a></div></a>";
									doc += " </div></div>";

									var fileZoneObj = $("#file" + zone.prop("id"))
									fileZoneObj.append(doc);

									var hidFiles = $("#hid_file" + zone.prop("id"))
									hidFiles.val(hidFiles.val() + obj.id + ",");
									console.log(hidFiles.val());

								} else if ($(zone).data("type") == "type2") { //動態產生上傳區塊使用
									doc += "<div class=\"file-name\">" + obj.fileOrgName;
									doc += "<a href=\"javascript:delFile('" + obj.id + "', '" + zone.prop("id").substr(0, zone.prop("id").lastIndexOf('zone')) + 'hid_file' + zone.prop("id").substr(zone.prop("id").lastIndexOf('zone')) + "')\" class='btn btn-xs btn-danger btn-del'>刪除</a></div></a>";
									doc += " </div></div>";

									var fileZoneObj = $("#" + zone.prop("id").substr(0, zone.prop("id").lastIndexOf('zone')) + 'file' + zone.prop("id").substr(zone.prop("id").lastIndexOf('zone')))
									fileZoneObj.append(doc);

									var hidFiles = $("#" + zone.prop("id").substr(0, zone.prop("id").lastIndexOf('zone')) + 'hid_file' + zone.prop("id").substr(zone.prop("id").lastIndexOf('zone')))
									hidFiles.val(hidFiles.val() + obj.Id + ",");
									console.log(hidFiles.val());
								}

							});

							this.on("complete", function (file) {
								this.removeFile(file);
							});
                        }
                    })
                } catch (e) {
                    console.log(e);
                }
            })
        }		

		//日期相減取得分鐘
		function TransTimeSpan(obj)
		{			
			var Msg = "";
			var ReceiveTime =	$(obj).parent().parent().find('input[name="tbx_REcReceiveTime"]');	//接單時間
			var StartTime =	$(obj).parent().parent().find('input[name="tbx_REcStartTime"]');	//出發時間
			var ArriveTime =	$(obj).parent().parent().find('input[name="tbx_REcArriveTime"]');	//到場時間
			var FinishTime =	$(obj).parent().parent().find('input[name="tbx_REcFinishTime"]');	//完成時間
			var WorkHours = $(obj).parent().parent().find('input[name="tbx_REcWorkHours"]');		//工時(分鐘)
			
			if (ReceiveTime.val() != "" && StartTime.val() != "")
			{
				if (Date.parse(ReceiveTime.val()) > Date.parse(StartTime.val())) {
					Msg += '【接單時間】不能大於【出發時間】！\n';
				}
			}

			if (StartTime.val() != "" && ArriveTime.val() != "")
			{
				if (Date.parse(StartTime.val()) > Date.parse(ArriveTime.val())) {
					Msg += '【出發時間】不能大於【到場時間】！\n';
				}
			}

			if (ArriveTime.val() != "" && FinishTime.val() != "" )
			{
				if (Date.parse(ArriveTime.val()) > Date.parse(FinishTime.val())) {
					Msg += '【到場時間】不能大於【完成時間】！\n';
				}	
				else
				{
					var myStartDate = new Date(ArriveTime.val());
					var myEndDate = new Date(FinishTime.val());

					//分鐘
					var tMin = (myEndDate - myStartDate) / (1000 * 60);
					WorkHours.val(tMin);
				}
			}

			if (Msg != "")
			{
				alert(Msg);
				$(obj).val("");
			}			
		}		

		//檢查是否符合yyyy-MM-dd HH:mm格式
		function verifyMyDate(date) {			
			var pattern = /\d{4}\-\d{2}\-\d{2}\s\d{2}:\d{2}/;
			var correct_match = date.match(pattern);

			if (correct_match) {
				return true;
			}
			else {
			    return false;
			}
		}
		//-----↑↑↑↑↑處理與工時紀錄 ↑↑↑↑↑-----

	</script>
}

	@section breadcrumb_section{
	<div class="col-lg-10">
		<h2>裝機服務</h2>
		<ol class="breadcrumb">
			<li class="breadcrumb-item">
				<a href="#">服務管理</a>
			</li>
			<li class="breadcrumb-item active">
				<strong>裝機服務</strong>
			</li>
		</ol>
	</div>
}

	<div class="row">
		<!--裝機資訊-->
		<div class="col-lg-12">
			<div class="ibox ">
				<div class="ibox-title">
					<h5>
						裝機資訊						
					</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					@model OneService.Controllers.ServiceRequestController.ViewModel_Install //載入StatusViewModel
					<form id="form1" name="form" action='@Url.Action("SaveInstallSR", "ServiceRequest")' method="post">
						<!--目前tr的筆數-->
						<input type="hidden" name="hid_trContactNo" value="@ViewBag.trContactNo">
						<input type="hidden" name="hid_trMaterialNo" value="@ViewBag.trMaterialNo">						
						<input type="hidden" name="hid_trSerialNo" value="@ViewBag.trSerialNo">
						<input type="hidden" name="hid_trRecordNo" value="@ViewBag.trRecordNo">						
						
						@{
							if (ViewBag.cSRID != "")
							{
								var srid = ViewBag.cSRID; 
								<div class="form-group row">
									<button id="btn_Edit" class="btn btn-info btn-lg" type="button" onclick="EditSRID();">
										<i class="fa fa-pencil" style="font-size:large"> 編 輯</i>
									</button>
									<img id="waitingImgEdit" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:0px 10px" alt="">
									&nbsp;&nbsp;&nbsp;&nbsp;
									<button id="btn_submitUP" class="btn btn-primary btn-lg" type="button" onclick="ShowSRConfirmDialogMsg('確認', '您是否確認提交？');">
										<i class="fa fa-arrow-circle-up" style="font-size:large"> 提 交</i>
									</button>
									<img id="waitingImgUP" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:0px 10px" alt="">
									&nbsp;&nbsp;&nbsp;&nbsp;
									<button id="btn_CopySRID" class="btn btn-success btn-lg" type="button" onclick="window.open('@Url.Action("InstallSR", "ServiceRequest", new { CopySRID = srid })','_blank');">
										<i class="fa fa-files-o" style="font-size:large"> 複 製</i>
									</button>										
									&nbsp;&nbsp;&nbsp;&nbsp;
									<button id="btn_ShowHistoryLog" class="btn btn-warning btn-lg" type="button">
										<i class="fa fa-search" style="font-size:large">更改歷史記錄</i>
									</button>
								</div>
							}
						}

						<div class="form-group row">
							<label class="col-lg-2 col-form-label">ID</label>
							<div class="col-lg-4">
								<label class="col-form-label" style="color:blue;">@ViewBag.cSRID</label>								
							</div>							
							<!--目前SRID-->
							<input type="hidden" name="hid_cSRID" value="@ViewBag.cSRID">
							<!--登入者是否可以編輯服務案件-->
							<input type="hidden" id="hid_pIsCanEditSR" name="hid_pIsCanEditSR" value="@ViewBag.pIsCanEditSR">
							<!--目前系統GUID-->
							<input type="hidden" name="hid_cSystemGUID" value="@ViewBag.pGUID">
							<!--登人者姓名-->
							<input type="hidden" id="hid_cLoginUser_Name" name="hid_cLoginUser_Name" value="@ViewBag.cLoginUser_Name">
							<!--登人者帳號-->
							<input type="hidden" id="hid_cLoginUser_EmployeeNO" name="hid_cLoginUser_EmployeeNO" value="@ViewBag.cLoginUser_EmployeeNO">
							<!--登人者ERPID-->
							<input type="hidden" id="hid_cLoginUser_ERPID" name="hid_cLoginUser_ERPID" value="@ViewBag.cLoginUser_ERPID">
							<!--登人者工作地點-->
							<input type="hidden" id="hid_cLoginUser_WorkPlace" name="hid_cLoginUser_WorkPlace" value="@ViewBag.cLoginUser_WorkPlace">
							<!--登人者公司別-->
							<input type="hidden" id="hid_cLoginUser_CompCode" name="hid_cLoginUser_CompCode" value="@ViewBag.cLoginUser_CompCode">
							<!--登人者工廠別-->
							<input type="hidden" id="hid_cLoginUser_BUKRS" name="hid_cLoginUser_BUKRS" value="@ViewBag.cLoginUser_BUKRS">
							<!--登人者單位-->
							<input type="hidden" id="hid_cLoginUser_DepartmentName" name="hid_cLoginUser_DepartmentName" value="@ViewBag.cLoginUser_DepartmentName">
							<!--登人者單位NO-->
							<input type="hidden" id="hid_cLoginUser_DepartmentNO" name="hid_cLoginUser_DepartmentNO" value="@ViewBag.cLoginUser_DepartmentNO">
							<!--登人者利潤中心ID-->
							<input type="hidden" id="hid_cLoginUser_ProfitCenterID" name="hid_cLoginUser_ProfitCenterID" value="@ViewBag.cLoginUser_ProfitCenterID">
							<!--登人者成本中心ID-->
							<input type="hidden" id="hid_cLoginUser_CostCenterID" name="hid_cLoginUser_CostCenterID" value="@ViewBag.cLoginUser_CostCenterID">
							<!--登人者是否為主管-->
							<input type="hidden" id="hid_cLoginUser_IsManager" name="hid_cLoginUser_IsManager" value="@ViewBag.pIsManager">
							<!--程式作業編號檔系統ID(裝機服務)-->
							<input type="hidden" id="hid_OperationID" name="hid_OperationID" value="@ViewBag.pOperationID">
							<!--目前狀態-->
							<input type="hidden" id="hid_cNowStatus" name="hid_cNowStatus" value="@ViewBag.pStatus">
							<!--目前預排日期值-->
							<input type="hidden" id="hid_cNowScheduleDate" name="hid_cNowScheduleDate" value="@ViewBag.cScheduleDate">
							<label class="col-lg-2 col-form-label">*狀態</label>
							<div class="col-lg-4">
								<select asp-for="ddl_cStatus" asp-items="Model.ListStatus" class="form-control Status" disabled="@(ViewBag.cSRID == "" ? false : true)" ></select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">*客戶</label>
							<div class="col-lg-4">
							<input type="text" id="tbx_cCustomerName" name="tbx_cCustomerName" class="form-control CustName" placeholder="請輸入客戶名稱或統編的關鍵字" value="@ViewBag.cCustomerName">
								<label class="col-lg-2 col-form-label" id="lbl_cCustomerID" name="lbl_cCustomerID">@ViewBag.cCustomerID</label>
								<input type="hidden" id="hid_cCustomerID" name="hid_cCustomerID" value="@ViewBag.cCustomerID" />
							</div>
							<label class="col-lg-2 col-form-label">*客戶類型</label>
							<div class="col-lg-4">
								<select asp-for="ddl_cCustomerType" asp-items="Model.ListCustomerType" class="form-control CustomerType" disabled></select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">*說明</label>
							<div class="col-lg-10">
								<input type="text" id="tbx_cDesc" name="tbx_cDesc" class="form-control" placeholder="說明" value="@ViewBag.cDesc" title="@ViewBag.cDesc">
							</div>							
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">*詳細描述</label>
							<div class="col-lg-10">
								<textarea rows="3" class="form-control" placeholder="詳細描述" id="tbx_cNotes" name="tbx_cNotes" title="@ViewBag.cNotes">@ViewBag.cNotes</textarea>
							</div>							
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">檢附文件</label>
							<div class="col-lg-10">
								<!-- 檔案上傳start-->
								<div class="form-group row">
									<div class="col-lg-3 dropzone" id="zone_1">
										<div class="fallback file-box">
											<input name="file" type="file" multiple />
										</div>
									</div>
									<div class="col-lg-9">
										<div class="attachment" id="filezone_1"></div>
										<input type="hidden" class="fileids" name="hid_filezone_1" id="hid_filezone_1" value="@ViewBag.cAttachement" />
									</div>
								</div>
								<!-- 檔案上傳end-->
							</div>
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">備料服務通知單文件</label>
							<div class="col-lg-10">
								<!-- 檔案上傳start-->
								<div class="form-group row">
									<div class="col-lg-3 dropzone" id="zone_2">
										<div class="fallback file-box">
											<input name="file" type="file" multiple />
										</div>
									</div>
									<div class="col-lg-9">
										<div class="attachment" id="filezone_2"></div>
										<input type="hidden" class="fileids" name="hid_filezone_2" id="hid_filezone_2" value="@ViewBag.cAttachementStockNo" />
									</div>
								</div>
								<!-- 檔案上傳end-->
							</div>
						</div>

						<div class="hr-line-dashed"></div>
						
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">報修類別</label>
							<div class="col-lg-6">
								@Html.DropDownList("ddl_cSRTypeOne", (IEnumerable<SelectListItem>)ViewBag.SRTypeOneList, new { @class = "form-control", @onchange = "javascript:onChangecSRTypeOne();" })
								@Html.DropDownList("ddl_cSRTypeSec", (IEnumerable<SelectListItem>)ViewBag.SRTypeSecList, new { @class = "form-control", @onchange = "javascript:onChangecSRTypeSec();" })
								@Html.DropDownList("ddl_cSRTypeThr", (IEnumerable<SelectListItem>)ViewBag.SRTypeThrList, new { @class = "form-control" })								
							</div>							
						</div>
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">*銷售訂單號</label>
							<div class="col-lg-4">								
								<input type="text" id="tbx_cSalesNo" name="tbx_cSalesNo" class="form-control" placeholder="銷售訂單號" value="@ViewBag.cSalesNo" title="@ViewBag.cSalesNo">
							</div>
							<label class="col-lg-2 col-form-label">*出貨單號</label>
							<div class="col-lg-4">								
								<input type="text" id="tbx_cShipmentNo" name="tbx_cShipmentNo" class="form-control" placeholder="出貨單號" value="@ViewBag.cShipmentNo" title="@ViewBag.cShipmentNo">
							</div>
						</div>						
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">延遲結案原因</label>
							<div class="col-lg-4">
							<textarea rows="3" class="form-control" placeholder="延遲結案原因" id="tbx_cDelayReason" name="tbx_cDelayReason" title="@ViewBag.cDelayReason">@ViewBag.cDelayReason</textarea>
							</div>
							<label class="col-lg-2 col-form-label">預排日期</label>
							<div class="col-lg-4">								
								<input type="text" name="tbx_cScheduleDate" id="tbx_cScheduleDate" class="calendar form-control" placeholder="預排日期" value="@ViewBag.cScheduleDate">
								<label class="col-form-label" style="color:red;">※提醒：【延遲結案原因】欄位不為空白時，預排日期為必填。</label>
							</div>							
						</div>	
						<div class="form-group row">
							<label class="col-lg-2 col-form-label">備註</label>
							<div class="col-lg-4">
								<textarea rows="3" class="form-control" placeholder="備註" id="tbx_cRemark" name="tbx_cRemark" title="@ViewBag.cRemark">@ViewBag.cRemark</textarea>
								<label class="col-form-label" style="color:red;">※提醒：【備註】欄位的內容將會呈現於客戶服務報告書中，以利補充說明客戶聯繫事項、維修備註。</label>
							</div>	
							<label class="col-lg-2 col-form-label">建立日期</label>
							<div class="col-lg-4">
								<input type="text" id="tbx_CreatedDate" name="tbx_CreatedDate" class="form-control" placeholder="建立日期" value="@ViewBag.CreatedDate" readonly>
							</div>
						</div>	
						<div class="form-group row">
							<label class="col-lg-2 col-form-label"></label>
							<div class="col-lg-4"></div>	
							<label class="col-lg-2 col-form-label">派單人員</label>
							<div class="col-lg-4">
								<label class="col-form-label">@ViewBag.CreatedUserName</label>
							</div>
						</div>

						<!--客戶聯絡窗口資訊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										*客戶聯絡窗口資訊
										<button type="button" class="btn btn-success" onclick="AddDetailItem_Contact('tableCO');"><i class="fa fa-plus" style="margin-right: 5px;"></i>新增</button>										
										<button id="btn_addContactInfo" class="btn btn-success" type="button" style="margin-left: 10px;" onclick="btn_AddContactInfo_onclick();">
											<i class="fa fa-user-plus" style="margin-right: 5px;"></i>
											<span style="font-weight: bold; margin: 5px;">新增窗口</span>
										</button>
										<button id="btn_editContactInfo" class="btn btn-primary" type="button" style="margin-left: 10px;">
											<i class="fa fa-pencil" style="margin-right: 5px;"></i>
											<span style="font-weight: bold; margin: 5px;">編輯窗口</span>
										</button>
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>
								<div class="ibox-content" style="overflow: scroll">											
									<table id="tableCO" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
										<thead>
											<tr>
												<th>項次</th>
												<th>*姓名(聯絡人)</th>
												<th>*地址(聯絡人)</th>
												<th>電話(聯絡人)</th>
												<th>手機(聯絡人)</th>
												<th>E-Mail(聯絡人)</th>
												<th width="130">刪除</th>
											</tr>
										</thead>
										<tbody>
											@{
												if (ViewBag.cSRID != "" || ViewBag.CopySRID != "")
												{
													int count = 0;
													foreach (var bean in ViewBag.Detailbean_Contact)
													{
														count++;
														<tr id='trContactNo@(count)'>																	
															<td>
																<label name='lbl_CORowNumber' style='font-size:14pt'>@(count)</label>
															</td>	
															<td>
																<input type='text' name='tbx_COcContactName' @("id=tbx_COcContactName" + count)  onclick="showContactInfo('tbx_COcContactName' + @(count));" class='form-control ContactName' style='width:200px;' value="@bean.CContactName" title="@bean.CContactName" disabled readonly>
																<input type='hidden' name='hid_COcDisabled' @("id=hid_COcDisabled" + count) value=@bean.Disabled>
															</td>															
															<td>
																<textarea rows='3' name='tbx_COcContactAddress' @("id=tbx_COcContactAddress" + count) class='form-control ContactAddress' style='width:200px;' title="@bean.CContactAddress" disabled readonly>@bean.CContactAddress</textarea>
															</td>
															<td>
																<input type='text' name='tbx_COcContactPhone' @("id=tbx_COcContactPhone" + count) class='form-control ContactPhone' style='width:200px;' value="@bean.CContactPhone" title="@bean.CContactPhone" disabled readonly>
															</td>
															<td>
																<input type='text' name='tbx_COcContactMobile' @("id=tbx_COcContactMobile" + count) class='form-control ContactMobile' style='width:200px;' value="@bean.CContactMobile" title="@bean.CContactMobile" disabled readonly>
															</td>
															<td>
																<input type='text' name='tbx_COcContactEmail' @("id=tbx_COcContactEmail" + count) class='form-control ContactEmail' style='width:350px;' value="@bean.CContactEmail" title="@bean.CContactEmail" disabled readonly>
															</td>
															<td>
																<button name="btn_ContactDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Contact('trContactNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>																		
															</td>																							
														</tr>
													}
												}
											}
										</tbody>
									</table>
								</div>
							</div>
						</div>

						<!--服務團隊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										服務團隊										
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>
								<div class="ibox-content">
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">*服務團隊</label>
										<div class="col-lg-10 col-sm-10 input-group">
											<input type="hidden" id="hid_cTeamID" name="hid_cTeamID" value="@ViewBag.cTeamID">
											<input id="tbx_cTeamName" name="tbx_cTeamName" type="text" class="form-control labelDisabled" placeholder="服務團隊名稱" disabled>
											<div class="input-group-append">
												<button id="btn_pjTeam" class="btn btn-primary" type="button" @(ViewBag.cSRID == "" ? "" : "disabled")>
													<i class="fa fa-user-plus" aria-hidden="true"></i>
												</button>
											</div>
										</div>										
									</div>									
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">*主要工程師</label>
										<div class="col-lg-4">
											<input type="text" id="tbx_cMainEngineerName" name="tbx_cMainEngineerName" class="form-control PeoploeTeam" placeholder="請輸入人名或英文關鍵字搜尋" value="@ViewBag.cMainEngineerName">
											<input type="hidden" id="hid_cMainEngineerID" name="hid_cMainEngineerID" value="@ViewBag.cMainEngineerID" />
										</div>										
									</div>
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">協助工程師</label>
										<div class="col-lg-10 col-sm-10 input-group">
											<input type="hidden" id="hid_cAssEngineerID" name="hid_cAssEngineerID" value="@ViewBag.cAssEngineerID">
											<input id="tbx_cAssEngineerName" name="tbx_cAssEngineerName" type="text" class="form-control labelDisabled" placeholder="協助工程師姓名" disabled>
											<div class="input-group-append">
												<button id="btn_pjAssEngineer" class="btn btn-primary" type="button">
													<i class="fa fa-user-plus" aria-hidden="true"></i>
												</button>
											</div>
										</div>										
									</div>									
									<div class="form-group row">
										<label class="col-lg-2 col-form-label">*業務人員</label>
										<div class="col-lg-4">
											<input type="text" id="tbx_cSalesName" name="tbx_cSalesName" class="form-control Peoploe" placeholder="請輸入人名或英文關鍵字搜尋" value="@ViewBag.cSalesName">
											<input type="hidden" id="hid_cSalesID" name="hid_cSalesID" value="@ViewBag.cSalesID" />
										</div>
										<label class="col-lg-2 col-form-label">*業務祕書</label>
										<div class="col-lg-4">
											<input type="text" id="tbx_cSecretaryName" name="tbx_cSecretaryName" class="form-control Peoploe" placeholder="請輸入人名或英文關鍵字搜尋" value="@ViewBag.cSecretaryName">
											<input type="hidden" id="hid_cSecretaryID" name="hid_cSecretaryID" value="@ViewBag.cSecretaryID" />
										</div>										
									</div>
								</div>
							</div>
						</div>

						<!--物料訊息資訊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										*物料訊息資訊
										<button type="button" class="btn btn-success" onclick="AddDetailItem_Material('tableMI');"><i class="fa fa-plus" style="margin-right: 5px;"></i>新增</button>
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>	
								<div class="ibox-content" style="overflow: scroll">											
									<table id="tableMI" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
										<thead>
											<tr>
												<th>項次</th>														
												<th>*物料代號</th>
												<th>*料號說明</th>
												<th>*數量</th>
												<th>基本內文</th>
												<th>製造商零件號碼 </th>
												<th>廠牌</th>
												<th>產品階層</th>
												<th width="130">刪除</th>
											</tr>
										</thead>
										<tbody>
											@{
												if (ViewBag.cSRID != "" || ViewBag.CopySRID != "")
												{
													int count = 0;
													foreach (var bean in ViewBag.Detailbean_Material)
													{
														count++;
														<tr id='trMaterialNo@(count)'>
															<td>
																<label name='lbl_MIRowNumber' style='font-size:14pt'>@(count)</label>
															</td>
															<td>
																<input type='text' name='tbx_MIcMaterialID' @("id=tbx_MIcMaterialID" + count) class='form-control material' style='width:150px;' placeholder='物料代號' value="@bean.CMaterialId" title="@bean.CMaterialId">
																<input type='hidden' name='hid_MIcDisabled' @("id=hid_MIcDisabled" + count) value=@bean.Disabled>																		
															</td>																																	
															<td>
																<textarea rows="3" class="form-control" style='width:200px;' placeholder="料號說明" name="tbx_MIcMaterialName" @("id=tbx_MIcMaterialName" + count) title="@bean.CMaterialName" readonly>@bean.CMaterialName</textarea>
															</td>
															<td>
																<input type='text' name='tbx_MIcQuantity' @("id=tbx_MIcQuantity" + count) class='form-control Quantity' style='width:100px;' placeholder='數量' onkeyup="value=value.replace(/[^\d]/g,'')" value="@bean.CQuantity" title="@bean.CQuantity">
															</td>
															<td>
																<textarea rows="3" class="form-control" style='width:200px;' placeholder="基本內文" name="tbx_MIcBasicContent" title="@bean.CBasicContent" readonly>@bean.CBasicContent</textarea>
															</td>																
															<td>
																<input type='text' name='tbx_MIcMFPNumber' @("id=tbx_MIcMFPNumber" + count) class='form-control' style='width:150px;' placeholder='製造商零件號碼' value="@bean.CMfpnumber" title="@bean.CMfpnumber" disabled>
															</td>
															<td>
																<input type='text' name='tbx_MIcBrand' @("id=tbx_MIcBrand" + count) class='form-control' style='width:150px;' placeholder='廠牌' value="@bean.CBrand" title="@bean.CBrand" disabled>
															</td>
															<td>
																<input type='text' name='tbx_MIcProductHierarchy' @("id=tbx_MIcProductHierarchy" + count) class='form-control' style='width:150px;' placeholder='產品階層' value="@bean.CProductHierarchy" title="@bean.CProductHierarchy" disabled>
															</td>
															<td>
																<button name="btn_MaterialDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Material('trMaterialNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>
															</td>																							
														</tr>
													}
												}
											}
										</tbody>
									</table>
								</div>							
							</div>
						</div>

						<!--序號回報資訊-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										序號回報資訊
										<button type="button" class="btn btn-success" onclick="AddDetailItem_Serial('tableSF');"><i class="fa fa-plus" style="margin-right: 5px;"></i>新增</button>
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>
								<div class="ibox-content" style="overflow: scroll">											
									<table id="tableSF" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
										<thead>
											<tr>
												<th>項次</th>	
												<th>*序號</th>
												<th>物料代號</th>
												<th>料號說明</th>
												<th>裝機Config檔</th>
												<th width="130">刪除</th>
											</tr>
										</thead>
										<tbody>
											@{
												if (ViewBag.cSRID != "")
												{
													int count = 0;
													foreach (var bean in ViewBag.Detailbean_Serial)
													{
														count++;
														<tr id='trSerialNo@(count)'>																	
															<td>
																<label name='lbl_SFRowNumber' style='font-size:14pt'>@(count)</label>
															</td>	
															<td>
																<input type='text' name='tbx_SFcSerialID' @("id=tbx_SFcSerialID" + count) class='form-control Serial' style='width:200px;' placeholder='序號' value="@bean.CSerialId" title="@bean.CSerialId">																		
																<input type='hidden' name='hid_SFcDisabled' @("id=hid_SFcDisabled" + count) value=@bean.Disabled>
															</td>															
															<td>
																<input type='text' name='tbx_SFcMaterialID' @("id=tbx_SFcMaterialID" + count) class='form-control material' style='width:150px;' value="@bean.CMaterialId" title="@bean.CMaterialId">
															</td>
															<td>
																<textarea rows="3" class="form-control" style='width:200px;' placeholder="料號說明" name="tbx_SFcMaterialName" @("id=tbx_SFcMaterialName" + count) title="@bean.CMaterialName">@bean.CMaterialName</textarea>
															</td>
															<td>
																<div class="dropzone" @("id=zoneSF_" + count) style="width: 200px; min-height: 100px !important; padding: 0px;">
																	<div class="fallback file-box" >
																		<input name="file" type="file" multiple />
																	</div>
																</div>
																<div class="attachment" @("id=filezoneSF_" + count) ></div>
																<input type="hidden" class="fileids" name="hid_filezoneSF" @("id=hid_filezoneSF_" + count) value="@bean.CConfigReport" />
															</td>
															<td>
																<button name="btn_SerialDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Serial('trSerialNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>																		
															</td>																							
														</tr>
													}
												}
											}
										</tbody>
									</table>
								</div>
							</div>
						</div>

						<!--處理與工時紀錄-->
						<div class="col-lg-12">
							<div class="ibox ">
								<div class="ibox-title">
									<h5>
										處理與工時紀錄
										@if (ViewBag.pStatus != "E0001" && ViewBag.pStatus != "E0014") //非新建或駁回
										{
											<button id="btn_add_pRecord" class="btn btn-success" type="button" style="margin-left: 10px;" onclick="AddDetailItem_Record('tableRecord');"><i class="fa fa-plus" style="margin-right: 5px;"></i>新增</button>
										}
									</h5>
									<div class="ibox-tools">
										<a class="collapse-link">
											<i class="fa fa-chevron-up"></i>
										</a>
									</div>
								</div>	
								@{
									if (ViewBag.pStatus == "E0001")
									{
																		<!--新建階段-->
																		<div class="ibox-content" style="overflow: scroll">
																			<table id="tableRecord" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
																				<thead>
																					<tr>														
																						<th>項次</th>
																						<th>*服務工程師</th>
																						<th>*接單時間</th>
																						<th>*出發時間</th>
																						<th>*到場時間</th>
																						<th>*完成時間</th>
																						<th>*工時(分鐘)</th>
																						<th>*處理紀錄</th>
																						<th>*服務報告書</th>
																						<th width="130">刪除</th>
																					</tr>
																				</thead>
																				<tbody>
																																																																							
																				</tbody>
																			</table>
																		</div>							
									}
									else
									{
																		<!--審核、駁回階段-->
																		<div class="ibox-content" style="overflow: scroll">											
																			<table id="tableRecord" class="table table-striple table-bordered table-hover dataTables-example" style="width:1280px !important">
																				<thead>
																					<tr>														
																						<th>項次</th>
																						<th>*服務工程師</th>
																						<th>*接單時間</th>
																						<th>*出發時間</th>
																						<th>*到場時間</th>
																						<th>*完成時間</th>
																						<th>*工時(分鐘)</th>
																						<th>*處理紀錄</th>
																						<th>*服務報告書</th>
																						<th width="130">刪除</th>
																					</tr>
																				</thead>
																				<tbody>
																				@{
													if (ViewBag.cSRID != "")
													{
														string TechManagerID = ViewBag.cTechManagerID;
														string LoginUser_ERPID = ViewBag.cLoginUser_ERPID;

														int count = 0;
															foreach (var bean in ViewBag.Detailbean_Record)
															{
																count++;
																																@if (LoginUser_ERPID == bean.CEngineerId) //判斷登入人員是否為本人
																{
																																		<tr id='trRecordNo@(count)' class='table-success'>	
																																		<td>
																																			<label name='lbl_RERowNumber' style='font-size:14pt'>@(count)</label>
																																		</td>
																																		<td>
																																			<input type='text' name='tbx_REcEngineerName' @("id=tbx_REcEngineerName" + count) class='form-control' style='width:200px;' placeholder='服務工程師' value="@bean.CEngineerName" title="@bean.CEngineerName">
																																			<input type='hidden' name='hid_REcEngineerID' @("id=hid_REcEngineerID" + count) value=@bean.CEngineerId>
																																			<input type='hidden' name='hid_REcDisabled' @("id=hid_REcDisabled" + count) value=@bean.Disabled>
																																		</td>
																																		<td>
																																			<input type='text' name='tbx_REcReceiveTime' @("id=tbx_REcReceiveTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='接單時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CReceiveTime))" title="@(TransDateFormat_min(bean.CReceiveTime))">
																																		</td>
																																		<td>
																																			<input type='text' name='tbx_REcStartTime' @("id=tbx_REcStartTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='出發時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CStartTime))" title="@(TransDateFormat_min(bean.CStartTime))">
																																		</td>
																																		<td>
																																			<input type='text' name='tbx_REcArriveTime' @("id=tbx_REcArriveTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='到場時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CArriveTime))" title="@(TransDateFormat_min(bean.CArriveTime))">
																																		</td>
																																		<td>
																																			<input type='text' name='tbx_REcFinishTime' @("id=tbx_REcFinishTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='完成時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CFinishTime))" title="@(TransDateFormat_min(bean.CFinishTime))">
																																		</td>																	
																																		<td>
																																			<input type='text' name='tbx_REcWorkHours' @("id=tbx_REcWorkHours" + count) class='form-control' style='width:100px;' placeholder='組工時(分鐘)' value="@bean.CWorkHours" title="@bean.CWorkHours" readonly>
																																		</td>																	
																																		<td>
																																			<textarea rows="3" class="form-control" style='width:200px;' placeholder="處理紀錄" name="tbx_REcDesc" title="@bean.CDesc">@bean.CDesc</textarea>
																																		</td>
																																		<td>
																																			<div class="dropzone" @("id=zoneRE_" + count) style="width: 200px; min-height: 100px !important; padding: 0px;">
																																				<div class="fallback file-box" >
																																					<input name="file" type="file" multiple />
																																				</div>
																																			</div>
																																			<div class="attachment" @("id=filezoneRE_" + count) ></div>
																																			<input type="hidden" class="fileids" name="hid_filezoneRE" @("id=hid_filezoneRE_" + count) value="@bean.CSrreport" />
																																		</td>
																																		<td>
																																		<button name="btn_RecordDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Record('trRecordNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>
																																		</td>																							
																																	</tr>
																}
																else
																{
																																		<tr id='trRecordNo@(count)'>	
																																		<td>
																																			<label name='lbl_RERowNumber' style='font-size:14pt'>@(count)</label>
																																		</td>
																																		<td>
																																			<input type='text' name='tbx_REcEngineerName' @("id=tbx_REcEngineerName" + count) class='form-control' style='width:200px;' placeholder='服務工程師' value="@bean.CEngineerName" title="@bean.CEngineerName">
																																			<input type='hidden' name='hid_REcEngineerID' @("id=hid_REcEngineerID" + count) value=@bean.CEngineerId>
																																			<input type='hidden' name='hid_REcDisabled' @("id=hid_REcDisabled" + count) value=@bean.Disabled>
																																		</td>
																																		<td>
																																			<input type='text' name='tbx_REcReceiveTime' @("id=tbx_REcReceiveTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='接單時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CReceiveTime))" title="@(TransDateFormat_min(bean.CReceiveTime))">
																																		</td>
																																		<td>
																																			<input type='text' name='tbx_REcStartTime' @("id=tbx_REcStartTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='出發時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CStartTime))" title="@(TransDateFormat_min(bean.CStartTime))">
																																		</td>
																																		<td>
																																			<input type='text' name='tbx_REcArriveTime' @("id=tbx_REcArriveTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='到場時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CArriveTime))" title="@(TransDateFormat_min(bean.CArriveTime))">
																																		</td>
																																		<td>
																																			<input type='text' name='tbx_REcFinishTime' @("id=tbx_REcFinishTime" + count) class='form-control datetimepicker' style='width:150px;' placeholder='完成時間' onchange="TransTimeSpan(this);" value="@(TransDateFormat_min(bean.CFinishTime))" title="@(TransDateFormat_min(bean.CFinishTime))">
																																		</td>																	
																																		<td>
																																			<input type='text' name='tbx_REcWorkHours' @("id=tbx_REcWorkHours" + count) class='form-control' style='width:100px;' placeholder='組工時(分鐘)' value="@bean.CWorkHours" title="@bean.CWorkHours" readonly>
																																		</td>																	
																																		<td>
																																			<textarea rows="3" class="form-control" style='width:200px;' placeholder="處理紀錄" name="tbx_REcDesc" title="@bean.CDesc">@bean.CDesc</textarea>
																																		</td>
																																		<td>
																																			<div class="dropzone" @("id=zoneRE_" + count) style="width: 200px; min-height: 100px !important; padding: 0px;">
																																				<div class="fallback file-box" >
																																					<input name="file" type="file" multiple />
																																				</div>
																																			</div>
																																			<div class="attachment" @("id=filezoneRE_" + count) ></div>
																																			<input type="hidden" class="fileids" name="hid_filezoneRE" @("id=hid_filezoneRE_" + count) value="@bean.CSrreport" />
																																		</td>
																																		<td>
																																		<button name="btn_RecordDel" class='btn btn-danger' type='button' onclick="DelDetailItem_Record('trRecordNo@(count)', '@(count)')" ;><i class='fa fa-trash'></i></button>
																																		</td>																							
																																	</tr>
																}																
															}
														}
																					}
																				</tbody>
																			</table>
																		</div>
									}
								}								
							</div>
						</div>
						
						<div class="form-group row">
							<button id="btn_submit" class="btn btn-primary btn-lg" type="button" onclick="ShowSRConfirmDialogMsg('確認', '您是否確認提交？');">
								<i class="fa fa-arrow-circle-up" style="font-size:large"> 提 交</i>
							</button>
							<img id="waitingImg" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:0px 10px" alt="">
						</div>
					</form>
				</div>
			</div>
		</div>
		
	</div>

	<!--新增客戶聯絡人彈出視窗-->
	<div class="modal fade" id="dialog_pAddContactInfo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label"><i class="fa fa-calendar-plus-o" aria-hidden="true"></i>新增客戶【聯絡】窗口資訊</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">														
					<div class="form-group row">
					<label class="col-lg-2 col-form-label">查詢縣市鄉鎮路段和地址</label>
                        <div class="input-group col-lg-10">
                            <div class="col-lg-6 col-xs-12">
								<label class="col-form-label">縣市名稱：</label>
								<select id="ddl_PostAddressCity" class="changePostCity form-control"></select>
							</div>
							<div class="col-lg-6 col-xs-12">
								<label class="col-form-label">鄉鎮市區：</label>
								<select id="ddl_PostAddressTownship" class="changePostTownship form-control"></select>
							</div>
							<div class="col-lg-12 col-xs-12">
								<label class="col-form-label">路段(名)：</label>
								<input type="text" id="tbx_PostAddressRoad" name="tbx_PostAddressRoad" class="changePostRoad form-control" placeholder="請先選擇【縣市名稱】和【鄉鎮市區】，再輸入路段(名)關鍵字">							
							</div>							
                        </div>                       
                    </div>
					<div class="hr-line-dashed"></div>									
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">姓名*</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cAddContactName" name="tbx_cAddContactName" class="form-control" placeholder="姓名">
						</div>
						<label class="col-lg-2 col-form-label">電話</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cAddContactPhone" name="tbx_cAddContactPhone" class="form-control" placeholder="電話">
						</div>
					</div>	
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">城市*</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cAddContactCity" name="tbx_cAddContactCity" class="form-control" placeholder="城市" disabled>
						</div>	
						<label class="col-lg-2 col-form-label">手機</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cAddContactMobile" name="tbx_cAddContactMobile" class="form-control" placeholder="手機">
						</div>
					</div>
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">詳細地址*</label>
						<div class="col-lg-10">							
							<input type="text" id="tbx_cAddContactAddress" name="tbx_cAddContactAddress" class="form-control" placeholder="詳細地址" disabled>							
							<input type="text" id="tbx_cAddContactAddress_No" name="tbx_cAddContactAddress_No" class="form-control" placeholder="門牌號碼/樓層">
						</div>
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">Email</label>
						<div class="col-lg-10">
							<input type="text" id="tbx_cAddContactEmail" name="tbx_cAddContactEmail" class="form-control" placeholder="Email" onblur="CheckEmailValid();">
						</div>
					</div>					
				</div>
				<div class="modal-footer">
					<div class="col-lg-5"></div>
					<button id="btn_saveContactInfo" class="btn btn-primary col-lg-2 col-xs-12" type="button" onclick="saveContactInfo();">
						<i class="fa fa-save"></i> 儲 存
					</button>
					<img id="img_waiting_saveContactInfo" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
					<div class="col-lg-5"></div>
				</div>
			</div>
		</div>
	</div>

	<!--編輯/刪除客戶【報修/聯絡】窗口彈出視窗-->
	<div class="modal fade" id="dialog_pjEditContactInfo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
				<label class="col-form-label"><i class="fa fa-users"></i> 編輯/刪除客戶【聯絡】窗口設定</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div  class="form-group row">
						<label class="col-lg-12 col-form-label" style="color:blue; font-size:large;">提醒：聯絡人是透過One Service系統建立才可以編輯/刪除</label>
					</div>
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">聯絡人姓名</label>
						<div class="input-group col-sm-10 col-lg-6" style="height: 36px;">							
							<input type="text" id="tbx_editContactName" class="form-control Contact" placeholder="請輸入姓名關鍵字">
							<button id="btn_pjEditContact" class="btn btn-info" type="button" onclick="getpjEditContact();">查詢</button>
						</div>						
					</div>
					<div class="hr-line-dashed"></div>
					<div class="form-group row">						
						<input type="hidden" id="hid_cEditContactID" />
						<label class="col-lg-2 col-form-label">姓名*</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cEditContactName" name="tbx_cEditContactName" class="form-control" placeholder="姓名" disabled>
						</div>
						<label class="col-lg-2 col-form-label">電話</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cEditContactPhone" name="tbx_cEditContactPhone" class="form-control" placeholder="電話">
						</div>
					</div>	
					<div class="form-group row">							
						<label class="col-lg-2 col-form-label">城市*</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cEditContactCity" name="tbx_cEditContactCity" class="form-control" placeholder="城市">
						</div>					
						<label class="col-lg-2 col-form-label">手機</label>
						<div class="col-lg-4">
							<input type="text" id="tbx_cEditContactMobile" name="tbx_cEditContactMobile" class="form-control" placeholder="手機">
						</div>
					</div>
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">詳細地址*</label>
						<div class="col-lg-10">							
							<input type="text" id="tbx_cEditContactAddress" name="tbx_cEditContactAddress" class="form-control" placeholder="詳細地址">							
						</div>
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">Email</label>
						<div class="col-lg-10">
							<input type="text" id="tbx_cEditContactEmail" name="tbx_cEditContactEmail" class="form-control" placeholder="Email" onblur="CheckEditEmailValid();">
						</div>
					</div>					
					<div class="form-group row">
						<div class="col-lg-2">
							<button id="btn_savepjEditContact" class="btn btn-primary col-lg-12 col-xs-12" style="display:none;" type="button" onclick="savepjEditContact();">
								<i class="fa fa-save" style="margin-right: 4px;"></i> 儲 存
							</button>
							<img id="img_waiting_savepjEditContact" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
						</div>
					</div>
				</div>
				<hr style="border: 1px solid lightgray; width: 98%;" />
				<div class="modal-body" id="tb_pjeditContact" style="overflow: scroll;">

				</div>
			</div>
		</div>
	</div>

	<!--選擇客戶聯絡人彈出視窗-->
	<div class="modal fade" id="dialog_pContactInfo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document" style="max-width:50%">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label">客戶【聯絡】窗口資訊</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" id="tb_pContactInfo">
				</div>
			</div>
		</div>
	</div>

	<!--ShowSRConfirmDialog-->
	<div class="modal fade" id="ShowSRConfirmDialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="ShowSRConfirmdialogTitle">確認</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" id="ShowSRConfirmdialogContent">
				</div>
				<div class="modal-footer">
					<button id="BtnCancel" type="button" class="btn btn-lg btn-dark" data-dismiss="modal">取消</button>
					<button id="BtnSave" type="button" class="btn btn-lg btn-primary" data-dismiss="modal" onclick="onclickBtnSave();">確認</button>
				</div>
			</div>
		</div>
	</div>

	<!--協助工程師彈出視窗-->
	<div class="modal fade" id="dialog_pjAssEngineer" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label"><i class="fa fa-users"></i> 協助工程師設定</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">協助工程師姓名</label>
						<div class="input-group col-sm-10 col-lg-6" style="height: 36px;">
							<input type="hidden" id="hid_pjAssEngineerAcc" />
							<input type="text" id="tbx_pjAssEngineerName" class="form-control Peoploe" placeholder="請輸入人名或英文關鍵字搜尋">
						</div>
						<div class="col-lg-2">
							<button id="btn_savepjAssEngineer" class="btn btn-primary col-lg-12 col-xs-12" type="button" onclick="savepjAssEngineer();">
								<i class="fa fa-save" style="margin-right: 4px;"></i> 儲 存
							</button>
							<img id="img_waiting_savepjAssEngineer" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
						</div>
					</div>
				</div>
				<hr style="border: 1px solid lightgray; width: 98%;" />
				<div class="modal-body" id="tb_pjAssEngineer" style="overflow: scroll;">

				</div>
			</div>
		</div>
	</div>	

	<!--服務團隊彈出視窗-->
	<div class="modal fade" id="dialog_pjTeam" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label"><i class="fa fa-users"></i> 服務團隊設定</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">服務團隊名稱</label>
						<div class="input-group col-sm-10 col-lg-6" style="height: 36px;">							
							@Html.DropDownList("ddl_cTeamID", (IEnumerable<SelectListItem>)ViewBag.SRTeamIDList, new { @class = "form-control" })
						</div>
						<div class="col-lg-2">
							<button id="btn_savepjTeam" class="btn btn-primary col-lg-12 col-xs-12" type="button" onclick="savepjTeam();">
								<i class="fa fa-save" style="margin-right: 4px;"></i> 儲 存
							</button>
							<img id="img_waiting_savepjTeam" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
						</div>
					</div>
				</div>
				<hr style="border: 1px solid lightgray; width: 98%;" />
				<div class="modal-body" id="tb_pjTeam" style="overflow: scroll;">

				</div>
			</div>
		</div>
	</div>

	<!--執行處理與工時紀錄彈出視窗-->
	<div class="modal fade" id="dialog_pRecord" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
				<label class="col-form-label"><i class="fa fa-calendar-plus-o" aria-hidden="true"></i> 執行處理與工時紀錄</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<!--執行工時紀錄Id-->
					<input type="hidden" id="hid_pRecordCId" runat="server" />					
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">服務工程師*</label>
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordEngineerName" type="text" class="form-control Peoploe" placeholder="請輸入人名或英文關鍵字搜尋" style="padding-left: 15px;">
							<input type="hidden" id="hid_pjRecordEngineerID" runat="server" />
						</div>						
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">接單時間*</label>
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordReceiveTime" type="text" class="form-control datetimepicker" placeholder="請選擇接單時間" style="padding-left: 15px;">	
							
						</div>
						<label class="col-lg-2 col-form-label">出發時間*</label>
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordStartTime" type="text" class="form-control datetimepicker" placeholder="請選擇出發時間" style="padding-left: 15px;">							
						</div>
					</div>					
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">到場時間*</label>
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordArriveTime" type="text" class="form-control datetimepicker" placeholder="請選擇到場時間" style="padding-left: 15px;">	
							
						</div>
						<label class="col-lg-2 col-form-label">完成時間*</label>
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordFinishTime" type="text" class="form-control datetimepicker" placeholder="請選擇完成時間" style="padding-left: 15px;">							
						</div>
					</div>					
					<div class="form-group row">						
						<label class="col-lg-2 col-form-label">工時(分鐘)*</label>						
						<div class="col-lg-4" style="padding: 0px;">
							<input id="tbx_pjRecordWorkHours" type="text" class="form-control" placeholder="工時(分鐘)" disabled/>
						</div>	
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">處理紀錄*</label>
						<textarea id="tbx_pjRecordDesc" rows="3" class="col-lg-10 form-control" placeholder="請輸入處理紀錄" onkeyup="showRemainWords(this, 255, '#remainPrDesc');" onfocusout="hideRemainWords('#remainPrDesc');"></textarea>
						<div class="col-lg-2"></div>
						<span id='remainPrDesc' style="font-size: 10px; color: red;"></span>
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">服務報告書*</label>
						<div class="dropzone popupDropzone" id="zone_pr" style="width: 200px; min-height: 100px !important; padding: 0px;">
							<div class="fallback file-box">
								<input name="file" type="file" multiple />
							</div>
						</div>
						<div class="attachment" id="filezone_pjRecord"></div>
						<input type="hidden" class="fileids" name="hid_filezone" id="hid_filezone_pjRecord" value="" />
					</div>
				</div>
				<div class="modal-footer">
					<div class="col-lg-5"></div>
					<button id="btn_savepjRecord" class="btn btn-primary col-lg-2 col-xs-12" type="button" onclick="savepjRecord($('#hid_pRecordCId').val());"> <i class="fa fa-save"></i> 儲 存</button>
					<img id="img_waiting_savePR" class="waitingImg" src="~/images/ajax-loading_16.gif" style="display:none; margin:6px" alt="">
					<div class="col-lg-5"></div>
				</div>
			</div>
		</div>
	</div>

	<!--執行處理與工時紀錄的服務報告書彈出視窗-->
	<div class="modal fade" id="dialog_pRecordReport" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<label class="col-form-label">執行處理與工時紀錄的服務報告書</label>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" id="tb_pRecordReport">

				</div>
			</div>
		</div>
	</div>

	<!--ShowBOMDialog-->
    <div class="modal fade" id="ShowBOMDialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ShowBOMdialogTitle">BOM表</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="ShowBOMdialogContent">

                </div>
                <div class="modal-footer">
                    <button id="BtnClose" type="button" class="btn btn-lg btn-dark" data-dismiss="modal">關閉</button>
                </div>
            </div>
        </div>
    </div>