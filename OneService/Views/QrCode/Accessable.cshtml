@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "門禁授權";
    Layout = "~/Views/Shared/_LayoutHome.cshtml";
}

@section js_section{
	<script>

		$(document).ready(function(){

			$("#tbx_EmpName").koala({
				delay: 300,
				keyup: function (event) {
					if (event.keyCode != 13) {
						var keyword = $(this).val();
						var obj = $(this);
						$.ajax({
							url: '@Url.Action("AjaxHandler", "Ajax")',
							type: 'post',
							dataType: 'json',
							data: { functionName: 'findEmployeeByKeyword', keyword: keyword },
							success: function (result) {
								objects = [];
								$.each(result, function (i, idata) {
									objects[i] = {
										label: idata.EmpEname + "\\" + idata.EmpName,
										idx: i,
										value: idata.EmpName,
										account: idata.Account,
										erpId: idata.ErpId,
										deptName: idata.DeptName
									};
								});

								//綁定foucs事件
								obj.autocomplete({
									source: objects,
									select: function (event, ui) {
										$("#hie_ErpId").val(ui.item.erpId);
									}
								}).bind('focus', function () { $(this).autocomplete("search"); });

								//開啟autocomplete選單
								obj.focus();
							}
						})
					}

				}
			});

		});

		function delAccessable(id){
			$.ajax({
				url: '@Url.Action("DelAccessableById","QrCode")',
				type:'post',
				dataType:'json',
				data:{"id":id},
				success:function(result){
					console.log(result);
					location.reload();
				}
			})
		}

	</script>
}

@section breadcrumb_section{
	<div class="col-lg-10">
		<h2>門禁授權</h2>
		<ol class="breadcrumb">
			<li class="breadcrumb-item">
				<a href="#">智慧門禁系統</a>
			</li>
			<li class="breadcrumb-item active">
				<strong>門禁授權</strong>
			</li>
		</ol>
	</div>
}

<div class="row">

	<div class="col-lg-12">
		<div class="ibox ">
			<div class="ibox-title">
				<h5>門禁授權</h5>
				<div class="ibox-tools">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>
				</div>
			</div>
			<div class="ibox-content">
				<form name="form" action='@Url.Action("SaveAccessable", "QrCode")' method="post">
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">姓名</label>
						<div class="col-lg-4"><input type="text" id="tbx_EmpName" name="UserName" class="form-control" placeholder="姓名" required></div>
						<input type="hidden" id="hie_ErpId" name="ErpId">
					</div>
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">地點</label>
						<div class="col-lg-4">
							<select name="AccessLocation" class="form-control">
								<option value="台中機房">台中機房</option>
							</select>
						</div>
					</div>

					<div class="hr-line-dashed"></div>
					<button class="btn btn-success btn-lg" type="submit">
						<i class="fa fa-search"></i> 儲存
					</button>
					<button class="btn btn-primary btn-lg" type="button" onclick="searchCust()">
						<i class="fa fa-search"></i> 查 詢
					</button>
				</form>
			</div>
		</div>
	</div>

	<div class="col-lg-12">
		<div class="ibox ">
			<div class="ibox-title">
				<h5>DataTable列表</h5>
				<div class="ibox-tools">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>
				</div>
			</div>
			<div class="ibox-content" id="dataDiv">
				<table id="table1" class="table table-striple table-bordered table-hover dataTables-example">
					<thead>
						<tr>
							<th>地點</th>
							<th>姓名</th>
							<th>刪除</th>
						</tr>
					</thead>
					<tbody>
						@foreach(var bean in ViewBag.beans)
						{
							<tr>
								<td>@bean.AccessLocation</td>
								<td>
									@bean.UserName
								</td>
								<td>
									<button type="button" class="btn btn-danger btn-lg" onclick="delAccessable(@bean.Id)">
										<i class="fa fa-trash"></i>刪除
									</button>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>

</div>